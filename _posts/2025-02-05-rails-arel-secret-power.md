---
layout: post
title:  "Rails ORM –∏ —ç—Ç–æ—Ç —Å—Ç—Ä–∞–Ω–Ω—ã–π Arel"
date:   2025-02-05 10:30:00 +0300
categories:
  - rails
  - orm
toc: true
menubar_toc: true
hero_image: /images/rails.jpeg
hero_darken: true
---

–¢—ã –Ω–∞–≤–µ—Ä–Ω—è–∫–∞ –ø–∏—Å–∞–ª `where("score > ?", 42)` ‚Äî –∏ –∑–∞–¥—É–º—ã–≤–∞–ª—Å—è, –∞ –ø–æ—á–µ–º—É Rails **–Ω–µ –¥–∞—ë—Ç —Å–∏–Ω—Ç–∞–∫—Å–∏—Å `.where(score.gt(42))`** –∫–∞–∫ –≤ –Ω–æ—Ä–º–∞–ª—å–Ω—ã—Ö ORM?

–ù–∞ —Å–∞–º–æ–º –¥–µ–ª–µ ‚Äî –¥–∞—ë—Ç. –ü—Ä–æ—Å—Ç–æ —ç—Ç–∞ –º–∞–≥–∏—è –∑–æ–≤—ë—Ç—Å—è `Arel`.

---

## ü§ñ –ß—Ç–æ —Ç–∞–∫–æ–µ Arel?

`Arel` ‚Äî —ç—Ç–æ **–≤–Ω—É—Ç—Ä–µ–Ω–Ω–∏–π –º–µ—Ö–∞–Ω–∏–∑–º**, –Ω–∞ –∫–æ—Ç–æ—Ä–æ–º —Ä–∞–±–æ—Ç–∞–µ—Ç ActiveRecord. –í—Å–µ `where`, `joins`, `order` ‚Äî –≤ –∏—Ç–æ–≥–µ –∫–æ–º–ø–∏–ª–∏—Ä—É—é—Ç—Å—è –≤ Arel-–æ–±—ä–µ–∫—Ç—ã, –∞ –∑–∞—Ç–µ–º –≤ SQL.

–¢—ã –º–æ–∂–µ—à—å –∏—Å–ø–æ–ª—å–∑–æ–≤–∞—Ç—å Arel –Ω–∞–ø—Ä—è–º—É—é, —á—Ç–æ–±—ã –ø–∏—Å–∞—Ç—å –±–æ–ª–µ–µ —Å–ª–æ–∂–Ω—ã–µ –∏ –±–µ–∑–æ–ø–∞—Å–Ω—ã–µ –∑–∞–ø—Ä–æ—Å—ã:

```ruby
users = User.arel_table
User.where(users[:score].gt(42))
````

---

## üß™ –ó–∞—á–µ–º –∏—Å–ø–æ–ª—å–∑–æ–≤–∞—Ç—å Arel?

* –î–∏–Ω–∞–º–∏—á–µ—Å–∫–∏ —Å–æ–±–∏—Ä–∞—Ç—å —É—Å–ª–æ–≤–∏—è –±–µ–∑ –∫–æ–Ω–∫–∞—Ç–µ–Ω–∞—Ü–∏–∏ —Å—Ç—Ä–æ–∫
* –ë–µ–∑–æ–ø–∞—Å–Ω–æ –≤—Å—Ç–∞–≤–ª—è—Ç—å –ø–æ–ª—è, –∏–º–µ–Ω–∞ —Ç–∞–±–ª–∏—Ü –∏ –∞–ª–∏–∞—Å—ã
* –ò—Å–ø–æ–ª—å–∑–æ–≤–∞—Ç—å —Å–ª–æ–∂–Ω—ã–µ SQL-–≤—ã—Ä–∞–∂–µ–Ω–∏—è (`CASE`, `COALESCE`, –ø–æ–¥–∑–∞–ø—Ä–æ—Å—ã)

---

## üì¶ –ü—Ä–∏–º–µ—Ä—ã Arel-–∑–∞–ø—Ä–æ—Å–æ–≤

```ruby
# user.name = 'Eugene'
t = User.arel_table
User.where(t[:name].eq('Eugene'))

# score > 100 AND active = true
User.where(t[:score].gt(100).and(t[:active].eq(true)))
```

–°–ª–æ–∂–Ω—ã–π –ø—Ä–∏–º–µ—Ä ‚Äî —É—Å–ª–æ–≤–Ω—ã–π –ø–æ—Ä—è–¥–æ–∫:

```ruby
User.order(
  Arel.sql("CASE WHEN admin THEN 0 ELSE 1 END")
)
```

---

## üîç ActiveRecord –≤—Å—ë –µ—â—ë –∫—Ä—É—á–µ

–í –±–æ–ª—å—à–∏–Ω—Å—Ç–≤–µ —Å–ª—É—á–∞–µ–≤ **Arel –Ω–µ –Ω—É–∂–µ–Ω**. ActiveRecord —É–∂–µ —É–º–µ–µ—Ç:

```ruby
User.where(name: "Alice")                         # ‚Üí name = 'Alice'
User.where("score > ?", 42)                       # ‚Üí –±–µ–∑–æ–ø–∞—Å–Ω—ã–π bind
User.where("metadata @> ?", { admin: true }.to_json) # JSONB!
```

–ù–æ –µ—Å–ª–∏ —Ç—ã —Å—Ç—Ä–æ–∏—à—å –¥–∏–Ω–∞–º–∏—á–µ—Å–∫–∏–π SQL (–Ω–∞–ø—Ä–∏–º–µ—Ä, –∏–∑ –∫–æ–Ω—Ñ–∏–≥–æ–≤ –∏–ª–∏ —á–µ—Ä–µ–∑ –∫–æ–Ω—Å—Ç—Ä—É–∫—Ç–æ—Ä –∑–∞–ø—Ä–æ—Å–æ–≤) ‚Äî Arel –¥–∞—ë—Ç **–±–æ–ª–µ–µ –Ω–∞–¥—ë–∂–Ω—É—é –∏ —á–∏—Å—Ç—É—é –∞–ª—å—Ç–µ—Ä–Ω–∞—Ç–∏–≤—É** —Å—Ç—Ä–æ–∫–∞–º.

---

## üí£ –í —á—ë–º –ø–æ–¥–≤–æ—Ö

* Arel ‚Äî **—á–∞—Å—Ç–Ω–∞—è API**, –º–æ–∂–µ—Ç –º–µ–Ω—è—Ç—å—Å—è –±–µ–∑ –ø—Ä–µ–¥—É–ø—Ä–µ–∂–¥–µ–Ω–∏—è
* –ù–µ—Ç –Ω–æ—Ä–º–∞–ª—å–Ω–æ–π –¥–æ–∫—É–º–µ–Ω—Ç–∞—Ü–∏–∏
* –ò–Ω–æ–≥–¥–∞ —Å–ª–æ–∂–Ω–æ —á–∏—Ç–∞—Ç—å –∏ –æ—Ç–ª–∞–∂–∏–≤–∞—Ç—å

---

## üõ† –ö–æ–≥–¥–∞ –ø—Ä–∏–≥–æ–¥–∏—Ç—Å—è

* –ö–æ–Ω—Å—Ç—Ä—É–∫—Ç–æ—Ä—ã —Ñ–∏–ª—å—Ç—Ä–æ–≤ (`Admin::UsersQueryBuilder`)
* –°–ª–æ–∂–Ω—ã–µ `.or`, `.and`, `.not`
* –î–∏–Ω–∞–º–∏—á–µ—Å–∫–æ–µ `ORDER BY`, `CASE`, `COALESCE`
* –°–æ—Å—Ç–∞–≤–Ω—ã–µ `JOIN ON ... AND ...`

---

üí¨ *–í—ã–≤–æ–¥*: Arel ‚Äî —ç—Ç–æ –∫–∞–∫ –±—ç–∫—ç–Ω–¥ ActiveRecord. –ï—Å–ª–∏ —Ç–µ–±–µ –Ω—É–∂–Ω–æ –±–æ–ª—å—à–µ –∫–æ–Ω—Ç—Ä–æ–ª—è –∏ —Ç—ã –Ω–µ –±–æ–∏—à—å—Å—è –Ω–µ–º–Ω–æ–≥–æ SQL ‚Äî —ç—Ç–æ –º–æ—â–Ω—ã–π –∏–Ω—Å—Ç—Ä—É–º–µ–Ω—Ç. –ù–æ –µ—Å–ª–∏ –º–æ–∂–µ—à—å ‚Äî –æ—Å—Ç–∞–≤–∞–π—Å—è –≤ ActiveRecord, –æ–Ω –Ω–∞–¥—ë–∂–Ω–µ–µ –∏ –ø—Ä–æ—â–µ.
