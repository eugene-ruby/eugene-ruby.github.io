---
layout: post
subtitle: <div id="terminal"></div>
title: "üîê –°–µ–∫—Ä–µ—Ç—ã ‚Äî –Ω–µ —Å–µ–∫—Ä–µ—Ç! –ö–∞–∫ –Ω–µ –æ—Ç–¥–∞—Ç—å –∫–ª—é—á–∏ –æ—Ç –ø—Ä–æ–µ–∫—Ç–∞ –≤ –ø–µ—Ä–≤—ã–π –∂–µ –¥–µ–Ω—å"
date:   2024-10-12 14:00:00 +0300
rate: 4
tags: Pet,GitHub,Secrets
version: 3.2.2
categories:
  - pet
  - ruby
hero_image: /images/posts/38.jpg
hero_darken: true
toc: true
menubar_toc: true
---
–í—ã —Ç–æ–ª—å–∫–æ –Ω–∞—á–∞–ª–∏ pet-–ø—Ä–æ–µ–∫—Ç: –±–∞–∑–∞ —Ä–∞–±–æ—Ç–∞–µ—Ç, API –æ—Ç–≤–µ—á–∞–µ—Ç, –±–æ—Ç –≤ Telegram —à–ª—ë—Ç –∫–æ—Ç–∏–∫–æ–≤. –ò –≤–¥—Ä—É–≥ ‚Äî —Å–ª—É—á–∞–π–Ω—ã–π –∫–æ–º–º–∏—Ç —Å `TOKEN=abc123` –≤ –ø—É–±–ª–∏—á–Ω—ã–π —Ä–µ–ø–æ–∑–∏—Ç–æ—Ä–∏–π. –ò—Å—Ç–æ—Ä–∏—è –∑–Ω–∞–µ—Ç —Å–æ—Ç–Ω–∏ —Ç–∞–∫–∏—Ö —Å–ª—É—á–∞–µ–≤, –∫–æ–≥–¥–∞ —Ä–∞–∑—Ä–∞–±–æ—Ç—á–∏–∫–∏ —Ç–µ—Ä—è–ª–∏ –¥–æ—Å—Ç—É–ø –∫ API –∏–ª–∏ –ø–æ–ª—É—á–∞–ª–∏ —Å—á—ë—Ç –Ω–∞ $50.000 –∑–∞ –æ–±–ª–∞—á–Ω—ã–µ —Å–µ—Ä–≤–∏—Å—ã. –†–∞–∑–±–µ—Ä—ë–º –º–∏–Ω–∏–º–∞–ª—å–Ω—ã–π, –Ω–æ —ç—Ñ—Ñ–µ–∫—Ç–∏–≤–Ω—ã–π —Å—Ç–µ–∫ –¥–ª—è –∑–∞—â–∏—Ç—ã —Å–µ–∫—Ä–µ—Ç–æ–≤ –≤ Ruby-–ø—Ä–æ–µ–∫—Ç–∞—Ö.

---

## üíÄ –ò—Å—Ç–æ—Ä–∏—è –∏–∑ –∏–Ω—Ç–µ—Ä–Ω–µ—Ç–æ–≤

```bash
+ –î–µ–¥–ª–∞–π–Ω —á–µ—Ä–µ–∑ 2 —á–∞—Å–∞
+ –ù–∞–¥–æ —Å—Ä–æ—á–Ω–æ –∑–∞–¥–µ–ø–ª–æ–∏—Ç—å —Ñ–∏—á—É
+ git add . && git commit -m "fix auth"
+ git push
# –ß–µ—Ä–µ–∑ 15 –º–∏–Ω—É—Ç: 
- "–ü–æ—á–µ–º—É –Ω–∞—à –±–æ—Ç —Ä–∞—Å—Å—ã–ª–∞–µ—Ç —Ä–µ–∫–ª–∞–º—É? üîû"
```

**–ú–æ—Ä–∞–ª—å**: —Å–µ–∫—Ä–µ—Ç—ã —É—Ç–µ–∫–∞—é—Ç –Ω–µ –∏–∑-–∑–∞ –∑–ª–æ–≥–æ —É–º—ã—Å–ª–∞, –∞ –ø–æ –Ω–µ–≤–Ω–∏–º–∞—Ç–µ–ª—å–Ω–æ—Å—Ç–∏. –ó–∞—â–∏—â–∞—Ç—å –∏—Ö –Ω—É–∂–Ω–æ —Å –ø–µ—Ä–≤–æ–≥–æ –∫–æ–º–º–∏—Ç–∞.

---

## üß† –¢–µ–æ—Ä–∏—è: —á—Ç–æ —Ç–∞–∫–æ–µ —Å–µ–∫—Ä–µ—Ç –≤ XXI?

–≠—Ç–æ –ª—é–±–∞—è —Å—Ç—Ä–æ–∫–∞, –∫–æ—Ç–æ—Ä–∞—è –¥–∞—ë—Ç –¥–æ—Å—Ç—É–ø:
- API-–∫–ª—é—á–∏ (Telegram Bot Token, OpenAI, Stripe)
- –ö—Ä–µ–¥—ã –±–∞–∑—ã –¥–∞–Ω–Ω—ã—Ö (`postgres://user:password@host`)
- –ö–ª—é—á–∏ —à–∏—Ñ—Ä–æ–≤–∞–Ω–∏—è (Rails `secret_key_base`)
- OAuth-–∫–ª–∏–µ–Ω—Ç—ã (`GOOGLE_CLIENT_SECRET=abc123`)

**–ì–ª–∞–≤–Ω–æ–µ –ø—Ä–∞–≤–∏–ª–æ**: –æ–Ω–∏ –Ω–∏–∫–æ–≥–¥–∞ –Ω–µ –¥–æ–ª–∂–Ω—ã –ø–æ–ø–∞–¥–∞—Ç—å –≤ Git-–∏—Å—Ç–æ—Ä–∏—é.

---

## üõ°Ô∏è –ó–∞—â–∏—Ç–Ω—ã–π —Å—Ç–µ–∫ –¥–ª—è Ruby-–ø—Ä–æ–µ–∫—Ç–∞

### 1. `.env` + `dotenv` ‚Äî –ª–æ–∫–∞–ª—å–Ω–∞—è —Ä–∞–∑—Ä–∞–±–æ—Ç–∫–∞

–£—Å—Ç–∞–Ω–∞–≤–ª–∏–≤–∞–µ–º –≥–µ–º:

```ruby
# Gemfile
gem 'dotenv-rails', groups: [:development, :test]
```

–°–æ–∑–¥–∞—ë–º `.env` (—É–∂–µ –≤ `.gitignore`!):

```bash
# .env
DATABASE_URL="postgres://user:password@localhost:5432/pet_project"
TELEGRAM_TOKEN="123:abc"
```

–ò –ø–æ–¥–≥—Ä—É–∂–∞–µ–º –≤ `application.rb`:

```ruby
# config/application.rb
Bundler.require(*Rails.groups)
Dotenv::Railtie.load if %w[development test].include?(Rails.env)
```

‚ö†Ô∏è **–ü—Ä–æ–≤–µ—Ä—å—Ç–µ**: `git check-ignore .env` –¥–æ–ª–∂–µ–Ω –≤–µ—Ä–Ω—É—Ç—å –ø—É—Ç—å.

---

### 2. `.gitignore` ‚Äî –ø–æ—Å–ª–µ–¥–Ω–∏–π —Ä—É–±–µ–∂

–î–∞–∂–µ –µ—Å–ª–∏ –∑–∞–±—ã–ª–∏ `git add .env`, `.gitignore` —Å–ø–∞—Å—ë—Ç:

```gitignore
# .gitignore
.env
*.env.local
.env*.local
```

---

### ‚ùå –ê–Ω—Ç–∏–ø–∞—Ç—Ç–µ—Ä–Ω: –º–æ–ª—á–∞—Ç—å, –µ—Å–ª–∏ –ø–µ—Ä–µ–º–µ–Ω–Ω–æ–π –æ–∫—Ä—É–∂–µ–Ω–∏—è –Ω–µ—Ç

–•—É–¥—à–µ–µ, —á—Ç–æ –º–æ–∂–Ω–æ —Å–¥–µ–ª–∞—Ç—å ‚Äî **–º–æ–ª—á–∞ –ø—Ä–æ–ø—É—Å—Ç–∏—Ç—å –æ—à–∏–±–∫—É** –∏–ª–∏, –µ—â—ë —Ö—É–∂–µ, –ø–æ–¥—Å—Ç–∞–≤–∏—Ç—å –¥–µ—Ñ–æ–ª—Ç–Ω–æ–µ –∑–Ω–∞—á–µ–Ω–∏–µ:

```yaml
# config/database.yml ‚Äî –ø–ª–æ—Ö–æ!
production:
  password: <%= ENV['DB_PASS'] %>
```

```yaml
# config/database.yml ‚Äî –µ—â—ë —Ö—É–∂–µ!
production:
  password: <%= ENV.fetch('DB_PASS', 'password') %> 
```

---

### ‚úÖ –ö–∞–∫ –ø—Ä–∞–≤–∏–ª—å–Ω–æ: fail fast

–ï—Å–ª–∏ –≤–∞–∂–Ω–æ–π –ø–µ—Ä–µ–º–µ–Ω–Ω–æ–π –æ–∫—Ä—É–∂–µ–Ω–∏—è –Ω–µ—Ç ‚Äî –ø—É—Å—Ç—å –ø—Ä–∏–ª–æ–∂–µ–Ω–∏–µ **—É–ø–∞–¥—ë—Ç —Å—Ä–∞–∑—É**, –≥—Ä–æ–º–∫–æ –∏ –ø–æ–Ω—è—Ç–Ω–æ:

```yaml
# config/database.yml ‚Äî —Ö–æ—Ä–æ—à–æ!
production:
  password: <%= ENV.fetch('DB_PASS') %>
```

üìå –≠—Ç–æ –≥–∞—Ä–∞–Ω—Ç–∏—Ä—É–µ—Ç, —á—Ç–æ –≤—ã –Ω–µ –∑–∞–ø—É—Å—Ç–∏—Ç–µ –ø—Ä–æ–¥ —Å –ø—É—Å—Ç—ã–º –∏–ª–∏ —Å–ª—É—á–∞–π–Ω—ã–º –∑–Ω–∞—á–µ–Ω–∏–µ–º. –õ—É—á—à–µ —Å–ª–æ–º–∞—Ç—å—Å—è –Ω–∞ —Å—Ç–∞—Ä—Ç–µ, —á–µ–º –ø—Ä–æ–ø—É—Å—Ç–∏—Ç—å —É—è–∑–≤–∏–º–æ—Å—Ç—å.

---

### 3. GitHub Secrets ‚Äî –±–µ–∑–æ–ø–∞—Å–Ω—ã–π –¥–µ–ø–ª–æ–π

–î–ª—è GitHub Actions:

1. –ò–¥—ë–º –≤ `Settings ‚Üí Secrets ‚Üí Actions`
2. –î–æ–±–∞–≤–ª—è–µ–º –∫–ª—é—á–∏ (–Ω–∞–ø—Ä–∏–º–µ—Ä, `RAILS_MASTER_KEY`)
3. –ò—Å–ø–æ–ª—å–∑—É–µ–º –≤ workflow:

{% raw %}
```yaml
# .github/workflows/deploy.yml
env:
  DATABASE_URL: ${{ secrets.PROD_DB_URL }}
steps:
  - run: rails db:migrate
```
{% endraw %}

**–í–∞–∂–Ω–æ**: –Ω–∏–∫–æ–≥–¥–∞ –Ω–µ –ª–æ–≥–∏—Ä—É–π—Ç–µ —Å–µ–∫—Ä–µ—Ç—ã!

```ruby
# –ü–ª–æ—Ö–æ:
Rails.logger.info("Connected to #{ENV['DB_URL']}") 
# –•–æ—Ä–æ—à–æ:
Rails.logger.info("Connected to database") 
```

---

## üí• –†–µ–∞–ª—å–Ω—ã–µ –∫–µ–π—Å—ã —É—Ç–µ—á–µ–∫

### –ö–µ–π—Å 1: Rails `secret_key_base` –≤ –æ—Ç–∫—Ä—ã—Ç–æ–º –¥–æ—Å—Ç—É–ø–µ
- **–ß—Ç–æ —Å–ª—É—á–∏–ª–æ—Å—å**: —Ä–∞–∑—Ä–∞–±–æ—Ç—á–∏–∫ –∑–∞–∫–æ–º–º–∏—Ç–∏–ª `config/secrets.yml` —Å –ø—Ä–æ–¥–∞–∫—à–Ω-–∫–ª—é—á–æ–º.
- **–ü–æ—Å–ª–µ–¥—Å—Ç–≤–∏—è**: –∞—Ç–∞–∫—É—é—â–∏–µ –ø–æ–¥–¥–µ–ª—ã–≤–∞–ª–∏ –∫—É–∫–∏ –∏ –ø–æ–ª—É—á–∞–ª–∏ –¥–æ—Å—Ç—É–ø –∫ –∞–¥–º–∏–Ω–∫–µ.
- **–†–µ—à–µ–Ω–∏–µ**: `credentials.yml.enc` + `master.key` –≤ `.gitignore`.

### –ö–µ–π—Å 2: AWS S3 Bucket —Å –ø—Ä–∞–≤–∞–º–∏ –Ω–∞ –∑–∞–ø–∏—Å—å
- **–ß—Ç–æ —Å–ª—É—á–∏–ª–æ—Å—å**: –∫–ª—é—á–∏ –ø–æ–ø–∞–ª–∏ –≤ –∏—Å—Ç–æ—Ä–∏—é Git, –±–æ—Ç –Ω–∞—á–∞–ª –∑–∞–ª–∏–≤–∞—Ç—å –º–µ–º—ã –≤ –±–∞–∫–µ—Ç.
- **–ü–æ—Å–ª–µ–¥—Å—Ç–≤–∏—è**: —Å—á—ë—Ç –∑–∞ —Ç—Ä–∞—Ñ–∏–∫ ‚Äî $300/–º–µ—Å—è—Ü.
- **–†–µ—à–µ–Ω–∏–µ**: IAM-—Ä–æ–ª–∏ —Å –º–∏–Ω–∏–º–∞–ª—å–Ω—ã–º–∏ –ø—Ä–∞–≤–∞–º–∏ + —Ä–µ–≥—É–ª—è—Ä–Ω–∞—è —Ä–æ—Ç–∞—Ü–∏—è.

---

## üß™ –¢–µ—Å—Ç–∏—Ä—É–µ–º –±–µ–∑–æ–ø–∞—Å–Ω–æ—Å—Ç—å

1. –ü—Ä–æ–≤–µ—Ä—è–µ–º —É—Ç–µ—á–∫–∏ –≤ –∏—Å—Ç–æ—Ä–∏–∏:
```bash
git log -p | grep -E 'password|token|key'
```

2. –°–∫–∞–Ω–∏—Ä—É–µ–º –∑–∞–≤–∏—Å–∏–º–æ—Å—Ç–∏:
```ruby
# Gemfile
gem 'bundler-audit'
gem 'brakeman'
```

3. –ê–≤—Ç–æ–º–∞—Ç–∏–∑–∏—Ä—É–µ–º –ø—Ä–æ–≤–µ—Ä–∫–∏ –≤ CI:
```yaml
# .github/workflows/security.yml
- name: Audit gems
  run: bundle audit check --update
```

---

## üé§ –ß—Ç–æ —Å–∫–∞–∑–∞—Ç—å –Ω–∞ —Å–æ–±–µ—Å–µ–¥–æ–≤–∞–Ω–∏–∏

> ‚Äî –ö–∞–∫ –≤—ã —Ö—Ä–∞–Ω–∏—Ç–µ —Å–µ–∫—Ä–µ—Ç—ã –≤ –ø—Ä–æ–µ–∫—Ç–∞—Ö?

‚Äî –ú—ã –∏—Å–ø–æ–ª—å–∑—É–µ–º –º–Ω–æ–≥–æ—É—Ä–æ–≤–Ω–µ–≤—É—é –∑–∞—â–∏—Ç—É: `.env` —Å `dotenv` –¥–ª—è —Ä–∞–∑—Ä–∞–±–æ—Ç–∫–∏, –∑–∞—à–∏—Ñ—Ä–æ–≤–∞–Ω–Ω—ã–µ credentials –¥–ª—è Rails, GitHub Secrets –¥–ª—è CI/CD. –í—Å–µ –∫–ª—é—á–∏ —Ä–æ—Ç–∏—Ä—É—é—Ç—Å—è, –∞ –¥–æ—Å—Ç—É–ø –ª–æ–≥–∏—Ä—É–µ—Ç—Å—è.

---

## ÔøΩ –í—ã–≤–æ–¥

**–°–µ–∫—Ä–µ—Ç—ã ‚Äî –∫–∞–∫ –∑—É–±–Ω–∞—è —â—ë—Ç–∫–∞: –Ω–µ–ª—å–∑—è –¥–∞–≤–∞—Ç—å –¥—Ä—É–≥–∏–º, –¥–∞–∂–µ "–Ω–∞ –º–∏–Ω—É—Ç–æ—á–∫—É".**  
–ú–∏–Ω–∏–º–∞–ª—å–Ω—ã–π —Å—Ç–µ–∫ –∑–∞—â–∏—Ç—ã (`dotenv` + `.gitignore` + Secrets) –∑–∞–π–º—ë—Ç 15 –º–∏–Ω—É—Ç, –Ω–æ —Å–ø–∞—Å—ë—Ç –æ—Ç:
- –£–¥–∞–ª—ë–Ω–Ω—ã—Ö –±–æ—Ç–æ–≤ ü§ñ
- –í–∑–ª–æ–º–∞–Ω–Ω—ã—Ö –±–∞–∑ üóÑÔ∏è
- –ù–µ–æ–∂–∏–¥–∞–Ω–Ω—ã—Ö —Å—á–µ—Ç–æ–≤ üí∏  
–ù–∞—á–Ω–∏—Ç–µ —Å –º–∞–ª–æ–≥–æ ‚Äî –∏ —Å–ø–∏—Ç–µ —Å–ø–æ–∫–æ–π–Ω–æ.  
