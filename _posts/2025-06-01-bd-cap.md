---
layout: post
subtitle: <div id="terminal"></div>
title: "CAP-—Ç–µ–æ—Ä–µ–º–∞ –∏ PostgreSQL: –ø–æ—á–µ–º—É –Ω–µ–ª—å–∑—è –∏–º–µ—Ç—å –≤—Å—ë —Å—Ä–∞–∑—É"
date: 2025-06-01 10:00:00 +0300
rate: 4
tags: CAP-—Ç–µ–æ—Ä–µ–º–∞,PostgreSQL,—Ä–∞—Å–ø—Ä–µ–¥–µ–ª—ë–Ω–Ω—ã–µ —Å–∏—Å—Ç–µ–º—ã,—Ä–µ–ø–ª–∏–∫–∞—Ü–∏—è,Rails,DevOps
version: A49X3
categories:
  - database
  - architecture
toc: true
menubar_toc: true
hero_image: /images/architecture.jpg
hero_darken: true
---
CAP-—Ç–µ–æ—Ä–µ–º–∞ ‚Äî —ç—Ç–æ –Ω–µ —Ç–æ–ª—å–∫–æ –ø—Ä–æ NoSQL: –≤ —Ä–∞—Å–ø—Ä–µ–¥–µ–ª—ë–Ω–Ω—ã—Ö —Å–∏—Å—Ç–µ–º–∞—Ö –Ω–∞ PostgreSQL, —Ç–∞–∫–∏—Ö –∫–∞–∫ –∫–ª–∞—Å—Ç–µ—Ä—ã —Å —Ä–µ–ø–ª–∏–∫–∞—Ü–∏–µ–π –∏–ª–∏ HA-—Ä–µ—à–µ–Ω–∏—è–º–∏, —Ä–∞–∑—Ä–∞–±–æ—Ç—á–∏–∫–∏ —Å—Ç–∞–ª–∫–∏–≤–∞—é—Ç—Å—è —Å —Ç–µ–º–∏ –∂–µ –∫–æ–º–ø—Ä–æ–º–∏—Å—Å–∞–º–∏ –º–µ–∂–¥—É –∫–æ–Ω—Å–∏—Å—Ç–µ–Ω—Ç–Ω–æ—Å—Ç—å—é, –¥–æ—Å—Ç—É–ø–Ω–æ—Å—Ç—å—é –∏ —É—Å—Ç–æ–π—á–∏–≤–æ—Å—Ç—å—é –∫ —Å–±–æ—è–º —Å–µ—Ç–∏. –ü–æ–Ω–∏–º–∞–Ω–∏–µ —ç—Ç–∏—Ö –ø—Ä–∏–Ω—Ü–∏–ø–æ–≤ –∫—Ä–∏—Ç–∏—á–Ω–æ –ø—Ä–∏ –ø—Ä–æ–µ–∫—Ç–∏—Ä–æ–≤–∞–Ω–∏–∏ –æ—Ç–∫–∞–∑–æ—É—Å—Ç–æ–π—á–∏–≤—ã—Ö Rails-–ø—Ä–∏–ª–æ–∂–µ–Ω–∏–π –∏ DevOps-–∏–Ω—Ñ—Ä–∞—Å—Ç—Ä—É–∫—Ç—É—Ä—ã, –≥–¥–µ –≤—ã–±–æ—Ä –º–µ–∂–¥—É —Å–∏–Ω—Ö—Ä–æ–Ω–Ω–æ–π –∏ –∞—Å–∏–Ω—Ö—Ä–æ–Ω–Ω–æ–π —Ä–µ–ø–ª–∏–∫–∞—Ü–∏–µ–π –º–æ–∂–µ—Ç –ø–æ–≤–ª–∏—è—Ç—å –Ω–∞ –Ω–∞–¥—ë–∂–Ω–æ—Å—Ç—å –≤—Å–µ–≥–æ —Å–µ—Ä–≤–∏—Å–∞.

---
–ï—Å–ª–∏ —Ç—ã —Ä–∞–±–æ—Ç–∞–µ—à—å —Å PostgreSQL –∏ —Å–ª—ã—à–∞–ª –ø—Ä–æ **CAP-—Ç–µ–æ—Ä–µ–º—É**, –Ω–æ –¥—É–º–∞–ª, —á—Ç–æ —ç—Ç–æ —Ç–æ–ª—å–∫–æ –ø—Ä–æ NoSQL ‚Äî —Å–∞–º–æ–µ –≤—Ä–µ–º—è –ø–µ—Ä–µ—Å–º–æ—Ç—Ä–µ—Ç—å –≤–∑–≥–ª—è–¥—ã.

## üìê –ß—Ç–æ —Ç–∞–∫–æ–µ CAP-—Ç–µ–æ—Ä–µ–º–∞?

CAP —Ä–∞—Å—à–∏—Ñ—Ä–æ–≤—ã–≤–∞–µ—Ç—Å—è –∫–∞–∫:

- **C** ‚Äî *Consistency* (–ö–æ–Ω—Å–∏—Å—Ç–µ–Ω—Ç–Ω–æ—Å—Ç—å)
- **A** ‚Äî *Availability* (–î–æ—Å—Ç—É–ø–Ω–æ—Å—Ç—å)
- **P** ‚Äî *Partition tolerance* (–£—Å—Ç–æ–π—á–∏–≤–æ—Å—Ç—å –∫ —Ä–∞–∑–¥–µ–ª–µ–Ω–∏—é —Å–µ—Ç–∏)

üìå –°–æ–≥–ª–∞—Å–Ω–æ —Ç–µ–æ—Ä–µ–º–µ:  
> –í —É—Å–ª–æ–≤–∏—è—Ö —Å–µ—Ç–µ–≤–æ–≥–æ —Ä–∞–∑–¥–µ–ª–µ–Ω–∏—è –Ω–µ–≤–æ–∑–º–æ–∂–Ω–æ –æ–¥–Ω–æ–≤—Ä–µ–º–µ–Ω–Ω–æ –æ–±–µ—Å–ø–µ—á–∏—Ç—å –∫–æ–Ω—Å–∏—Å—Ç–µ–Ω—Ç–Ω–æ—Å—Ç—å –∏ –¥–æ—Å—Ç—É–ø–Ω–æ—Å—Ç—å.

---

## üß† –ö–∞–∫ —ç—Ç–æ —Å–≤—è–∑–∞–Ω–æ —Å PostgreSQL?

–í –æ–±—ã—á–Ω–æ–π (–ª–æ–∫–∞–ª—å–Ω–æ–π) —É—Å—Ç–∞–Ω–æ–≤–∫–µ PostgreSQL —É —Ç–µ–±—è **–≤—Å—ë —Ö–æ—Ä–æ—à–æ**:  
‚úÖ –ö–æ–Ω—Å–∏—Å—Ç–µ–Ω—Ç–Ω–æ—Å—Ç—å  
‚úÖ –î–æ—Å—Ç—É–ø–Ω–æ—Å—Ç—å  
üö´ –ù–µ—Ç —Ä–∞–∑–¥–µ–ª–µ–Ω–∏—è —Å–µ—Ç–∏ (–æ–Ω–æ –∏ –Ω–µ –Ω—É–∂–Ω–æ)

–ù–æ –≤ –º–æ–º–µ–Ω—Ç, –∫–æ–≥–¥–∞ —Ç—ã:

- –î–µ–ª–∞–µ—à—å —Ä–µ–ø–ª–∏–∫–∞—Ü–∏—é
- –ò—Å–ø–æ–ª—å–∑—É–µ—à—å –∫–ª–∞—Å—Ç–µ—Ä (Patroni, Citus)
- –î–æ–±–∞–≤–ª—è–µ—à—å HA (High Availability)

—Ç—ã **–≤—Ö–æ–¥–∏—à—å –≤ –º–∏—Ä —Ä–∞—Å–ø—Ä–µ–¥–µ–ª—ë–Ω–Ω—ã—Ö —Å–∏—Å—Ç–µ–º**.

---

## üí£ –ü—Ä–∏–º–µ—Ä –ø—Ä–æ–±–ª–µ–º—ã CAP –≤ PostgreSQL-–∫–ª–∞—Å—Ç–µ—Ä–µ

### –°—Ü–µ–Ω–∞—Ä–∏–π:

1. –£ —Ç–µ–±—è –µ—Å—Ç—å master –∏ —Ä–µ–ø–ª–∏–∫–∞.
2. –°–µ—Ç—å –ø–∞–¥–∞–µ—Ç –º–µ–∂–¥—É –Ω–∏–º–∏.
3. –†–µ–ø–ª–∏–∫–∞ —Å—Ç–∞–Ω–æ–≤–∏—Ç—Å—è –Ω–æ–≤—ã–º –º–∞—Å—Ç–µ—Ä–æ–º (failover).
4. –°—Ç–∞—Ä–∞—è –Ω–æ–¥–∞ –≤–æ–∑–≤—Ä–∞—â–∞–µ—Ç—Å—è.

–ï—Å–ª–∏ —Ç—ã –ø—Ä–æ–¥–æ–ª–∂–∞–ª –ø–∏—Å–∞—Ç—å –≤ —Å—Ç–∞—Ä–æ–≥–æ –º–∞—Å—Ç–µ—Ä–∞, –ø–æ–ª—É—á–∞–µ—à—å **—Ä–∞—Å—Å–∏–Ω—Ö—Ä–æ–Ω** –∏ **–ø–æ—Ç–µ—Ä—é –∫–æ–Ω—Å–∏—Å—Ç–µ–Ω—Ç–Ω–æ—Å—Ç–∏**. –≠—Ç–æ –∫–æ–º–ø—Ä–æ–º–∏—Å—Å –º–µ–∂–¥—É *Availability* –∏ *Consistency*.

---

## ‚öôÔ∏è –ö–∞–∫–∏–µ —Ä–µ–∂–∏–º—ã —Å—É—â–µ—Å—Ç–≤—É—é—Ç?

| –†–µ–∂–∏–º                | C | A | P | –ü—Ä–∏–º–µ—Ä                    |
|----------------------|---|---|---|---------------------------|
| Single-node          | ‚úÖ | ‚úÖ | ‚ùå | –õ–æ–∫–∞–ª—å–Ω—ã–π PostgreSQL      |
| –°–∏–Ω—Ö—Ä–æ–Ω–Ω–∞—è —Ä–µ–ø–ª–∏–∫–∞—Ü–∏—è | ‚úÖ | ‚ùå | ‚úÖ | –¢–æ–ª—å–∫–æ –æ–¥–∏–Ω –º–∞—Å—Ç–µ—Ä        |
| –ê—Å–∏–Ω—Ö—Ä–æ–Ω–Ω–∞—è —Ä–µ–ø–ª–∏–∫–∞—Ü–∏—è | ‚ùå | ‚úÖ | ‚úÖ | –í–æ–∑–º–æ–∂–µ–Ω data loss –ø—Ä–∏ —Å–±–æ–µ |
| etcd + Patroni       | üîÅ | üîÅ | ‚úÖ | –ë–∞–ª–∞–Ω—Å –∑–∞–≤–∏—Å–∏—Ç –æ—Ç –Ω–∞—Å—Ç—Ä–æ–π–∫–∏ |

---

## üîç –ß—Ç–æ –¥–µ–ª–∞—Ç—å?

- **–ü–æ–Ω–∏–º–∞—Ç—å**, —á—Ç–æ –æ—Ç–∫–∞–∑–æ—É—Å—Ç–æ–π—á–∏–≤–æ—Å—Ç—å ‚â† –∫–æ–Ω—Å–∏—Å—Ç–µ–Ω—Ç–Ω–æ—Å—Ç—å
- –ò—Å–ø–æ–ª—å–∑–æ–≤–∞—Ç—å **logical replication**, –µ—Å–ª–∏ —Ç–µ–±–µ –Ω—É–∂–µ–Ω –∫–æ–Ω—Ç—Ä–æ–ª—å
- –ù–∞—Å—Ç—Ä–æ–∏—Ç—å **Synchronous Commit** —Å quorum ‚Äî –Ω–æ –ø–æ–Ω–∏–º–∞—Ç—å —Ä–∏—Å–∫–∏
- –£—á–∏—Ç—ã–≤–∞—Ç—å CAP –ø—Ä–∏ –≤—ã–±–æ—Ä–µ –∞—Ä—Ö–∏—Ç–µ–∫—Ç—É—Ä—ã

---

## üìå –í—ã–≤–æ–¥

PostgreSQL ‚Äî —ç—Ç–æ –Ω–µ –ø—Ä–æ—Å—Ç–æ –ª–æ–∫–∞–ª—å–Ω–∞—è –±–∞–∑–∞. –ö–∞–∫ —Ç–æ–ª—å–∫–æ —Ç—ã –Ω–∞—á–∏–Ω–∞–µ—à—å —Å—Ç—Ä–æ–∏—Ç—å –æ—Ç–∫–∞–∑–æ—É—Å—Ç–æ–π—á–∏–≤–æ—Å—Ç—å, —Ç—ã **–≤—Å—Ç—É–ø–∞–µ—à—å –Ω–∞ —Ç–µ—Ä—Ä–∏—Ç–æ—Ä–∏—é CAP-—Ç–µ–æ—Ä–µ–º—ã**. –ò —Ç–µ–±–µ –ø—Ä–∏–¥—ë—Ç—Å—è –¥–µ–ª–∞—Ç—å –≤—ã–±–æ—Ä: –∏–ª–∏ —Ç—ã —Ç–µ—Ä—è–µ—à—å –¥–∞–Ω–Ω—ã–µ, –∏–ª–∏ –∂–¥—ë—à—å –¥–æ—Å—Ç—É–ø–Ω–æ—Å—Ç–∏. –í–æ–ª—à–µ–±—Å—Ç–≤–∞ –Ω–µ –±—ã–≤–∞–µ—Ç ‚Äî —Ç–æ–ª—å–∫–æ –∫–æ–º–ø—Ä–æ–º–∏—Å—Å—ã.
