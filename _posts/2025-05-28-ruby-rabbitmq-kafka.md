---
layout: post
title: "Ruby, RabbitMQ –∏–ª–∏ Kafka ‚Äî —á—Ç–æ –≤—ã–±—Ä–∞—Ç—å –∏ –∑–∞—á–µ–º?"
subtitle: <div id="terminal"></div>
date:  2025-05-28 12:00:00 +0300
tags: Ruby, RabbitMQ,Kafka,message brokers,event streaming,–±—Ä–æ–∫–µ—Ä—ã —Å–æ–æ–±—â–µ–Ω–∏–π
categories: 
  - architecture
  - rails
  - performance
hero_image: /images/posts/42.jpg
hero_darken: true
toc: true
menubar_toc: true
---

## –í–≤–µ–¥–µ–Ω–∏–µ: –∑–∞—á–µ–º –Ω–∞–º —ç—Ç–∏ –æ—á–µ—Ä–µ–¥–∏?

–ü—Ä–µ–¥—Å—Ç–∞–≤—å—Ç–µ: –≤–∞—à Ruby-—Å–µ—Ä–≤–∏—Å –ø–æ–ª—É—á–∞–µ—Ç —Ç—ã—Å—è—á–∏ –∑–∞–ø—Ä–æ—Å–æ–≤ –≤ —Å–µ–∫—É–Ω–¥—É, –∏ –∫–∞–∂–¥—ã–π —Ç—Ä–µ–±—É–µ—Ç –æ—Ç–ø—Ä–∞–≤–∫–∏ email, –æ–±–Ω–æ–≤–ª–µ–Ω–∏—è –∞–Ω–∞–ª–∏—Ç–∏–∫–∏ –∏ –∑–∞–ø–∏—Å–∏ –≤ –ª–æ–≥. –ï—Å–ª–∏ –¥–µ–ª–∞—Ç—å —ç—Ç–æ —Å–∏–Ω—Ö—Ä–æ–Ω–Ω–æ ‚Äî –ø–æ–ª—å–∑–æ–≤–∞—Ç–µ–ª–∏ –±—É–¥—É—Ç –∂–¥–∞—Ç—å –∫–∞–∫ –≤ –æ—á–µ—Ä–µ–¥–∏ –∑–∞ –Ω–æ–≤—ã–º iPhone. 

–í–æ—Ç –≥–¥–µ –ø–æ—è–≤–ª—è—é—Ç—Å—è **RabbitMQ** (–ø–æ—á—Ç–∞–ª—å–æ–Ω) –∏ **Kafka** (–≥–∏–≥–∞–Ω—Ç—Å–∫–∏–π –∫–æ–Ω–≤–µ–π–µ—Ä). –û–Ω–∏ –±–µ—Ä—É—Ç –Ω–∞–≥—Ä—É–∑–∫—É –Ω–∞ —Å–µ–±—è, –∞ –≤–∞—à –∫–æ–¥ —Å–ø–æ–∫–æ–π–Ω–æ –∑–∞–Ω–∏–º–∞–µ—Ç—Å—è —Å–≤–æ–∏–º –¥–µ–ª–æ–º.

---

## RabbitMQ: –Ω–∞–¥–µ–∂–Ω—ã–π –ø–æ—á—Ç–∞–ª—å–æ–Ω

### –ü–ª—é—Å—ã üéØ
- **–ü—Ä–æ—Å—Ç–æ—Ç–∞**: –ü–æ–¥–Ω—è—Ç—å –±—Ä–æ–∫–µ—Ä ‚Äî `brew install rabbitmq`, –∏ –≥–æ—Ç–æ–≤–æ.
- **–ì–∏–±–∫–æ—Å—Ç—å**: –û—á–µ—Ä–µ–¥–∏, –ø—É–±–ª–∏–∫–∞—Ü–∏—è/–ø–æ–¥–ø–∏—Å–∫–∞ (pub/sub), —Ä–æ—É—Ç–∏–Ω–≥ —Å–æ–æ–±—â–µ–Ω–∏–π.
- **–ù–∞–¥–µ–∂–Ω–æ—Å—Ç—å**: –ü–æ–¥—Ç–≤–µ—Ä–∂–¥–µ–Ω–∏—è (ack), –ø–æ–≤—Ç–æ—Ä–Ω—ã–µ –ø–æ–ø—ã—Ç–∫–∏, dead letter queues.

### –ú–∏–Ω—É—Å—ã ‚ö†Ô∏è
- **–ù–µ –¥–ª—è big data**: –ï—Å–ª–∏ —Å–æ–æ–±—â–µ–Ω–∏–π –±–æ–ª—å—à–µ –º–∏–ª–ª–∏–æ–Ω–∞ –≤ –¥–µ–Ω—å ‚Äî –Ω–∞—á–∏–Ω–∞–µ—Ç —Ö—Ä–∏–ø–µ—Ç—å.
- **–ù–µ—Ç –∏—Å—Ç–æ—Ä–∏–∏**: –°–æ–æ–±—â–µ–Ω–∏—è –∏—Å—á–µ–∑–∞—é—Ç –ø–æ—Å–ª–µ –æ–±—Ä–∞–±–æ—Ç–∫–∏ (–µ—Å–ª–∏ –Ω–µ –Ω–∞—Å—Ç—Ä–æ–µ–Ω–æ –∏–Ω–æ–µ).

### –ö–æ–≥–¥–∞ –∏—Å–ø–æ–ª—å–∑–æ–≤–∞—Ç—å —Å Ruby?
```ruby
# –¢–∏–ø–∏—á–Ω—ã–π –ø—Ä–∏–º–µ—Ä: —Ñ–æ–Ω–æ–≤—ã–µ –∑–∞–¥–∞—á–∏ –≤ Rails
class UserNotifier
  include Sneakers::Worker
  from_queue 'user_emails'

  def work(message)
    user = User.find(JSON.parse(message)['user_id'])
    UserMailer.welcome(user).deliver_now
    ack! # –ü–æ–¥—Ç–≤–µ—Ä–∂–¥–∞–µ–º –æ–±—Ä–∞–±–æ—Ç–∫—É
  end
end
```
**–ò–¥–µ–∞–ª—å–Ω–æ –¥–ª—è:**
- –û—á–µ—Ä–µ–¥–µ–π –∑–∞–¥–∞—á (Sidekiq –∞–ª—å—Ç–µ—Ä–Ω–∞—Ç–∏–≤–∞)
- –§–æ–Ω–æ–≤–æ–π –æ—Ç–ø—Ä–∞–≤–∫–∏ email/SMS
- –ú–∏–∫—Ä–æ—Å–µ—Ä–≤–∏—Å–Ω–æ–≥–æ –≤–∑–∞–∏–º–æ–¥–µ–π—Å—Ç–≤–∏—è

---

## Kafka: –∫–æ–Ω–≤–µ–π–µ—Ä –¥–ª—è –¥–∞–Ω–Ω—ã—Ö

### –ü–ª—é—Å—ã üöÄ
- **–°–∫–æ—Ä–æ—Å—Ç—å**: –û–±—Ä–∞–±–∞—Ç—ã–≤–∞–µ—Ç –º–∏–ª–ª–∏–æ–Ω—ã —Å–æ–æ–±—â–µ–Ω–∏–π –≤ —Å–µ–∫—É–Ω–¥—É.
- **–ù–∞–¥–µ–∂–Ω–æ—Å—Ç—å**: –°–æ–æ–±—â–µ–Ω–∏—è —Ö—Ä–∞–Ω—è—Ç—Å—è (–¥–Ω–∏/–Ω–µ–¥–µ–ª–∏) –∏ –º–æ–≥—É—Ç –±—ã—Ç—å –ø–µ—Ä–µ—á–∏—Ç–∞–Ω—ã.
- **–ú–∞—Å—à—Ç–∞–±–∏—Ä—É–µ–º–æ—Å—Ç—å**: –õ–µ–≥–∫–æ –¥–æ–±–∞–≤–ª—è—Ç—å –Ω–æ–≤—ã–µ —É–∑–ª—ã.

### –ú–∏–Ω—É—Å—ã ‚ö†Ô∏è
- **–°–ª–æ–∂–Ω–æ—Å—Ç—å**: –¢—Ä–µ–±—É–µ—Ç ZooKeeper, –Ω–∞—Å—Ç—Ä–æ–π–∫–∞ ‚Äî –Ω–µ –¥–ª—è —Å–ª–∞–±–æ–Ω–µ—Ä–≤–Ω—ã—Ö.
- **Overkill**: –î–ª—è 100 —Å–æ–æ–±—â–µ–Ω–∏–π –≤ –¥–µ–Ω—å ‚Äî –∫–∞–∫ —Å—Ç—Ä–µ–ª—è—Ç—å –∏–∑ –ø—É—à–∫–∏ –ø–æ –≤–æ—Ä–æ–±—å—è–º.

### Ruby + Kafka –ø—Ä–∏–º–µ—Ä:
```ruby
# –û—Ç–ø—Ä–∞–≤–∫–∞ —Å–æ–±—ã—Ç–∏–π –≤ Kafka
WaterDrop.setup do |config|
  config.deliver = true
  config.kafka = { 'bootstrap.servers': 'localhost:9092' }
end

event = {
  user_id: 42,
  event: 'purchase',
  amount: 99.99,
  timestamp: Time.now.utc.iso8601
}

WaterDrop::SyncProducer.call(event.to_json, topic: 'user_events')
```
**–ò–¥–µ–∞–ª—å–Ω–æ –¥–ª—è:**
- –ê–Ω–∞–ª–∏—Ç–∏–∫–∏ –≤ —Ä–µ–∞–ª—å–Ω–æ–º –≤—Ä–µ–º–µ–Ω–∏
- –õ–æ–≥–∏—Ä–æ–≤–∞–Ω–∏—è –¥–µ–π—Å—Ç–≤–∏–π –ø–æ–ª—å–∑–æ–≤–∞—Ç–µ–ª–µ–π
- –°–∏–Ω—Ö—Ä–æ–Ω–∏–∑–∞—Ü–∏–∏ –¥–∞–Ω–Ω—ã—Ö –º–µ–∂–¥—É —Å–µ—Ä–≤–∏—Å–∞–º–∏

---

## –°—Ä–∞–≤–Ω–µ–Ω–∏–µ: RabbitMQ vs Kafka

| –ü–∞—Ä–∞–º–µ—Ç—Ä        | RabbitMQ               | Kafka                  |
|-----------------|------------------------|------------------------|
| **–°–∫–æ—Ä–æ—Å—Ç—å**    | –î–æ ~50K msg/sec        | –ú–∏–ª–ª–∏–æ–Ω—ã msg/sec       |
| **–ù–∞–¥–µ–∂–Ω–æ—Å—Ç—å**  | –û—Ç–ª–∏—á–Ω–∞—è               | –ò–¥–µ–∞–ª—å–Ω–∞—è              |
| **–°–ª–æ–∂–Ω–æ—Å—Ç—å**   | –ü—Ä–æ—Å—Ç–æ                 | –°—Ä–µ–¥–Ω–µ-—Å–ª–æ–∂–Ω–æ          |
| **–î–∞–Ω–Ω—ã–µ**      | –≠—Ñ–µ–º–µ—Ä–Ω—ã–µ              | –ü–µ—Ä—Å–∏—Å—Ç–µ–Ω—Ç–Ω—ã–µ          |
| **Ruby –≥–µ–º—ã**   | bunny, sneakers        | rdkafka, racecar       |
| **–ö–æ–≥–¥–∞**       | –ó–∞–¥–∞—á–∏, —É–≤–µ–¥–æ–º–ª–µ–Ω–∏—è    | –ü–æ—Ç–æ–∫–∏ —Å–æ–±—ã—Ç–∏–π, –∞–Ω–∞–ª–∏—Ç–∏–∫–∞ |

---

## –ü—Ä–∞–∫—Ç–∏–∫–∞: –∫–æ–≥–¥–∞ —á—Ç–æ –≤—ã–±—Ä–∞—Ç—å?

**–í—ã–±–∏—Ä–∞–π—Ç–µ RabbitMQ –µ—Å–ª–∏:**
- –ù—É–∂–Ω—ã —Ñ–æ–Ω–æ–≤—ã–µ –∑–∞–¥–∞—á–∏ (–∫–∞–∫ Sidekiq, –Ω–æ —Å –±—Ä–æ–∫–µ—Ä–æ–º)
- –í–∞–∂–µ–Ω –ø—Ä–æ—Å—Ç–æ–π dead letter queue –¥–ª—è –Ω–µ—É–¥–∞—á–Ω—ã—Ö –∑–∞–¥–∞—á
- –°–æ–æ–±—â–µ–Ω–∏—è –¥–æ–ª–∂–Ω—ã –±—ã—Ç—å –¥–æ—Å—Ç–∞–≤–ª–µ–Ω—ã –±—ã—Å—Ç—Ä–æ, –Ω–æ –Ω–µ –Ω—É–∂–Ω—ã –ø–æ–∑–∂–µ

**–í—ã–±–∏—Ä–∞–π—Ç–µ Kafka –µ—Å–ª–∏:**
- –°–æ–±—ã—Ç–∏—è –Ω—É–∂–Ω—ã –Ω–µ—Å–∫–æ–ª—å–∫–∏–º –ø–æ—Ç—Ä–µ–±–∏—Ç–µ–ª—è–º (–∞–Ω–∞–ª–∏—Ç–∏–∫–∞, –ª–æ–≥–∏, –Ω–æ—Ç–∏—Ñ–∏–∫–∞—Ü–∏–∏)
- –ù—É–∂–Ω–∞ –≤–æ–∑–º–æ–∂–Ω–æ—Å—Ç—å "–ø–µ—Ä–µ–º–æ—Ç–∞—Ç—å" –∏ –ø–µ—Ä–µ—á–∏—Ç–∞—Ç—å —Å—Ç–∞—Ä—ã–µ —Å–æ–æ–±—â–µ–Ω–∏—è
- –û–∂–∏–¥–∞–µ—Ç—Å—è —Ä–æ—Å—Ç –Ω–∞–≥—Ä—É–∑–∫–∏ –≤ 10-100 —Ä–∞–∑

---

## –ê–Ω—Ç–∏–ø–∞—Ç—Ç–µ—Ä–Ω—ã: –∫–æ–≥–¥–∞ –Ω–µ —Å—Ç–æ–∏—Ç –∏—Å–ø–æ–ª—å–∑–æ–≤–∞—Ç—å

### –î–ª—è RabbitMQ:
- **–•—Ä–∞–Ω–µ–Ω–∏–µ –¥–∞–Ω–Ω—ã—Ö**: –≠—Ç–æ –Ω–µ –±–∞–∑–∞ –¥–∞–Ω–Ω—ã—Ö!
- **–û—á–µ–Ω—å –±–æ–ª—å—à–∏–µ —Å–æ–æ–±—â–µ–Ω–∏—è**: > 1MB ‚Äî —É–∂–µ –ø—Ä–æ–±–ª–µ–º–∞.
- **–°–ª–æ–∂–Ω—ã–µ –º–∞—Ä—à—Ä—É—Ç—ã**: –ï—Å–ª–∏ —Ä–æ—É—Ç–∏–Ω–≥ —Å—Ç–∞–Ω–æ–≤–∏—Ç—Å—è —É–º–Ω–µ–µ —Å–∞–º–æ–≥–æ –ø—Ä–∏–ª–æ–∂–µ–Ω–∏—è.

### –î–ª—è Kafka:
- **–ú–∞–ª–µ–Ω—å–∫–∏–µ –ø—Ä–æ–µ–∫—Ç—ã**: –ü–æ–¥–¥–µ—Ä–∂–∫–∞ –∫–ª–∞—Å—Ç–µ—Ä–∞ –Ω–µ —Å—Ç–æ–∏—Ç —É—Å–∏–ª–∏–π.
- **–°—Ä–æ—á–Ω—ã–µ —Å–æ–æ–±—â–µ–Ω–∏—è**: –õ–∞–≥ –≤ 100ms ‚Äî —ç—Ç–æ –Ω–æ—Ä–º–∞ –¥–ª—è Kafka.
- **–ë–µ–∑ DevOps**: –í –æ–¥–∏–Ω–æ—á–∫—É –∞–¥–º–∏–Ω–∏—Ç—å –∫–ª–∞—Å—Ç–µ—Ä ‚Äî –±–æ–ª—å.
- **–ò—Å–ø–æ–ª—å–∑–æ–≤–∞—Ç—å —Ç–æ–ª—å–∫–æ –∫–∞–∫ ‚Äú"–æ—á–µ—Ä–µ–¥—å –∑–∞–¥–∞—á"** ‚Äî —ç—Ç–æ —á–∞—Å—Ç—ã–π –∏ –≤—Ä–µ–¥–Ω—ã–π –∞–Ω—Ç–∏–ø–∞—Ç—Ç–µ—Ä–Ω 
    > ‚ö†Ô∏è Kafka –¥–ª—è —ç—Ç–æ–≥–æ –Ω–µ –æ–ø—Ç–∏–º–∞–ª—å–Ω–∞.

---

## –ó–∞–∫–ª—é—á–µ–Ω–∏–µ: –ø–æ—á—Ç–∞–ª—å–æ–Ω –∏–ª–∏ –∫–æ–Ω–≤–µ–π–µ—Ä?

–í—ã–±–æ—Ä –º–µ–∂–¥—É RabbitMQ –∏ Kafka ‚Äî —ç—Ç–æ –∫–∞–∫ –≤—ã–±–æ—Ä –º–µ–∂–¥—É –≤–µ–ª–æ—Å–∏–ø–µ–¥–æ–º –∏ –≥—Ä—É–∑–æ–≤–∏–∫–æ–º. 

–ù—É–∂–Ω–æ –¥–æ—Å—Ç–∞–≤–∏—Ç—å –ø–∞—Ä—É –ø–∏—Å–µ–º? –ë–µ—Ä–∏—Ç–µ RabbitMQ ‚Äî –ø—Ä–æ—Å—Ç–æ–π –∏ –Ω–∞–¥–µ–∂–Ω—ã–π. 
–ó–∞–ø—É—Å–∫–∞–µ—Ç–µ —Ü–∏—Ñ—Ä–æ–≤—É—é —Ñ–∞–±—Ä–∏–∫—É –¥–∞–Ω–Ω—ã—Ö? –¢–æ–≥–¥–∞ Kafka ‚Äî –≤–∞—à –º–æ—â–Ω—ã–π –∫–æ–Ω–≤–µ–π–µ—Ä.

–ê –µ—Å–ª–∏ —Å–æ–º–Ω–µ–≤–∞–µ—Ç–µ—Å—å ‚Äî –Ω–∞—á–Ω–∏—Ç–µ —Å RabbitMQ. –ö–æ–≥–¥–∞ –æ–Ω –Ω–∞—á–Ω–µ—Ç –∑–∞–¥—ã—Ö–∞—Ç—å—Å—è –ø–æ–¥ –Ω–∞–≥—Ä—É–∑–∫–æ–π, –≤—ã —Ç–æ—á–Ω–æ –ø–æ–π–º–µ—Ç–µ, —á—Ç–æ –ø–æ—Ä–∞ –ø–µ—Ä–µ—Ö–æ–¥–∏—Ç—å –Ω–∞ Kafka.

---

## –ß–µ–∫-–ª–∏—Å—Ç –≤—ã–±–æ—Ä–∞

–í—ã–±–µ—Ä–∏—Ç–µ RabbitMQ –µ—Å–ª–∏:
- ‚úÖ –ù—É–∂–Ω—ã –æ—á–µ—Ä–µ–¥–∏ –∑–∞–¥–∞—á  
- ‚úÖ –°–æ–æ–±—â–µ–Ω–∏—è –æ–±—Ä–∞–±–∞—Ç—ã–≤–∞—é—Ç—Å—è –æ–¥–∏–Ω —Ä–∞–∑  
- ‚úÖ –•–æ—á–µ—Ç—Å—è –ø—Ä–æ—Å—Ç–æ—Ç–∞ –∏ –±—ã—Å—Ç—Ä–æ—Ç–∞ –Ω–∞—Å—Ç—Ä–æ–π–∫–∏  

–í—ã–±–µ—Ä–∏—Ç–µ Kafka –µ—Å–ª–∏:
- ‚úÖ –î–∞–Ω–Ω—ã–µ –Ω—É–∂–Ω—ã –º–Ω–æ–≥–∏–º –ø–æ—Ç—Ä–µ–±–∏—Ç–µ–ª—è–º  
- ‚úÖ –ù—É–∂–Ω–∞ –∏—Å—Ç–æ—Ä–∏—è —Å–æ–æ–±—â–µ–Ω–∏–π  
- ‚úÖ –û–∂–∏–¥–∞–µ—Ç—Å—è –≤—ã—Å–æ–∫–∞—è –Ω–∞–≥—Ä—É–∑–∫–∞  

–ò –ø–æ–º–Ω–∏—Ç–µ: –ª—É—á—à–∏–π –∏–Ω—Å—Ç—Ä—É–º–µ–Ω—Ç ‚Äî —Ç–æ—Ç, –∫–æ—Ç–æ—Ä—ã–π —Ä–µ—à–∞–µ—Ç –≤–∞—à—É –∑–∞–¥–∞—á—É, –∞ –Ω–µ —Ç–æ—Ç, —á—Ç–æ –≤ —Ç—Ä–µ–Ω–¥–µ üòâ
