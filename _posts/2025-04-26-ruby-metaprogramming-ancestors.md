---
layout: post
subtitle: <div id="terminal"></div>
title:  "üîó –ù–∞—Å–ª–µ–¥–æ–≤–∞–Ω–∏–µ –≤ Ruby: included, extended –∏ –¥—Ä—É–≥–∏–µ –º–∞–≥–∏—á–µ—Å–∫–∏–µ –º–µ—Ç–æ–¥—ã"
date:   2025-04-26 13:00:00 +0300
rate: 4
tags: Ruby,–Ω–∞—Å–ª–µ–¥–æ–≤–∞–Ω–∏–µ,–º–µ—Ç–∞–∫–ª–∞—Å—Å—ã,–º–æ–¥—É–ª–∏,OOP
version: 3.2.2
categories:
  - ruby
hero_image: /images/posts/52.jpg
hero_darken: true
toc: true
menubar_toc: true
---
–ù–∞—Å–ª–µ–¥–æ–≤–∞–Ω–∏–µ –≤ Ruby ‚Äî —ç—Ç–æ –Ω–µ –ø—Ä–æ—Å—Ç–æ `class Child < Parent`. –≠—Ç–æ —Ü–µ–ª—ã–π –∞—Ä—Å–µ–Ω–∞–ª –º–µ—Ç–æ–¥–æ–≤ –¥–ª—è —Ç–æ–Ω–∫–æ–π –Ω–∞—Å—Ç—Ä–æ–π–∫–∏ –ø–æ–≤–µ–¥–µ–Ω–∏—è –∫–ª–∞—Å—Å–æ–≤. –í —Å—Ç–∞—Ç—å–µ —Ä–∞–∑–±–µ—Ä—ë–º –∫–ª—é—á–µ–≤—ã–µ –∏–Ω—Å—Ç—Ä—É–º–µ–Ω—Ç—ã —Ä–∞–±–æ—Ç—ã —Å –∏–µ—Ä–∞—Ä—Ö–∏–µ–π: –æ—Ç –±–∞–∑–æ–≤–æ–≥–æ `superclass` –¥–æ –º–∞–≥–∏–∏ `prepended` –º–æ–¥—É–ª–µ–π, –∏ –ø–æ–∫–∞–∂–µ–º, –∫–∞–∫ –∏–∑–±–µ–∂–∞—Ç—å "—Ü–µ–ø–æ—á–∫–∏ –∑–æ–º–±–∏" –≤ —Å–ª–æ–∂–Ω—ã—Ö –ø—Ä–æ–µ–∫—Ç–∞—Ö.

---
–í—ã –∫–æ–≥–¥–∞-–Ω–∏–±—É–¥—å –≤–∏–¥–µ–ª–∏ –∫–æ–¥, –≥–¥–µ `ancestors` –≤–æ–∑–≤—Ä–∞—â–∞–µ—Ç –º–∞—Å—Å–∏–≤ –¥–ª–∏–Ω–Ω–µ–µ —Å–ø–∏—Å–∫–∞ –ø–æ–∫—É–ø–æ–∫ –Ω–∞ –Ω–µ–¥–µ–ª—é?  
–ü–æ—Ä–∞ —Ä–∞–∑–æ–±—Ä–∞—Ç—å—Å—è, –∫—Ç–æ –∑–¥–µ—Å—å –≥–ª–∞–≤–Ω—ã–π –≤ –∏–µ—Ä–∞—Ä—Ö–∏–∏ –Ω–∞—Å–ª–µ–¥–æ–≤–∞–Ω–∏—è.

---

## üß† –¢–µ–æ—Ä–∏—è: –∫–∞–∫ Ruby –∏—â–µ—Ç –º–µ—Ç–æ–¥—ã?

–ö–æ–≥–¥–∞ –≤—ã –≤—ã–∑—ã–≤–∞–µ—Ç–µ `object.method`, Ruby:

1. –°–º–æ—Ç—Ä–∏—Ç –≤ **–∫–ª–∞—Å—Å –æ–±—ä–µ–∫—Ç–∞**
2. –ò–¥—ë—Ç –ø–æ **—Ü–µ–ø–æ—á–∫–µ –º–æ–¥—É–ª–µ–π** (–µ—Å–ª–∏ –µ—Å—Ç—å `prepend` –∏–ª–∏ `include`)
3. –ü—Ä–æ–≤–µ—Ä—è–µ—Ç **—Ä–æ–¥–∏—Ç–µ–ª—å—Å–∫–∏–π –∫–ª–∞—Å—Å**
4. –ü–æ–≤—Ç–æ—Ä—è–µ—Ç —à–∞–≥–∏ 1-3 –¥–ª—è —Å—É–ø–µ—Ä–∫–ª–∞—Å—Å–æ–≤
5. –í–∑—ã–≤–∞–µ—Ç –∫ `method_missing`

–ò–º–µ–Ω–Ω–æ —ç—Ç—É —Ü–µ–ø–æ—á–∫—É –º—ã –∏ –±—É–¥–µ–º –∏—Å—Å–ª–µ–¥–æ–≤–∞—Ç—å.

---

## üîß –ö–ª—é—á–µ–≤—ã–µ –º–µ—Ç–æ–¥—ã

### 1. `superclass` ‚Äî —Ä–æ–¥–∏—Ç–µ–ª—å –≤ –æ—á–µ–≤–∏–¥–Ω–æ–º –º–µ—Å—Ç–µ

```ruby
class Animal; end
class Cat < Animal; end

Cat.superclass #=> Animal
Animal.superclass #=> Object
Object.superclass #=> BasicObject
BasicObject.superclass #=> nil
```

**–ö–æ–≥–¥–∞ –∏—Å–ø–æ–ª—å–∑–æ–≤–∞—Ç—å:**  
- –ü—Ä–æ–≤–µ—Ä–∫–∞ –ø—Ä—è–º–æ–≥–æ –Ω–∞—Å–ª–µ–¥–æ–≤–∞–Ω–∏—è ("—è–≤–ª—è–µ—Ç—Å—è –ª–∏ Cat –ø–æ–¥–∫–ª–∞—Å—Å–æ–º Animal?")
- –ü–æ—Å—Ç—Ä–æ–µ–Ω–∏–µ –ø—Ä–æ—Å—Ç—ã—Ö –∏–µ—Ä–∞—Ä—Ö–∏–π (–Ω–∞–ø—Ä–∏–º–µ—Ä, —Ä–∞–∑–Ω—ã–µ —Ç–∏–ø—ã –ø–ª–∞—Ç–µ–∂–µ–π)

**–ê–Ω—Ç–∏–ø–∞—Ç—Ç–µ—Ä–Ω:**  
```ruby
# –ü–ª–æ—Ö–æ: –ø—Ä–æ–≤–µ—Ä–∫–∞ —á–µ—Ä–µ–∑ superclass.superclass.superclass
def mammal?(animal)
  animal.superclass.superclass == Mammal
end
```

---

### 2. `ancestors` ‚Äî –ø–æ–ª–Ω–∞—è —Ä–æ–¥–æ—Å–ª–æ–≤–Ω–∞—è –∫–ª–∞—Å—Å–∞

```ruby
module M; end
class A; end
class B < A
  include M
end

B.ancestors #=> [B, M, A, Object, Kernel, BasicObject]
```

**–ñ–∏–∑–Ω–µ–Ω–Ω—ã–π –ø—Ä–∏–º–µ—Ä:**  
–î–æ–ø—É—Å—Ç–∏–º, —É –≤–∞—Å –µ—Å—Ç—å —Å–∏—Å—Ç–µ–º–∞ —Ä–æ–ª–µ–π:

```ruby
module AdminPermissions; end
module UserPermissions; end

class User; end
class Admin < User
  include AdminPermissions
end

Admin.ancestors #=> [Admin, AdminPermissions, User, Object...]
```

**–ö–æ–≥–¥–∞ –∏—Å–ø–æ–ª—å–∑–æ–≤–∞—Ç—å:**  
- –û—Ç–ª–∞–¥–∫–∞ "–ø–æ—á–µ–º—É –≤—ã–∑–≤–∞–ª—Å—è –Ω–µ —Ç–æ—Ç –º–µ—Ç–æ–¥?"
- –î–∏–Ω–∞–º–∏—á–µ—Å–∫–æ–µ –æ–ø—Ä–µ–¥–µ–ª–µ–Ω–∏–µ –≤–æ–∑–º–æ–∂–Ω–æ—Å—Ç–µ–π –æ–±—ä–µ–∫—Ç–∞

---

### 3. `included` ‚Äî –º–æ–¥—É–ª—å –∫–∞–∫ –º–∏–∫—Å-–∏–Ω

```ruby
module Loggable
  def self.included(base)
    base.extend(ClassMethods)
    base.send(:include, InstanceMethods)
  end

  module ClassMethods
    def log_level; :info; end
  end

  module InstanceMethods
    def log(msg); puts "[#{self.class.log_level}] #{msg}"; end
  end
end

class Product
  include Loggable
end

Product.log_level #=> :info
Product.new.log("Created") #=> "[info] Created"
```

**–ü–∞—Ç—Ç–µ—Ä–Ω:**  
–ò—Å–ø–æ–ª—å–∑—É–π—Ç–µ –¥–ª—è –¥–æ–±–∞–≤–ª–µ–Ω–∏—è —Å—Ä–∞–∑—É –∏ –∫–ª–∞—Å—Å–æ–≤—ã—Ö, –∏ –∏–Ω—Å—Ç–∞–Ω—Å-–º–µ—Ç–æ–¥–æ–≤.

**–ë–æ–ª—å:**  
–ï—Å–ª–∏ –∑–∞–±—ã—Ç—å `base.extend`, –∫–ª–∞—Å—Å–æ–≤—ã–µ –º–µ—Ç–æ–¥—ã –Ω–µ –ø–æ—è–≤—è—Ç—Å—è.

---

### 4. `extended` ‚Äî –º–æ–¥—É–ª—å –∫–∞–∫ —Å—Ç–∞—Ç–∏—á–µ—Å–∫–∏–π —Ö–µ–ª–ø–µ—Ä

```ruby
module Pagination
  def self.extended(base)
    base.class_eval do
      scope :per_page, ->(n) { limit(n) }
    end
  end

  def total_pages; (count / 10.0).ceil; end
end

class Post < ActiveRecord::Base
  extend Pagination
end

Post.total_pages #=> 3
Post.per_page(5) #=> AR scope
```

**–ö–æ–Ω—Ç—Ä–∞—Å—Ç —Å included:**  
- `include` ‚Äî –¥–æ–±–∞–≤–ª—è–µ—Ç –º–µ—Ç–æ–¥—ã –≤ **—ç–∫–∑–µ–º–ø–ª—è—Ä—ã**
- `extend` ‚Äî –¥–æ–±–∞–≤–ª—è–µ—Ç –º–µ—Ç–æ–¥—ã –≤ **—Å–∞–º –∫–ª–∞—Å—Å**

---

### 5. `prepended` ‚Äî –º–æ–¥—É–ª—å, –∫–æ—Ç–æ—Ä—ã–π "–ø–µ—Ä–µ–±–∏–≤–∞–µ—Ç" –º–µ—Ç–æ–¥—ã

```ruby
module SoftDelete
  def self.prepended(base)
    base.scope :active, -> { where(deleted_at: nil) }
  end

  def destroy
    update(deleted_at: Time.current)
  end
end

class Comment < ActiveRecord::Base
  prepend SoftDelete
end

comment = Comment.create!
comment.destroy # –í—ã–∑–æ–≤–µ—Ç –º–µ—Ç–æ–¥ –∏–∑ SoftDelete, –∞ –Ω–µ –∏–∑ AR
```

**–ö–æ–≥–¥–∞ –∏—Å–ø–æ–ª—å–∑–æ–≤–∞—Ç—å:**  
- –ü–µ—Ä–µ–æ–ø—Ä–µ–¥–µ–ª–µ–Ω–∏–µ –º–µ—Ç–æ–¥–æ–≤ –±–µ–∑ monkey-patching
- –ü—Ä–∏–æ—Ä–∏—Ç–µ—Ç–Ω–æ–µ –≤—ã–ø–æ–ª–Ω–µ–Ω–∏–µ –∫–æ–¥–∞ (–Ω–∞–ø—Ä–∏–º–µ—Ä, before-—Ñ–∏–ª—å—Ç—Ä—ã)

**–û–ø–∞—Å–Ω–æ—Å—Ç—å:**  
–ï—Å–ª–∏ –≤ –º–æ–¥—É–ª–µ –Ω–µ –≤—ã–∑–≤–∞—Ç—å `super`, —Ü–µ–ø–æ—á–∫–∞ –≤—ã–∑–æ–≤–æ–≤ –ø—Ä–µ—Ä–≤—ë—Ç—Å—è.

---

## üí• –ê–Ω—Ç–∏–ø–∞—Ç—Ç–µ—Ä–Ω—ã

1. **–°–ø–∞–≥–µ—Ç—Ç–∏-–Ω–∞—Å–ª–µ–¥–æ–≤–∞–Ω–∏–µ**  
   ```ruby
   class A < B; include M; prepend N; extend P; end
   # –¢–µ–ø–µ—Ä—å –ø–æ–ø—Ä–æ–±—É–π—Ç–µ –ø—Ä–µ–¥—Å—Ç–∞–≤–∏—Ç—å ancestors...
   ```

2. **–ó–ª–æ—É–ø–æ—Ç—Ä–µ–±–ª–µ–Ω–∏–µ prepend**  
   –ü–µ—Ä–µ–æ–ø—Ä–µ–¥–µ–ª–µ–Ω–∏–µ –±–∞–∑–æ–≤—ã—Ö –º–µ—Ç–æ–¥–æ–≤ –≤ 10 –º–æ–¥—É–ª—è—Ö ‚Äî –≤–µ—Ä–Ω—ã–π —Å–ø–æ—Å–æ–± –ø–æ–ª—É—á–∏—Ç—å –Ω–µ–æ—Ç–ª–∞–∂–∏–≤–∞–µ–º—ã–π –∫–æ–¥.

3. **–ú–æ–¥—É–ª–∏-—à–≤–µ–π—Ü–∞—Ä—ã**  
   –ö–æ–≥–¥–∞ –æ–¥–∏–Ω –º–æ–¥—É–ª—å –∏ `include`, –∏ `extend`, –∏ `prepend` ‚Äî —ç—Ç–æ –Ω–∞—Ä—É—à–µ–Ω–∏–µ SRP.

---

## üé§ –ß—Ç–æ —Å–∫–∞–∑–∞—Ç—å –Ω–∞ —Å–æ–±–µ—Å–µ–¥–æ–≤–∞–Ω–∏–∏

> ‚Äî –ö–∞–∫ –≤—ã –æ—Ä–≥–∞–Ω–∏–∑—É–µ—Ç–µ —Å–ª–æ–∂–Ω—É—é –∏–µ—Ä–∞—Ä—Ö–∏—é –∫–ª–∞—Å—Å–æ–≤?

‚Äî –ò—Å–ø–æ–ª—å–∑—É—é –º–æ–¥—É–ª–∏ –¥–ª—è –≥–æ—Ä–∏–∑–æ–Ω—Ç–∞–ª—å–Ω–æ–≥–æ —Ä–∞—Å—à–∏—Ä–µ–Ω–∏—è —Ñ—É–Ω–∫—Ü–∏–æ–Ω–∞–ª—å–Ω–æ—Å—Ç–∏ (`include`/`extend`), –∞ –Ω–∞—Å–ª–µ–¥–æ–≤–∞–Ω–∏–µ ‚Äî —Ç–æ–ª—å–∫–æ –¥–ª—è –≤—ã—Ä–∞–∂–µ–Ω–∏—è –æ—Ç–Ω–æ—à–µ–Ω–∏—è "—è–≤–ª—è–µ—Ç—Å—è". –î–ª—è –ø–µ—Ä–µ–æ–ø—Ä–µ–¥–µ–ª–µ–Ω–∏—è –º–µ—Ç–æ–¥–æ–≤ –ø—Ä–µ–¥–ø–æ—á–∏—Ç–∞—é `prepend` –ø–µ—Ä–µ–¥ monkey-patching.

---

## üßæ –í—ã–≤–æ–¥

**–¶–µ–ø–æ—á–∫–∞ –Ω–∞—Å–ª–µ–¥–æ–≤–∞–Ω–∏—è –≤ Ruby ‚Äî –∫–∞–∫ –º–∞—Ç—Ä—ë—à–∫–∞:**  
- `superclass` –ø–æ–∫–∞–∑—ã–≤–∞–µ—Ç –ø—Ä—è–º–æ–≥–æ —Ä–æ–¥–∏—Ç–µ–ª—è  
- `ancestors` —Ä–∞—Å–∫—Ä—ã–≤–∞–µ—Ç –≤—Å—é —Ü–µ–ø–æ—á–∫—É  
- `included`/`extended`/`prepended` ‚Äî –∫—Ä—é—á–∫–∏ –¥–ª—è –º–æ–¥—É–ª–µ–π  

–ü—Ä–∞–≤–∏–ª—å–Ω–æ–µ –∏—Å–ø–æ–ª—å–∑–æ–≤–∞–Ω–∏–µ —ç—Ç–∏—Ö –∏–Ω—Å—Ç—Ä—É–º–µ–Ω—Ç–æ–≤ –ø—Ä–µ–≤—Ä–∞—â–∞–µ—Ç –∑–∞–ø—É—Ç–∞–Ω–Ω—É—é –∏–µ—Ä–∞—Ä—Ö–∏—é –≤ –ø—Ä–æ–∑—Ä–∞—á–Ω—É—é –∞—Ä—Ö–∏—Ç–µ–∫—Ç—É—Ä—É. –ì–ª–∞–≤–Ω–æ–µ ‚Äî –Ω–µ –ø—Ä–µ–≤—Ä–∞—â–∞—Ç—å –∫–æ–¥ –≤ "–¥–æ–º, –∫–æ—Ç–æ—Ä—ã–π –ø–æ—Å—Ç—Ä–æ–∏–ª –î–∂–µ–∫" –∏–∑ 20 —É—Ä–æ–≤–Ω–µ–π –Ω–∞—Å–ª–µ–¥–æ–≤–∞–Ω–∏—è.
