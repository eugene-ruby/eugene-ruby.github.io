---
layout: post
title:  "Ruby: define_method –ø—Ä–æ—Ç–∏–≤ define_singleton_method ‚Äî –º–µ—Ç–∞–ø—Ä–æ–≥—Ä–∞–º–º–∏—Ä—É–π, –Ω–æ –Ω–µ –∫–æ–ª–¥—É–π"
date:   2023-03-09 11:00:00 +0300
rate: 3
tags: Ruby,–º–µ—Ç–∞–ø—Ä–æ–≥—Ä–∞–º–º–∏—Ä–æ–≤–∞–Ω–∏–µ,define_method,define_singleton_method,DRY,Rails
version: A49X3
categories:
  - ruby
toc: true
menubar_toc: true
hero_image: /images/ruby.jpeg
hero_darken: true
---
Ruby –ø—Ä–µ–¥–ª–∞–≥–∞–µ—Ç –º–æ—â–Ω—ã–µ –∏–Ω—Å—Ç—Ä—É–º–µ–Ω—Ç—ã –º–µ—Ç–∞–ø—Ä–æ–≥—Ä–∞–º–º–∏—Ä–æ–≤–∞–Ω–∏—è, —Ç–∞–∫–∏–µ –∫–∞–∫ define_method –∏ define_singleton_method, –∫–æ—Ç–æ—Ä—ã–µ –ø–æ–∑–≤–æ–ª—è—é—Ç –¥–∏–Ω–∞–º–∏—á–µ—Å–∫–∏ —Å–æ–∑–¥–∞–≤–∞—Ç—å –º–µ—Ç–æ–¥—ã –≤–æ –≤—Ä–µ–º—è –≤—ã–ø–æ–ª–Ω–µ–Ω–∏—è. –í —ç—Ç–æ–π —Å—Ç–∞—Ç—å–µ —Ä–∞–∑–±–µ—Ä—ë–º –∫–ª—é—á–µ–≤—ã–µ —Ä–∞–∑–ª–∏—á–∏—è –º–µ–∂–¥—É –Ω–∏–º–∏, —Ç–∏–ø–∏—á–Ω—ã–µ –æ—à–∏–±–∫–∏ –∏ –ø—Ä–∞–∫—Ç–∏—á–µ—Å–∫–∏–µ –ø—Ä–∏–º–µ—Ä—ã –∏—Å–ø–æ–ª—å–∑–æ–≤–∞–Ω–∏—è –≤ Rails-–ø—Ä–∏–ª–æ–∂–µ–Ω–∏—è—Ö. –í—ã —É–∑–Ω–∞–µ—Ç–µ, –∫–∞–∫ –ø—Ä–∞–≤–∏–ª—å–Ω–æ –ø—Ä–∏–º–µ–Ω—è—Ç—å —ç—Ç–∏ –º–µ—Ç–æ–¥—ã –¥–ª—è DRY-–∫–æ–¥–∞ –∏ –≥–∏–±–∫–æ–π –Ω–∞—Å—Ç—Ä–æ–π–∫–∏ –æ–±—ä–µ–∫—Ç–æ–≤.

---

–ú–µ—Ç–∞–ø—Ä–æ–≥—Ä–∞–º–º–∏—Ä–æ–≤–∞–Ω–∏–µ ‚Äî —ç—Ç–æ –∫–æ–≥–¥–∞ —Ç—ã —Å–æ–∑–¥–∞—ë—à—å –º–µ—Ç–æ–¥—ã, –ø–æ–∫–∞ –Ω–∏–∫—Ç–æ –Ω–µ –≤–∏–¥–∏—Ç. Ruby –ø–æ–∑–≤–æ–ª—è–µ—Ç –¥–µ–ª–∞—Ç—å —ç—Ç–æ –¥–≤—É–º—è —Å–ø–æ—Å–æ–±–∞–º–∏: `define_method` –∏ `define_singleton_method`. –ù–∞ —Å–æ–±–µ—Å–µ–¥–æ–≤–∞–Ω–∏—è—Ö –ª—é–±—è—Ç —Å–ø—Ä–∞—à–∏–≤–∞—Ç—å: ‚Äú–ê –≤ —á—ë–º —Ä–∞–∑–Ω–∏—Ü–∞?‚Äù ‚Äî –∏ —Å–º–æ—Ç—Ä—è—Ç, –∫–∞–∫ —Ç—ã –≤—Å–ø–æ–º–∏–Ω–∞–µ—à—å —Å—Ç–∞—Ç—å—é –≤—Ä–æ–¥–µ —ç—Ç–æ–π.

## üè∑ define_method

–î–æ–±–∞–≤–ª—è–µ—Ç **–∏–Ω—Å—Ç–∞–Ω—Å-–º–µ—Ç–æ–¥ –≤ –∫–ª–∞—Å—Å –∏–ª–∏ –º–æ–¥—É–ª—å**.

```ruby
class Robot
  define_method(:greet) do |name|
    "Hello, #{name}!"
  end
end

puts Robot.new.greet("Ruby") # => Hello, Ruby!
````

üí° –í–∞–∂–Ω–æ: –º–µ—Ç–æ–¥ –æ–ø—Ä–µ–¥–µ–ª—è–µ—Ç—Å—è **–Ω–∞ —É—Ä–æ–≤–Ω–µ –∫–ª–∞—Å—Å–∞**, –Ω–æ —Ä–∞–±–æ—Ç–∞–µ—Ç **–Ω–∞ —ç–∫–∑–µ–º–ø–ª—è—Ä–∞—Ö**.

---

## üßç define\_singleton\_method

–î–æ–±–∞–≤–ª—è–µ—Ç –º–µ—Ç–æ–¥ —Ç–æ–ª—å–∫–æ **–æ–¥–Ω–æ–º—É –∫–æ–Ω–∫—Ä–µ—Ç–Ω–æ–º—É –æ–±—ä–µ–∫—Ç—É** ‚Äî –µ–≥–æ singleton-–º–µ—Ç–æ–¥—É.

```ruby
robot = Object.new

robot.define_singleton_method(:greet) do
  "I'm unique!"
end

puts robot.greet # => I'm unique!
```

üí° –≠—Ç–æ—Ç –º–µ—Ç–æ–¥ –Ω–µ–ª—å–∑—è –≤—ã–∑–≤–∞—Ç—å –Ω–∞ —É—Ä–æ–≤–Ω–µ `class`, —Ç–æ–ª—å–∫–æ –Ω–∞ –æ–±—ä–µ–∫—Ç–µ.

---

## üß† –ö–ª—é—á–µ–≤—ã–µ –æ—Ç–ª–∏—á–∏—è

|                        | define\_method       | define\_singleton\_method    |
| ---------------------- | -------------------- | ---------------------------- |
| –ì–¥–µ –æ–ø—Ä–µ–¥–µ–ª—è–µ—Ç –º–µ—Ç–æ–¥   | –í –∫–ª–∞—Å—Å–µ/–º–æ–¥—É–ª–µ      | –í singleton-–∫–ª–∞—Å—Å–µ –æ–±—ä–µ–∫—Ç–∞   |
| –†–∞–±–æ—Ç–∞–µ—Ç –Ω–∞‚Ä¶           | –≠–∫–∑–µ–º–ø–ª—è—Ä–∞—Ö –∫–ª–∞—Å—Å–∞   | –¢–æ–ª—å–∫–æ –Ω–∞ –¥–∞–Ω–Ω–æ–º –æ–±—ä–µ–∫—Ç–µ     |
| –ú–æ–∂–µ—Ç –ª–∏ –±—ã—Ç—å —É –∫–ª–∞—Å—Å–∞ | –î–∞ (`class << self`) | –î–∞ (–µ—Å–ª–∏ –≤—ã–∑–≤–∞—Ç—å –Ω–∞ –æ–±—ä–µ–∫—Ç–µ) |
| –ö–æ–Ω—Ç–µ–∫—Å—Ç `self`        | –≠–∫–∑–µ–º–ø–ª—è—Ä –ø—Ä–∏ –≤—ã–∑–æ–≤–µ | –¢–æ—Ç —Å–∞–º—ã–π –æ–±—ä–µ–∫—Ç             |

---

## üß® –ü–æ–¥–≤–æ–¥–Ω—ã–µ –∫–∞–º–Ω–∏

1. `define_method` –Ω–µ –ø—Ä–∏–Ω–∏–º–∞–µ—Ç `return` –≤ –±–ª–æ–∫–µ ‚Äî –±—É–¥–µ—Ç `LocalJumpError`.
2. –ù–µ–ª—å–∑—è –∏—Å–ø–æ–ª—å–∑–æ–≤–∞—Ç—å –æ–±—ã—á–Ω—ã–µ `def` –≤–Ω—É—Ç—Ä–∏ `define_method` ‚Äî —Ç–æ–ª—å–∫–æ –±–ª–æ–∫.
3. –ü—Ä–∏ –ø–æ–ø—ã—Ç–∫–µ –≤—ã–∑–≤–∞—Ç—å `define_singleton_method` –≤ —Ç–µ–ª–µ –∫–ª–∞—Å—Å–∞: üí• `NoMethodError`.

---

## üéì –ü—Ä–∏–º–µ—Ä—ã –∏—Å–ø–æ–ª—å–∑–æ–≤–∞–Ω–∏—è

### define\_method ‚Äî –≥–µ–Ω–µ—Ä–∞—Ü–∏—è DRY-–º–µ—Ç–æ–¥–æ–≤

```ruby
[:title, :author, :year].each do |field|
  define_method("get_#{field}") do
    instance_variable_get("@#{field}")
  end
end
```

### define\_singleton\_method ‚Äî –∫–æ–Ω—Ñ–∏–≥—É—Ä–∞—Ü–∏—è –Ω–∞ –ª–µ—Ç—É

```ruby
config = {}

config.define_singleton_method(:set) do |key, value|
  self[key] = value
end

config.set(:theme, :dark)
```

---

## üîß –î–ª—è –∫–ª–∞—Å—Å–æ–≤ —Ç–æ–∂–µ –º–æ–∂–Ω–æ

```ruby
class << MyClass
  define_method(:greet) { "hi" }
end
```

–≠—Ç–æ –¥–æ–±–∞–≤–∏—Ç **–º–µ—Ç–æ–¥ –∫–ª–∞—Å—Å–∞**, –ø–æ—Ç–æ–º—É —á—Ç–æ `class << self` –æ—Ç–∫—Ä—ã–≤–∞–µ—Ç singleton class.

---

üîö **–í—ã–≤–æ–¥:**
`define_method` ‚Äî —ç—Ç–æ –ø—Ä–æ —à–∞–±–ª–æ–Ω—ã –∏ –∞–≤—Ç–æ–º–∞—Ç–∏–∑–∞—Ü–∏—é. `define_singleton_method` ‚Äî –ø—Ä–æ –∫–∞—Å—Ç–æ–º–Ω—É—é –º–∞–≥–∏—é. –û–±–∞ –º–æ—â–Ω—ã–µ. –û–±–∞ –æ–ø–∞—Å–Ω—ã –≤ —Ä—É–∫–∞—Ö —É —Ä–∞–∑—Ä–∞–±–æ—Ç—á–∏–∫–∞ –±–µ–∑ –∫–æ—Ñ–µ–∏–Ω–∞.

*–°–ª–µ–¥—É—é—â–∞—è —Ç–µ–º–∞: –ø–µ—Ä–µ–º–µ–Ω–Ω—ã–µ –∫–ª–∞—Å—Å–∞, —ç–∫–∑–µ–º–ø–ª—è—Ä–∞ –∏ –≥–ª–æ–±–∞–ª—å–Ω—ã–µ ‚Äî –¥–∞ –Ω–∞—á–Ω—ë—Ç—Å—è —Ö–∞–æ—Å —Å `@`, `@@` –∏ `$`.*
