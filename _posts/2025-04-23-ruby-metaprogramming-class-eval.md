---
layout: post
subtitle: <div id="terminal"></div>
title:  "–ú–µ—Ç–æ–¥—ã eval –∏ exec –≤ Ruby: –∫–æ–≥–¥–∞ –æ–±—ã—á–Ω–æ–≥–æ –û–û–ü —É–∂–µ –Ω–µ–¥–æ—Å—Ç–∞—Ç–æ—á–Ω–æ"
date:  2025-04-23 11:00:00 +0300
rate: 4
tags: Ruby,–º–µ—Ç–∞–ø—Ä–æ–≥—Ä–∞–º–º–∏—Ä–æ–≤–∞–Ω–∏–µ,–∫–ª–∞—Å—Å—ã,–º–æ–¥—É–ª–∏,—Ä–µ—Ñ–ª–µ–∫—Å–∏—è
version: 3.2.2
categories:
   - ruby
hero_image: /images/posts/36.jpg
hero_darken: true
toc: true
menubar_toc: true
---
–ú–µ—Ç–æ–¥—ã `eval` –∏ `exec` –≤ Ruby ‚Äî —ç—Ç–æ –º–æ—â–Ω—ã–µ –∏–Ω—Å—Ç—Ä—É–º–µ–Ω—Ç—ã –º–µ—Ç–∞–ø—Ä–æ–≥—Ä–∞–º–º–∏—Ä–æ–≤–∞–Ω–∏—è, –ø–æ–∑–≤–æ–ª—è—é—â–∏–µ –¥–∏–Ω–∞–º–∏—á–µ—Å–∫–∏ –∏–∑–º–µ–Ω—è—Ç—å –∫–ª–∞—Å—Å—ã, –º–æ–¥—É–ª–∏ –∏ –æ–±—ä–µ–∫—Ç—ã –≤–æ –≤—Ä–µ–º—è –≤—ã–ø–æ–ª–Ω–µ–Ω–∏—è –ø—Ä–æ–≥—Ä–∞–º–º—ã. –í —Å—Ç–∞—Ç—å–µ —Ä–∞–∑–±–µ—Ä—ë–º –∏—Ö —Ä–∞–∑–ª–∏—á–∏—è, –ø—Ä–∞–∫—Ç–∏—á–µ—Å–∫–∏–µ –ø—Ä–∏–º–µ–Ω–µ–Ω–∏—è –∏ –ø–æ–¥–≤–æ–¥–Ω—ã–µ –∫–∞–º–Ω–∏, –∫–æ—Ç–æ—Ä—ã–µ –º–æ–≥—É—Ç –ø—Ä–µ–≤—Ä–∞—Ç–∏—Ç—å –≤–∞—à –∫–æ–¥ –≤ –º–∏–Ω–Ω–æ–µ –ø–æ–ª–µ.

---
–í—ã –∫–æ–≥–¥–∞-–Ω–∏–±—É–¥—å –≤–∏–¥–µ–ª–∏ –∫–æ–¥, –∫–æ—Ç–æ—Ä—ã–π "—Å–∞–º —Å–µ–±—è –ø–∏—à–µ—Ç"?  
–í Ruby —ç—Ç–æ –Ω–µ –º–∞–≥–∏—è, –∞ –æ–±—ã—á–Ω—ã–π –±—É–¥–Ω–∏—á–Ω—ã–π –∏–Ω—Å—Ç—Ä—É–º–µ–Ω—Ç ‚Äî **–º–µ—Ç–æ–¥—ã —Å–µ–º–µ–π—Å—Ç–≤–∞ `eval` –∏ `exec`**.

---

## üß† –¢–µ–æ—Ä–∏—è: –∑–∞—á–µ–º —ç—Ç–æ –Ω—É–∂–Ω–æ?

–ò–Ω–æ–≥–¥–∞ —Å—Ç–∞—Ç–∏—á–µ—Å–∫–æ–≥–æ –û–û–ü –Ω–µ–¥–æ—Å—Ç–∞—Ç–æ—á–Ω–æ. –ù–∞–ø—Ä–∏–º–µ—Ä:
- –ù—É–∂–Ω–æ –¥–æ–±–∞–≤–∏—Ç—å –º–µ—Ç–æ–¥—ã –≤ –∫–ª–∞—Å—Å –¥–∏–Ω–∞–º–∏—á–µ—Å–∫–∏ (–Ω–∞–ø—Ä–∏–º–µ—Ä, –∏–∑ –∫–æ–Ω—Ñ–∏–≥–∞)
- –¢—Ä–µ–±—É–µ—Ç—Å—è –º–æ–¥–∏—Ñ–∏—Ü–∏—Ä–æ–≤–∞—Ç—å –ø–æ–≤–µ–¥–µ–Ω–∏–µ –æ–±—ä–µ–∫—Ç–∞ "–Ω–∞ –ª–µ—Ç—É"
- –•–æ—á–µ—Ç—Å—è —Å–æ–∑–¥–∞—Ç—å DSL (Domain-Specific Language)

–í–æ—Ç –≥–¥–µ –Ω–∞ –ø–æ–º–æ—â—å –ø—Ä–∏—Ö–æ–¥—è—Ç –Ω–∞—à–∏ "–≤–æ–ª—à–µ–±–Ω—ã–µ" –º–µ—Ç–æ–¥—ã.

---

## üîß –û—Å–Ω–æ–≤–Ω—ã–µ —Ä–∞–∑–ª–∏—á–∏—è

| –ú–µ—Ç–æ–¥          | –ö–æ–Ω—Ç–µ–∫—Å—Ç –≤—ã–ø–æ–ª–Ω–µ–Ω–∏—è | –ë–ª–æ–∫/—Å—Ç—Ä–æ–∫–∞ | –ê—Ä–≥—É–º–µ–Ω—Ç—ã |
|----------------|---------------------|-------------|-----------|
| `class_eval`   | –ö–ª–∞—Å—Å/–º–æ–¥—É–ª—å        | –û–±–∞         | –ù–µ—Ç       |
| `module_eval`  | –ö–ª–∞—Å—Å/–º–æ–¥—É–ª—å        | –û–±–∞         | –ù–µ—Ç       |
| `instance_eval`| –≠–∫–∑–µ–º–ø–ª—è—Ä           | –û–±–∞         | –ù–µ—Ç       |
| `class_exec`   | –ö–ª–∞—Å—Å/–º–æ–¥—É–ª—å        | –¢–æ–ª—å–∫–æ –±–ª–æ–∫ | –î–∞        |
| `module_exec`  | –ö–ª–∞—Å—Å/–º–æ–¥—É–ª—å        | –¢–æ–ª—å–∫–æ –±–ª–æ–∫ | –î–∞        |
| `instance_exec`| –≠–∫–∑–µ–º–ø–ª—è—Ä           | –¢–æ–ª—å–∫–æ –±–ª–æ–∫ | –î–∞        |

---

## 1Ô∏è‚É£ class_eval / module_eval (—ç—Ç–æ –æ–¥–Ω–æ –∏ —Ç–æ –∂–µ!)

**–ß—Ç–æ –¥–µ–ª–∞–µ—Ç:** –û—Ç–∫—Ä—ã–≤–∞–µ—Ç –∫–ª–∞—Å—Å/–º–æ–¥—É–ª—å –¥–ª—è –¥–æ–±–∞–≤–ª–µ–Ω–∏—è –º–µ—Ç–æ–¥–æ–≤.

```ruby
class User; end

User.class_eval do
  def say_hello
    "Hello from class_eval!"
  end
end

User.new.say_hello # => "Hello from class_eval!"
```

**–ñ–∏–∑–Ω–µ–Ω–Ω—ã–π –ø—Ä–∏–º–µ—Ä:** –î–∏–Ω–∞–º–∏—á–µ—Å–∫–æ–µ –¥–æ–±–∞–≤–ª–µ–Ω–∏–µ –º–µ—Ç–æ–¥–æ–≤ –∏–∑ YAML-–∫–æ–Ω—Ñ–∏–≥–∞.

```ruby
# config/methods.yml
# methods:
#   admin:
#     - name: ban_user
#       body: "self.banned = true"

methods_config = YAML.load_file('config/methods.yml')
methods_config['methods']['admin'].each do |method|
  Admin.class_eval <<~RUBY
    def #{method['name']}
      #{method['body']}
    end
  RUBY
end
```

**–ê–Ω—Ç–∏–ø–∞—Ç—Ç–µ—Ä–Ω:** –ò—Å–ø–æ–ª—å–∑–æ–≤–∞—Ç—å –¥–ª—è –ø—Ä–æ—Å—Ç–æ–≥–æ –¥–æ–±–∞–≤–ª–µ–Ω–∏—è –º–µ—Ç–æ–¥–æ–≤ ‚Äî –ª—É—á—à–µ `include` –º–æ–¥—É–ª—è.

---

## 2Ô∏è‚É£ instance_eval

**–ß—Ç–æ –¥–µ–ª–∞–µ—Ç:** –ú–µ–Ω—è–µ—Ç `self` –Ω–∞ –∫–æ–Ω–∫—Ä–µ—Ç–Ω—ã–π –æ–±—ä–µ–∫—Ç.

```ruby
user = User.new
user.instance_eval do
  def personal_method
    "Only for this instance!"
  end
end

user.personal_method # => "Only for this instance!"
User.new.personal_method # NoMethodError
```

**–ñ–∏–∑–Ω–µ–Ω–Ω—ã–π –ø—Ä–∏–º–µ—Ä:** –°–æ–∑–¥–∞–Ω–∏–µ —Ç–µ—Å—Ç–æ–≤—ã—Ö –¥–∞–Ω–Ω—ã—Ö —Å —É–Ω–∏–∫–∞–ª—å–Ω—ã–º –ø–æ–≤–µ–¥–µ–Ω–∏–µ–º.

```ruby
test_user = User.new
test_user.instance_eval do
  def admin?
    true # –í —Ç–µ—Å—Ç–∞—Ö —ç—Ç–æ—Ç –ø–æ–ª—å–∑–æ–≤–∞—Ç–µ–ª—å –≤—Å–µ–≥–¥–∞ –∞–¥–º–∏–Ω
  end
end
```

**–ê–Ω—Ç–∏–ø–∞—Ç—Ç–µ—Ä–Ω:** –ó–ª–æ—É–ø–æ—Ç—Ä–µ–±–ª–µ–Ω–∏–µ ‚Äî –º–æ–∂–µ—Ç —Å–¥–µ–ª–∞—Ç—å –∫–æ–¥ –Ω–µ–ø—Ä–µ–¥—Å–∫–∞–∑—É–µ–º—ã–º.

---

## 3Ô∏è‚É£ class_exec / module_exec

**–ß—Ç–æ –¥–µ–ª–∞–µ—Ç:** –ö–∞–∫ `class_eval`, –Ω–æ —Å –ø–æ–¥–¥–µ—Ä–∂–∫–æ–π –ø–∞—Ä–∞–º–µ—Ç—Ä–æ–≤ –≤ –±–ª–æ–∫–µ.

```ruby
module Logger
   def self.add_logging(method_name)
      class_exec(method_name) do |name|
         define_method(name) do |*args|
            puts "Calling #{name} with #{args}"
            super(*args)
         end
      end
   end
end

class Calculator
   prepend Logger
  def add(a, b); a + b; end
end

Logger.add_logging(:add)
Calculator.new.add(2, 3) # => "Calling add with [2, 3]"
                         # => 5
```

**–ñ–∏–∑–Ω–µ–Ω–Ω—ã–π –ø—Ä–∏–º–µ—Ä:** –ü–∞—Ç—Ç–µ—Ä–Ω "–î–µ–∫–æ—Ä–∞—Ç–æ—Ä" –¥–ª—è –¥–æ–±–∞–≤–ª–µ–Ω–∏—è –ª–æ–≥–∏—Ä–æ–≤–∞–Ω–∏—è.

---

## 4Ô∏è‚É£ instance_exec

**–ß—Ç–æ –¥–µ–ª–∞–µ—Ç:** –¢–æ –∂–µ, —á—Ç–æ `instance_eval`, –Ω–æ —Å –ø–æ–¥–¥–µ—Ä–∂–∫–æ–π –ø–∞—Ä–∞–º–µ—Ç—Ä–æ–≤ –≤ –±–ª–æ–∫–µ.

```ruby
class Button
   def initialize
      @state = 'off'
   end

   def update_state(new_state)
      instance_exec(new_state) do |state|
         @state = state
      end
   end

   def state
      @state
   end
end

button = Button.new
puts button.state # => "off"
button.update_state('on')
puts button.state # => "on"
```

**–ü—Ä–∞–∫—Ç–∏—á–µ—Å–∫–æ–µ –ø—Ä–∏–º–µ–Ω–µ–Ω–∏–µ:** –ö–æ–ª–±—ç–∫–∏ –≤ UI-–±–∏–±–ª–∏–æ—Ç–µ–∫–∞—Ö.

---

## üí£ –û–ø–∞—Å–Ω–æ—Å—Ç–∏ –∏ –ø–æ–¥–≤–æ–¥–Ω—ã–µ –∫–∞–º–Ω–∏

1. **–ë–µ–∑–æ–ø–∞—Å–Ω–æ—Å—Ç—å:** –ù–∏–∫–æ–≥–¥–∞ –Ω–µ –∏—Å–ø–æ–ª—å–∑—É–π—Ç–µ `eval` —Å –ø–æ–ª—å–∑–æ–≤–∞—Ç–µ–ª—å—Å–∫–∏–º –≤–≤–æ–¥–æ–º:
   ```ruby
   # –û–ü–ê–°–ù–û!
   User.class_eval(params[:code])
   ```

2. **–ü—Ä–æ–∏–∑–≤–æ–¥–∏—Ç–µ–ª—å–Ω–æ—Å—Ç—å:** –î–∏–Ω–∞–º–∏—á–µ—Å–∫–æ–µ —Å–æ–∑–¥–∞–Ω–∏–µ –º–µ—Ç–æ–¥–æ–≤ –º–µ–¥–ª–µ–Ω–Ω–µ–µ —Å—Ç–∞—Ç–∏—á–µ—Å–∫–æ–≥–æ.

3. **–û—Ç–ª–∞–¥–∫–∞:** –°–ª–æ–∂–Ω–µ–µ –æ—Ç—Å–ª–µ–∂–∏–≤–∞—Ç—å –ø—Ä–æ–∏—Å—Ö–æ–∂–¥–µ–Ω–∏–µ –¥–∏–Ω–∞–º–∏—á–µ—Å–∫–∏ —Å–æ–∑–¥–∞–Ω–Ω—ã—Ö –º–µ—Ç–æ–¥–æ–≤.

---

## üé§ –ß—Ç–æ —Å–∫–∞–∑–∞—Ç—å –Ω–∞ —Å–æ–±–µ—Å–µ–¥–æ–≤–∞–Ω–∏–∏

> ‚Äî –ö–∞–∫ –≤—ã –æ—Ç–Ω–æ—Å–∏—Ç–µ—Å—å –∫ –º–µ—Ç–∞–ø—Ä–æ–≥—Ä–∞–º–º–∏—Ä–æ–≤–∞–Ω–∏—é –≤ Ruby?

‚Äî –≠—Ç–æ –º–æ—â–Ω—ã–π –∏–Ω—Å—Ç—Ä—É–º–µ–Ω—Ç, –Ω–æ –∫–∞–∫ –Ω–æ–∂ ‚Äî —Ö–æ—Ä–æ—à –≤ —É–º–µ–ª—ã—Ö —Ä—É–∫–∞—Ö. –Ø –∏—Å–ø–æ–ª—å–∑—É—é `class_eval`/`define_method` —Ç–∞–º, –≥–¥–µ —ç—Ç–æ –æ–ø—Ä–∞–≤–¥–∞–Ω–æ, –Ω–∞–ø—Ä–∏–º–µ—Ä –¥–ª—è —Å–æ–∑–¥–∞–Ω–∏—è DSL –∏–ª–∏ –¥–∏–Ω–∞–º–∏—á–µ—Å–∫–∏—Ö –¥–µ–ª–µ–≥–∞—Ç–æ–≤, –Ω–æ –≤—Å–µ–≥–¥–∞ –ø–æ–º–Ω—é –æ –±–µ–∑–æ–ø–∞—Å–Ω–æ—Å—Ç–∏ –∏ —á–∏—Ç–∞–µ–º–æ—Å—Ç–∏ –∫–æ–¥–∞.

---

## üßæ –í—ã–≤–æ–¥

**–ú–µ—Ç–æ–¥—ã `eval` –∏ `exec` ‚Äî —ç—Ç–æ —à–≤–µ–π—Ü–∞—Ä—Å–∫–∏–π –Ω–æ–∂ Ruby-—Ä–∞–∑—Ä–∞–±–æ—Ç—á–∏–∫–∞.**  
–û–Ω–∏ –ø–æ–∑–≤–æ–ª—è—é—Ç –ø–∏—Å–∞—Ç—å –≤—ã—Ä–∞–∑–∏—Ç–µ–ª—å–Ω—ã–π –∏ –≥–∏–±–∫–∏–π –∫–æ–¥, –Ω–æ —Ç—Ä–µ–±—É—é—Ç –¥–∏—Å—Ü–∏–ø–ª–∏–Ω—ã. –ò—Å–ø–æ–ª—å–∑—É–π—Ç–µ –∏—Ö –æ—Å–æ–∑–Ω–∞–Ω–Ω–æ, –∫–æ–≥–¥–∞ –æ–±—ã—á–Ω–æ–µ –û–û–ü –Ω–µ —Å–ø—Ä–∞–≤–ª—è–µ—Ç—Å—è, –∏ –≤—Å–µ–≥–¥–∞ –ø–æ–º–Ω–∏—Ç–µ –æ –±–µ–∑–æ–ø–∞—Å–Ω–æ—Å—Ç–∏ –∏ –ø–æ–¥–¥–µ—Ä–∂–∏–≤–∞–µ–º–æ—Å—Ç–∏ –∫–æ–¥–∞.
