---
layout: post
title:  "Ruby: include, extend, prepend –∏ refine ‚Äî –∫—Ç–æ —Ç—ã –∏–∑ –º–æ–¥—É–ª–µ–π?"
date:   2023-03-18 12:30:00 +0300
categories:
  - ruby
toc: true
menubar_toc: true
hero_image: /images/ruby.jpeg
hero_darken: true
---

–ï—Å–ª–∏ —Ç—ã –æ–¥–Ω–∞–∂–¥—ã –ø—É—Ç–∞–ª `include` –∏ `extend`, –∞ –ø—Ä–∏ —Å–ª–æ–≤–µ `prepend` –Ω–∞—á–∏–Ω–∞–ª –≤—Å–ø–æ–º–∏–Ω–∞—Ç—å –ø—Ä–æ –ø—Ä–µ–¥–∫–æ–≤ ‚Äî —Ç—ã –Ω–µ –æ–¥–∏–Ω.  
Ruby-–º–æ–¥—É–ª–∏ ‚Äî —ç—Ç–æ –ø—Ä–æ **—Å–æ—Å—Ç–∞–≤–ª–µ–Ω–∏–µ –ø–æ–≤–µ–¥–µ–Ω–∏—è**, –Ω–æ —Å –Ω–µ–æ–∂–∏–¥–∞–Ω–Ω—ã–º –ø–æ–≤–æ—Ä–æ—Ç–æ–º.

---

## üß© `include`: –¥–æ–±–∞–≤–ª—è–µ–º –º–µ—Ç–æ–¥—ã –∫–∞–∫ instance-–º–µ—Ç–æ–¥—ã

```ruby
module Speak
  def hello
    "–ü—Ä–∏–≤–µ—Ç!"
  end
end

class Human
  include Speak
end

puts Human.new.hello # => –ü—Ä–∏–≤–µ—Ç!
````

**`include`** –ø–æ–¥–∫–ª—é—á–∞–µ—Ç –º–µ—Ç–æ–¥—ã –∫–∞–∫ **—ç–∫–∑–µ–º–ø–ª—è—Ä–Ω—ã–µ**.
–¢–æ –µ—Å—Ç—å `Speak#hello` —Å—Ç–∞–Ω–µ—Ç –¥–æ—Å—Ç—É–ø–µ–Ω —É `Human.new`.

---

## üß† `extend`: –¥–æ–±–∞–≤–ª—è–µ–º –º–µ—Ç–æ–¥—ã –∫–∞–∫ –º–µ—Ç–æ–¥—ã —Å–∞–º–æ–≥–æ –æ–±—ä–µ–∫—Ç–∞

```ruby
module Meta
  def version
    "1.0"
  end
end

class App
  extend Meta
end

puts App.version # => 1.0
```

**`extend`** –ø–æ–¥–∫–ª—é—á–∞–µ—Ç –º–µ—Ç–æ–¥—ã –∫–∞–∫ **–º–µ—Ç–æ–¥—ã —Å–∞–º–æ–≥–æ –æ–±—ä–µ–∫—Ç–∞**.
–í –¥–∞–Ω–Ω–æ–º —Å–ª—É—á–∞–µ ‚Äî –∫–ª–∞—Å—Å–∞ `App`.

---

## üîÑ `prepend`: –º–∞–≥–∏—á–µ—Å–∫–æ–µ include —Å–ª–µ–≤–∞

```ruby
module Loud
  def hello
    "–≠–¢–û –ü–ï–†–ï–ü–†–ï–î!"
  end
end

class Robot
  prepend Loud
  def hello
    "–ü—Ä–∏–≤–µ—Ç –æ—Ç —Ä–æ–±–æ—Ç–∞"
  end
end

puts Robot.new.hello # => –≠–¢–û –ü–ï–†–ï–ü–†–ï–î!
```

**`prepend`** –≤—Å—Ç–∞–≤–ª—è–µ—Ç –º–æ–¥—É–ª—å **–ø–µ—Ä–µ–¥** –∫–ª–∞—Å—Å–æ–º –≤ —Ü–µ–ø–æ—á–∫–µ `ancestors`.

```ruby
puts Robot.ancestors
# => [Loud, Robot, Object, Kernel, BasicObject]
```

---

## üó∫Ô∏è –ì–¥–µ `include`, –≥–¥–µ `extend`?

| –ß—Ç–æ –ø–æ–¥–∫–ª—é—á–∞–µ–º | –ö—É–¥–∞ –ø–æ–¥–∫–ª—é—á–∞–µ–º | –ö–∞–∫–æ–π –±—É–¥–µ—Ç –º–µ—Ç–æ–¥          |
| -------------- | --------------- | -------------------------- |
| `include M`    | –í –∫–ª–∞—Å—Å         | instance method            |
| `extend M`     | –í –∫–ª–∞—Å—Å         | class method               |
| `extend M`     | –í –æ–±—ä–µ–∫—Ç        | singleton method           |
| `prepend M`    | –í –∫–ª–∞—Å—Å         | instance method, –Ω–æ —Ä–∞–Ω—å—à–µ |

---

## ü§Ø `using` –∏ `refine` ‚Äî –ª–æ–∫–∞–ª—å–Ω—ã–µ –ø–∞—Ç—á–∏

–ò–Ω–æ–≥–¥–∞ —Ö–æ—á–µ—Ç—Å—è –ø–µ—Ä–µ–æ–ø—Ä–µ–¥–µ–ª–∏—Ç—å –º–µ—Ç–æ–¥—ã —Å—É—â–µ—Å—Ç–≤—É—é—â–∏—Ö –∫–ª–∞—Å—Å–æ–≤, –Ω–æ **–Ω–µ –≥–ª–æ–±–∞–ª—å–Ω–æ**. –í–æ—Ç —Ç–æ–≥–¥–∞ ‚Äî `refine`.

```ruby
module Shout
  refine String do
    def shout
      upcase + "!!!"
    end
  end
end

using Shout

puts "ruby".shout # => RUBY!!!
```

–ó–∞ –ø—Ä–µ–¥–µ–ª–∞–º–∏ –æ–±–ª–∞—Å—Ç–∏ `using` –º–µ—Ç–æ–¥–∞ `shout` **–Ω–µ —Å—É—â–µ—Å—Ç–≤—É–µ—Ç**.

---

## üî• –ü—Ä–∏–º–µ—Ä –ø–æ–¥–≤–æ—Ö–∞ –Ω–∞ —Å–æ–±–µ—Å–µ–¥–æ–≤–∞–Ω–∏–∏

```ruby
module M
  def greet
    "hello from M"
  end
end

class A
  include M
end

class B
  extend M
end

puts A.new.greet    # => ?
puts B.greet        # => ?
```

**–û—Ç–≤–µ—Ç:**

* `A.new.greet` ‚Äî —Ä–∞–±–æ—Ç–∞–µ—Ç (instance method)
* `B.greet` ‚Äî —Ä–∞–±–æ—Ç–∞–µ—Ç (class method)
* `A.greet` ‚Äî üí• NoMethodError
* `B.new.greet` ‚Äî üí• NoMethodError

---

## ‚ùó –°–æ–≤–µ—Ç –Ω–∞ –ø—Ä–æ–¥

–ï—Å–ª–∏ —Ç—ã –ø–∏—à–µ—à—å –º–æ–¥—É–ª—å:

* `include` ‚Äî –¥–ª—è **–ø–æ–≤–µ–¥–µ–Ω–∏—è —ç–∫–∑–µ–º–ø–ª—è—Ä–æ–≤**
* `extend self` ‚Äî –¥–ª—è **–º–æ–¥—É–ª—å–Ω—ã—Ö —Ñ—É–Ω–∫—Ü–∏–π**
* `prepend` ‚Äî –∫–æ–≥–¥–∞ –Ω—É–∂–µ–Ω **hook** –∏–ª–∏ **override**
* `refine` ‚Äî –∫–æ–≥–¥–∞ **–Ω–µ–ª—å–∑—è –ª–æ–º–∞—Ç—å –≥–ª–æ–±–∞–ª—å–Ω–æ**, –Ω–æ –æ—á–µ–Ω—å —Ö–æ—á–µ—Ç—Å—è

---

üîö **–í—ã–≤–æ–¥:**
Ruby –¥–∞—ë—Ç –º–Ω–æ–≥–æ —Å–ø–æ—Å–æ–±–æ–≤ –¥–æ–±–∞–≤–∏—Ç—å –ø–æ–≤–µ–¥–µ–Ω–∏–µ, –Ω–æ –≤—Å—ë –∑–∞–≤–∏—Å–∏—Ç –æ—Ç —Ç–æ–≥–æ, **–∫—É–¥–∞ —Ç—ã –≤—Å—Ç–∞–≤–ª—è–µ—à—å –º–æ–¥—É–ª—å**, –∏ **–¥–ª—è –∫–æ–≥–æ**: –æ–±—ä–µ–∫—Ç–∞, —ç–∫–∑–µ–º–ø–ª—è—Ä–∞ –∏–ª–∏ –≤—Å–µ–≥–æ –∫–ª–∞—Å—Å–∞.
