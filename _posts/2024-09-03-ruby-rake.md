---
layout: post
title:  "Ruby Rake â€” Ñ‚Ğ°Ğ¹Ğ½Ñ‹Ğ¹ Ğ¿Ğ¾Ğ¼Ğ¾Ñ‰Ğ½Ğ¸Ğº"
rate: 4
tags: Rake,Ruby,Ğ°Ğ²Ñ‚Ğ¾Ğ¼Ğ°Ñ‚Ğ¸Ğ·Ğ°Ñ†Ğ¸Ñ,Ñ‚ĞµÑÑ‚Ğ¸Ñ€Ğ¾Ğ²Ğ°Ğ½Ğ¸Ğµ,Ğ¼Ğ¾Ğ½Ğ¸Ñ‚Ğ¾Ñ€Ğ¸Ğ½Ğ³,Ğ¼Ğ¸Ğ³Ñ€Ğ°Ñ†Ğ¸Ğ¸
version: A49X3
date:   2024-09-18 12:00:00 +0300
categories:
  - gems
  - ruby
hero_image: /images/ruby.jpg
hero_darken: true
toc: true
menubar_toc: true
---

Rake â€” ÑÑ‚Ğ¾ ĞºĞ°Ğº **ÑˆĞ²ĞµĞ¹Ñ†Ğ°Ñ€ÑĞºĞ¸Ğ¹ Ğ½Ğ¾Ğ¶** Ğ² Ğ¼Ğ¸Ñ€Ğµ Ruby, ĞºĞ¾Ñ‚Ğ¾Ñ€Ñ‹Ğ¹ Ğ³Ğ¾Ğ´Ğ°Ğ¼Ğ¸ Ğ¿Ñ‹Ğ»Ğ¸Ñ‚ÑÑ Ğ² ÑÑ‰Ğ¸ĞºĞµ, Ğ¿Ğ¾ĞºĞ° Ğ¾Ğ´Ğ½Ğ°Ğ¶Ğ´Ñ‹ Ğ½Ğµ ÑĞ¿Ğ°ÑĞ°ĞµÑ‚ Ğ²Ğ°Ñˆ Ğ¿Ñ€Ğ¾ĞµĞºÑ‚ Ğ¾Ñ‚ Ñ…Ğ°Ğ¾ÑĞ°. Ğ’ ÑÑ‚Ğ°Ñ‚ÑŒĞµ Ñ€Ğ°Ğ·Ğ±ĞµÑ€Ñ‘Ğ¼, ĞºĞ°Ğº Ğ¿Ñ€ĞµĞ²Ñ€Ğ°Ñ‚Ğ¸Ñ‚ÑŒ Rake Ğ¸Ğ· "Ğ½ÑƒĞ¶Ğ½Ğ¾Ğ³Ğ¾ Ğ´Ğ»Ñ Ğ¼Ğ¸Ğ³Ñ€Ğ°Ñ†Ğ¸Ğ¹" Ğ² Ğ¼Ğ¾Ñ‰Ğ½Ñ‹Ğ¹ Ğ¸Ğ½ÑÑ‚Ñ€ÑƒĞ¼ĞµĞ½Ñ‚ Ğ´Ğ»Ñ Ğ°Ğ²Ñ‚Ğ¾Ğ¼Ğ°Ñ‚Ğ¸Ğ·Ğ°Ñ†Ğ¸Ğ¸, Ñ‚ĞµÑÑ‚Ğ¸Ñ€Ğ¾Ğ²Ğ°Ğ½Ğ¸Ñ Ğ¸ Ğ´Ğ°Ğ¶Ğµ Ğ¼Ğ¾Ğ½Ğ¸Ñ‚Ğ¾Ñ€Ğ¸Ğ½Ğ³Ğ°, Ñ Ğ¿Ñ€Ğ¸Ğ¼ĞµÑ€Ğ°Ğ¼Ğ¸ Ğ¸Ğ· Ñ€ĞµĞ°Ğ»ÑŒĞ½Ñ‹Ñ… Ğ±Ğ¾ĞµĞ²Ñ‹Ñ… ÑƒÑĞ»Ğ¾Ğ²Ğ¸Ğ¹.

---

## ï¿½ ĞŸĞ¾Ñ‡ĞµĞ¼Ñƒ Rake â€” ÑÑ‚Ğ¾ Ğ½Ğµ Ñ‚Ğ¾Ğ»ÑŒĞºĞ¾ `db:migrate`

ĞšĞ¾Ğ³Ğ´Ğ° Ğ½Ğ¾Ğ²Ğ¸Ñ‡Ğ¾Ğº Ğ²Ğ¸Ğ´Ğ¸Ñ‚ `rake -T`, Ğ¾Ğ½ Ğ¾Ğ±Ñ‹Ñ‡Ğ½Ğ¾ Ğ¾Ğ±Ğ½Ğ°Ñ€ÑƒĞ¶Ğ¸Ğ²Ğ°ĞµÑ‚ Ñ‚Ğ°Ğ¼:
```bash
rake db:migrate      # ĞĞ°ĞºĞ°Ñ‚Ğ¸Ñ‚ÑŒ Ğ¼Ğ¸Ğ³Ñ€Ğ°Ñ†Ğ¸Ğ¸
rake db:seed         # Ğ—Ğ°Ğ¿Ğ¾Ğ»Ğ½Ğ¸Ñ‚ÑŒ Ğ±Ğ°Ğ·Ñƒ Ñ‚ĞµÑÑ‚Ğ¾Ğ²Ñ‹Ğ¼Ğ¸ Ğ´Ğ°Ğ½Ğ½Ñ‹Ğ¼Ğ¸
```
Ğ˜ Ğ´ÑƒĞ¼Ğ°ĞµÑ‚: "ĞÑƒ Ğ¾Ğº, ÑĞºÑƒÑ‡Ğ½Ğ¾". ĞĞ¾ Ğ¿Ğ¾Ğ´ ĞºĞ°Ğ¿Ğ¾Ñ‚Ğ¾Ğ¼ â€” **Ñ†ĞµĞ»Ñ‹Ğ¹ ÑĞ·Ñ‹Ğº Ğ°Ğ²Ñ‚Ğ¾Ğ¼Ğ°Ñ‚Ğ¸Ğ·Ğ°Ñ†Ğ¸Ğ¸** Ñ Ğ·Ğ°Ğ²Ğ¸ÑĞ¸Ğ¼Ğ¾ÑÑ‚ÑĞ¼Ğ¸, Ğ¾Ğ¿Ğ¸ÑĞ°Ğ½Ğ¸ĞµĞ¼ Ğ·Ğ°Ğ´Ğ°Ñ‡ Ğ¸ Ğ¸Ğ½Ñ‚ĞµĞ³Ñ€Ğ°Ñ†Ğ¸ĞµĞ¹ Ğ² Ruby-ÑĞºĞ¾ÑĞ¸ÑÑ‚ĞµĞ¼Ñƒ.

---

## ğŸ”§ Ğ‘Ğ°Ğ·Ğ¾Ğ²Ñ‹Ğ¹ Ğ¿Ñ€Ğ¸Ğ¼ĞµÑ€: Ğ·Ğ°Ğ´Ğ°Ñ‡Ğ° Ğ´Ğ»Ñ Ğ¾Ñ‡Ğ¸ÑÑ‚ĞºĞ¸ ĞºÑÑˆĞ°

Ğ”Ğ¾Ğ¿ÑƒÑÑ‚Ğ¸Ğ¼, Ğ²Ğ°Ğ¼ Ğ½Ğ°Ğ´Ğ¾ĞµĞ»Ğ¾ Ğ²Ñ€ÑƒÑ‡Ğ½ÑƒÑ Ñ‡Ğ¸ÑÑ‚Ğ¸Ñ‚ÑŒ `tmp/cache`. ĞŸĞ¸ÑˆĞµĞ¼ Ğ² `lib/tasks/cache.rake`:
```ruby
desc "ĞÑ‡Ğ¸Ñ‰Ğ°ĞµÑ‚ ĞºÑÑˆ Ğ¿Ñ€Ğ¸Ğ»Ğ¾Ğ¶ĞµĞ½Ğ¸Ñ"
task :clear_cache do
  puts "ğŸ’¥ Ğ£Ğ´Ğ°Ğ»ÑĞµĞ¼ Ñ„Ğ°Ğ¹Ğ»Ñ‹ ĞºÑÑˆĞ°..."
  FileUtils.rm_rf(Dir.glob('tmp/cache/*'))
  puts "âœ… Ğ“Ğ¾Ñ‚Ğ¾Ğ²Ğ¾!"
end
```

Ğ’Ñ‹Ğ·Ñ‹Ğ²Ğ°ĞµĞ¼:
```bash
rake clear_cache
```

Ğ£Ğ¶Ğµ Ğ¿Ğ¾Ğ»ĞµĞ·Ğ½ĞµĞµ, Ñ‡ĞµĞ¼ Ñ€ÑƒÑ‡Ğ½Ğ°Ñ Ğ²Ğ¾Ğ·Ğ½Ñ Ñ `rm`!

---

## ğŸ§© ĞŸÑ€Ğ¾Ğ´Ğ²Ğ¸Ğ½ÑƒÑ‚Ñ‹Ğµ Ñ„Ğ¸ÑˆĞºĞ¸

### 1. Ğ—Ğ°Ğ²Ğ¸ÑĞ¸Ğ¼Ğ¾ÑÑ‚Ğ¸ Ğ¼ĞµĞ¶Ğ´Ñƒ Ğ·Ğ°Ğ´Ğ°Ñ‡Ğ°Ğ¼Ğ¸
```ruby
task :build => [:compile, :test] do
  puts "Ğ¡Ğ±Ğ¾Ñ€ĞºĞ° Ğ·Ğ°Ğ²ĞµÑ€ÑˆĞµĞ½Ğ°!"
end
```

### 2. ĞÑ€Ğ³ÑƒĞ¼ĞµĞ½Ñ‚Ñ‹
```ruby
task :greet, [:name] do |t, args|
  puts "ĞŸÑ€Ğ¸Ğ²ĞµÑ‚, #{args.name}!"
end
```
Ğ’Ñ‹Ğ·Ğ¾Ğ²: `rake greet[Ğ˜Ğ²Ğ°Ğ½]`

### 3. Ğ˜ÑĞ¿Ğ¾Ğ»ÑŒĞ·Ğ¾Ğ²Ğ°Ğ½Ğ¸Ğµ Rails-Ğ¾ĞºÑ€ÑƒĞ¶ĞµĞ½Ğ¸Ñ
```ruby
task :heavy_report => :environment do  # Ğ—Ğ°Ğ³Ñ€ÑƒĞ¶Ğ°ĞµÑ‚ Rails
  User.find_each { |u| puts u.email }
end
```

---

## ğŸ’¼ Ğ ĞµĞ°Ğ»ÑŒĞ½Ñ‹Ğµ ĞºĞµĞ¹ÑÑ‹ Ğ¸Ğ· Ğ¿Ñ€Ğ°ĞºÑ‚Ğ¸ĞºĞ¸

### 1. **Ğ•Ğ¶ĞµĞ´Ğ½ĞµĞ²Ğ½Ñ‹Ğ¹ Ğ¾Ñ‚Ñ‡Ñ‘Ñ‚ Ğ² Slack**
```ruby
task :daily_stats => :environment do
  stats = {
    new_users: User.where("created_at > ?", 1.day.ago).count,
    revenue: Payment.where(created_at: Time.zone.now.all_day).sum(:amount)
  }
  
  SlackNotifier.new.post("ğŸ“Š ĞÑ‚Ñ‡Ñ‘Ñ‚ Ğ·Ğ° #{Date.today}: #{stats.to_json}")
end
```

### 2. **ĞœĞ°ÑÑĞ¾Ğ²Ñ‹Ğ¹ Ñ„Ğ¸ĞºÑ Ğ´Ğ°Ğ½Ğ½Ñ‹Ñ…** (ĞºĞ¾Ğ³Ğ´Ğ° Ğ¼Ğ¸Ğ³Ñ€Ğ°Ñ†Ğ¸Ñ Ğ½Ğµ Ğ¿Ğ¾Ğ´Ñ…Ğ¾Ğ´Ğ¸Ñ‚)
```ruby
task :fix_legacy_emails => :environment do
  User.where("email LIKE '%Ğ¿Ñ€Ğ¸Ğ¼ĞµÑ€%'").find_each do |user|
    user.update!(email: user.email.gsub('Ğ¿Ñ€Ğ¸Ğ¼ĞµÑ€', 'example'))
  end
end
```

### 3. **ĞŸÑ€Ğ¾Ğ²ĞµÑ€ĞºĞ° Ñ†ĞµĞ»Ğ¾ÑÑ‚Ğ½Ğ¾ÑÑ‚Ğ¸ Ğ´Ğ°Ğ½Ğ½Ñ‹Ñ…**
```ruby
task :check_orphaned_records => :environment do
  Post.left_joins(:user).where(users: { id: nil }).each do |post|
    puts "ĞŸĞ¾ÑÑ‚ #{post.id} Ğ±ĞµĞ· Ğ¿Ğ¾Ğ»ÑŒĞ·Ğ¾Ğ²Ğ°Ñ‚ĞµĞ»Ñ!"
  end
end
```

---

## ğŸ’£ ĞĞ½Ñ‚Ğ¸Ğ¿Ğ°Ñ‚Ñ‚ĞµÑ€Ğ½Ñ‹

1. **Ğ“Ğ¸Ğ³Ğ°Ğ½Ñ‚ÑĞºĞ¸Ğµ rake-Ñ„Ğ°Ğ¹Ğ»Ñ‹**  
   ĞĞµ Ğ¿Ñ€ĞµĞ²Ñ€Ğ°Ñ‰Ğ°Ğ¹Ñ‚Ğµ `lib/tasks` Ğ² ÑĞ²Ğ°Ğ»ĞºÑƒ. Ğ”Ñ€Ğ¾Ğ±Ğ¸Ñ‚Ğµ Ğ»Ğ¾Ğ³Ğ¸ĞºÑƒ:
   ```
   lib/tasks/
     â”œâ”€â”€ db.rake
     â”œâ”€â”€ reports.rake
     â””â”€â”€ maintenance.rake
   ```

2. **Ğ¢Ğ¸Ñ…Ğ¸Ğµ Ğ¿Ğ°Ğ´ĞµĞ½Ğ¸Ñ**  
   Ğ’ÑĞµĞ³Ğ´Ğ° Ğ¾Ğ±Ñ€Ğ°Ğ±Ğ°Ñ‚Ñ‹Ğ²Ğ°Ğ¹Ñ‚Ğµ Ğ¾ÑˆĞ¸Ğ±ĞºĞ¸:
   ```ruby
   task :dangerous do
     begin
       # ĞšĞ¾Ğ´
     rescue => e
       puts "ğŸ’¥ ĞÑˆĞ¸Ğ±ĞºĞ°: #{e.message}"
       exit 1  # Ğ’Ğ°Ğ¶Ğ½Ğ¾ Ğ´Ğ»Ñ CI/CD!
     end
   end
   ```

3. **Ğ—Ğ°Ğ´Ğ°Ñ‡Ğ¸ Ğ±ĞµĞ· Ğ¾Ğ¿Ğ¸ÑĞ°Ğ½Ğ¸Ñ**  
   `desc` â€” Ğ²Ğ°ÑˆĞ° Ğ´Ğ¾ĞºÑƒĞ¼ĞµĞ½Ñ‚Ğ°Ñ†Ğ¸Ñ:
   ```ruby
   # ĞŸĞ»Ğ¾Ñ…Ğ¾:
   task :mystery_task
   
   # Ğ¥Ğ¾Ñ€Ğ¾ÑˆĞ¾:
   desc "Ğ“ĞµĞ½ĞµÑ€Ğ¸Ñ€ÑƒĞµÑ‚ CSV-Ğ¾Ñ‚Ñ‡Ñ‘Ñ‚ Ğ¿Ğ¾ Ğ¿Ğ»Ğ°Ñ‚ĞµĞ¶Ğ°Ğ¼"
   task :generate_payments_report
   ```

---

## ğŸ›  Ğ˜Ğ½Ñ‚ĞµĞ³Ñ€Ğ°Ñ†Ğ¸Ñ Ñ ÑĞ¾Ğ²Ñ€ĞµĞ¼ĞµĞ½Ğ½Ñ‹Ğ¼ ÑÑ‚ĞµĞºĞ¾Ğ¼

### 1. **Docker + Rake**
```dockerfile
COPY lib/tasks /app/lib/tasks
CMD ["rake", "daily_stats"]
```

### 2. **CI/CD (GitLab example)**
```yaml
run_reports:
  script:
    - bundle exec rake generate_reports
  only:
    - schedules
```

### 3. **ĞœĞ¾Ğ½Ğ¸Ñ‚Ğ¾Ñ€Ğ¸Ğ½Ğ³ Ñ‡ĞµÑ€ĞµĞ· Healthchecks.io**
```ruby
task :cron_job do
  require 'net/http'
  Net::HTTP.get(URI('https://hc-ping.com/your-uuid'))
  # ĞÑĞ½Ğ¾Ğ²Ğ½Ğ°Ñ Ğ»Ğ¾Ğ³Ğ¸ĞºĞ°
  Net::HTTP.get(URI('https://hc-ping.com/your-uuid/ok'))
end
```

---

## ğŸ¯ Ğ’Ñ‹Ğ²Ğ¾Ğ´

Rake â€” ÑÑ‚Ğ¾ **Ğ²Ğ°Ñˆ Ğ»Ğ¸Ñ‡Ğ½Ñ‹Ğ¹ Ğ°ÑÑĞ¸ÑÑ‚ĞµĞ½Ñ‚**, ĞºĞ¾Ñ‚Ğ¾Ñ€Ñ‹Ğ¹ ÑƒĞ¼ĞµĞµÑ‚:
- ĞĞ²Ñ‚Ğ¾Ğ¼Ğ°Ñ‚Ğ¸Ğ·Ğ¸Ñ€Ğ¾Ğ²Ğ°Ñ‚ÑŒ Ñ€ÑƒÑ‚Ğ¸Ğ½Ñƒ âœ…
- Ğ§Ğ¸Ğ½Ğ¸Ñ‚ÑŒ Ğ´Ğ°Ğ½Ğ½Ñ‹Ğµ Ğ² Ğ¿Ñ€Ğ¾Ğ´Ğµ ğŸ”§
- Ğ“ĞµĞ½ĞµÑ€Ğ¸Ñ€Ğ¾Ğ²Ğ°Ñ‚ÑŒ Ğ¾Ñ‚Ñ‡Ñ‘Ñ‚Ñ‹ ğŸ“Š
- Ğ Ğ°Ğ±Ğ¾Ñ‚Ğ°Ñ‚ÑŒ Ğ¿Ğ¾ Ñ€Ğ°ÑĞ¿Ğ¸ÑĞ°Ğ½Ğ¸Ñ â°

**Ğ¡Ğ¾Ğ²ĞµÑ‚:** Ğ—Ğ°Ğ²ĞµĞ´Ğ¸Ñ‚Ğµ `rake -T` Ğ² ÑĞ²Ğ¾Ñ‘Ğ¼ Ğ¿Ñ€Ğ¾ĞµĞºÑ‚Ğµ Ğ¿Ñ€ÑĞ¼Ğ¾ ÑĞµĞ¹Ñ‡Ğ°Ñ â€” Ğ²Ğ¾Ğ·Ğ¼Ğ¾Ğ¶Ğ½Ğ¾, Ğ²Ñ‹ Ğ¾Ğ±Ğ½Ğ°Ñ€ÑƒĞ¶Ğ¸Ñ‚Ğµ Ğ·Ğ°Ğ±Ñ‹Ñ‚Ñ‹Ğµ Ğ·Ğ°Ğ´Ğ°Ñ‡Ğ¸, ĞºĞ¾Ñ‚Ğ¾Ñ€Ñ‹Ğµ ÑƒĞ¶Ğµ Ñ€ĞµÑˆĞ°ÑÑ‚ Ğ²Ğ°ÑˆĞ¸ Ğ¿Ñ€Ğ¾Ğ±Ğ»ĞµĞ¼Ñ‹.

> "Ğ¥Ğ¾Ñ€Ğ¾ÑˆĞ¸Ğ¹ Ñ€Ğ°Ğ·Ñ€Ğ°Ğ±Ğ¾Ñ‚Ñ‡Ğ¸Ğº Ğ¿Ğ¸ÑˆĞµÑ‚ ĞºĞ¾Ğ´. ĞÑ‚Ğ»Ğ¸Ñ‡Ğ½Ñ‹Ğ¹ â€” Ğ·Ğ°ÑÑ‚Ğ°Ğ²Ğ»ÑĞµÑ‚ ĞºĞ¾Ğ´ Ñ€Ğ°Ğ±Ğ¾Ñ‚Ğ°Ñ‚ÑŒ Ğ·Ğ° ÑĞµĞ±Ñ."  
> *â€” Rake-Ğ¼Ğ°Ğ½Ğ¸Ñ„ĞµÑÑ‚*
