---
layout: post
subtitle: <div id="terminal"></div>
title:  "Ruby Rake ‚Äî —Ç–∞–π–Ω—ã–π –ø–æ–º–æ—â–Ω–∏–∫"
rate: 4
tags: Rake,Ruby,–∞–≤—Ç–æ–º–∞—Ç–∏–∑–∞—Ü–∏—è,—Ç–µ—Å—Ç–∏—Ä–æ–≤–∞–Ω–∏–µ,–º–æ–Ω–∏—Ç–æ—Ä–∏–Ω–≥,–º–∏–≥—Ä–∞—Ü–∏–∏
version: A9X
date:   2024-09-18 12:00:00 +0300
categories:
  - gems
  - ruby
hero_image: /images/ruby.jpg
hero_darken: true
toc: true
menubar_toc: true
---

Rake ‚Äî —ç—Ç–æ –∫–∞–∫ **—à–≤–µ–π—Ü–∞—Ä—Å–∫–∏–π –Ω–æ–∂** –≤ –º–∏—Ä–µ Ruby, –∫–æ—Ç–æ—Ä—ã–π –≥–æ–¥–∞–º–∏ –ø—ã–ª–∏—Ç—Å—è –≤ —è—â–∏–∫–µ, –ø–æ–∫–∞ –æ–¥–Ω–∞–∂–¥—ã –Ω–µ —Å–ø–∞—Å–∞–µ—Ç –≤–∞—à –ø—Ä–æ–µ–∫—Ç –æ—Ç —Ö–∞–æ—Å–∞. –í —Å—Ç–∞—Ç—å–µ —Ä–∞–∑–±–µ—Ä—ë–º, –∫–∞–∫ –ø—Ä–µ–≤—Ä–∞—Ç–∏—Ç—å Rake –∏–∑ "–Ω—É–∂–Ω–æ–≥–æ –¥–ª—è –º–∏–≥—Ä–∞—Ü–∏–π" –≤ –º–æ—â–Ω—ã–π –∏–Ω—Å—Ç—Ä—É–º–µ–Ω—Ç –¥–ª—è –∞–≤—Ç–æ–º–∞—Ç–∏–∑–∞—Ü–∏–∏, —Ç–µ—Å—Ç–∏—Ä–æ–≤–∞–Ω–∏—è –∏ –¥–∞–∂–µ –º–æ–Ω–∏—Ç–æ—Ä–∏–Ω–≥–∞, —Å –ø—Ä–∏–º–µ—Ä–∞–º–∏ –∏–∑ —Ä–µ–∞–ª—å–Ω—ã—Ö –±–æ–µ–≤—ã—Ö —É—Å–ª–æ–≤–∏–π.

---

## ÔøΩ –ü–æ—á–µ–º—É Rake ‚Äî —ç—Ç–æ –Ω–µ —Ç–æ–ª—å–∫–æ `db:migrate`

–ö–æ–≥–¥–∞ –Ω–æ–≤–∏—á–æ–∫ –≤–∏–¥–∏—Ç `rake -T`, –æ–Ω –æ–±—ã—á–Ω–æ –æ–±–Ω–∞—Ä—É–∂–∏–≤–∞–µ—Ç —Ç–∞–º:
```bash
rake db:migrate      # –ù–∞–∫–∞—Ç–∏—Ç—å –º–∏–≥—Ä–∞—Ü–∏–∏
rake db:seed         # –ó–∞–ø–æ–ª–Ω–∏—Ç—å –±–∞–∑—É —Ç–µ—Å—Ç–æ–≤—ã–º–∏ –¥–∞–Ω–Ω—ã–º–∏
```
–ò –¥—É–º–∞–µ—Ç: "–ù—É –æ–∫, —Å–∫—É—á–Ω–æ". –ù–æ –ø–æ–¥ –∫–∞–ø–æ—Ç–æ–º ‚Äî **—Ü–µ–ª—ã–π —è–∑—ã–∫ –∞–≤—Ç–æ–º–∞—Ç–∏–∑–∞—Ü–∏–∏** —Å –∑–∞–≤–∏—Å–∏–º–æ—Å—Ç—è–º–∏, –æ–ø–∏—Å–∞–Ω–∏–µ–º –∑–∞–¥–∞—á –∏ –∏–Ω—Ç–µ–≥—Ä–∞—Ü–∏–µ–π –≤ Ruby-—ç–∫–æ—Å–∏—Å—Ç–µ–º—É.

---

## üîß –ë–∞–∑–æ–≤—ã–π –ø—Ä–∏–º–µ—Ä: –∑–∞–¥–∞—á–∞ –¥–ª—è –æ—á–∏—Å—Ç–∫–∏ –∫—ç—à–∞

–î–æ–ø—É—Å—Ç–∏–º, –≤–∞–º –Ω–∞–¥–æ–µ–ª–æ –≤—Ä—É—á–Ω—É—é —á–∏—Å—Ç–∏—Ç—å `tmp/cache`. –ü–∏—à–µ–º –≤ `lib/tasks/cache.rake`:
```ruby
desc "–û—á–∏—â–∞–µ—Ç –∫—ç—à –ø—Ä–∏–ª–æ–∂–µ–Ω–∏—è"
task :clear_cache do
  puts "üí• –£–¥–∞–ª—è–µ–º —Ñ–∞–π–ª—ã –∫—ç—à–∞..."
  FileUtils.rm_rf(Dir.glob('tmp/cache/*'))
  puts "‚úÖ –ì–æ—Ç–æ–≤–æ!"
end
```

–í—ã–∑—ã–≤–∞–µ–º:
```bash
rake clear_cache
```

–£–∂–µ –ø–æ–ª–µ–∑–Ω–µ–µ, —á–µ–º —Ä—É—á–Ω–∞—è –≤–æ–∑–Ω—è —Å `rm`!

---

## üß© –ü—Ä–æ–¥–≤–∏–Ω—É—Ç—ã–µ —Ñ–∏—à–∫–∏

### 1. –ó–∞–≤–∏—Å–∏–º–æ—Å—Ç–∏ –º–µ–∂–¥—É –∑–∞–¥–∞—á–∞–º–∏
```ruby
task :build => [:compile, :test] do
  puts "–°–±–æ—Ä–∫–∞ –∑–∞–≤–µ—Ä—à–µ–Ω–∞!"
end
```

### 2. –ê—Ä–≥—É–º–µ–Ω—Ç—ã
```ruby
task :greet, [:name] do |t, args|
  puts "–ü—Ä–∏–≤–µ—Ç, #{args.name}!"
end
```
–í—ã–∑–æ–≤: `rake greet[–ò–≤–∞–Ω]`

### 3. –ò—Å–ø–æ–ª—å–∑–æ–≤–∞–Ω–∏–µ Rails-–æ–∫—Ä—É–∂–µ–Ω–∏—è
```ruby
task :heavy_report => :environment do  # –ó–∞–≥—Ä—É–∂–∞–µ—Ç Rails
  User.find_each { |u| puts u.email }
end
```

---

## üíº –†–µ–∞–ª—å–Ω—ã–µ –∫–µ–π—Å—ã –∏–∑ –ø—Ä–∞–∫—Ç–∏–∫–∏

### 1. **–ï–∂–µ–¥–Ω–µ–≤–Ω—ã–π –æ—Ç—á—ë—Ç –≤ Slack**
```ruby
task :daily_stats => :environment do
  stats = {
    new_users: User.where("created_at > ?", 1.day.ago).count,
    revenue: Payment.where(created_at: Time.zone.now.all_day).sum(:amount)
  }
  
  SlackNotifier.new.post("üìä –û—Ç—á—ë—Ç –∑–∞ #{Date.today}: #{stats.to_json}")
end
```

### 2. **–ú–∞—Å—Å–æ–≤—ã–π —Ñ–∏–∫—Å –¥–∞–Ω–Ω—ã—Ö** (–∫–æ–≥–¥–∞ –º–∏–≥—Ä–∞—Ü–∏—è –Ω–µ –ø–æ–¥—Ö–æ–¥–∏—Ç)
```ruby
task :fix_legacy_emails => :environment do
  User.where("email LIKE '%–ø—Ä–∏–º–µ—Ä%'").find_each do |user|
    user.update!(email: user.email.gsub('–ø—Ä–∏–º–µ—Ä', 'example'))
  end
end
```

### 3. **–ü—Ä–æ–≤–µ—Ä–∫–∞ —Ü–µ–ª–æ—Å—Ç–Ω–æ—Å—Ç–∏ –¥–∞–Ω–Ω—ã—Ö**
```ruby
task :check_orphaned_records => :environment do
  Post.left_joins(:user).where(users: { id: nil }).each do |post|
    puts "–ü–æ—Å—Ç #{post.id} –±–µ–∑ –ø–æ–ª—å–∑–æ–≤–∞—Ç–µ–ª—è!"
  end
end
```

---

## üí£ –ê–Ω—Ç–∏–ø–∞—Ç—Ç–µ—Ä–Ω—ã

1. **–ì–∏–≥–∞–Ω—Ç—Å–∫–∏–µ rake-—Ñ–∞–π–ª—ã**  
   –ù–µ –ø—Ä–µ–≤—Ä–∞—â–∞–π—Ç–µ `lib/tasks` –≤ —Å–≤–∞–ª–∫—É. –î—Ä–æ–±–∏—Ç–µ –ª–æ–≥–∏–∫—É:
   ```
   lib/tasks/
     ‚îú‚îÄ‚îÄ db.rake
     ‚îú‚îÄ‚îÄ reports.rake
     ‚îî‚îÄ‚îÄ maintenance.rake
   ```

2. **–¢–∏—Ö–∏–µ –ø–∞–¥–µ–Ω–∏—è**  
   –í—Å–µ–≥–¥–∞ –æ–±—Ä–∞–±–∞—Ç—ã–≤–∞–π—Ç–µ –æ—à–∏–±–∫–∏:
   ```ruby
   task :dangerous do
     begin
       # –ö–æ–¥
     rescue => e
       puts "üí• –û—à–∏–±–∫–∞: #{e.message}"
       exit 1  # –í–∞–∂–Ω–æ –¥–ª—è CI/CD!
     end
   end
   ```

3. **–ó–∞–¥–∞—á–∏ –±–µ–∑ –æ–ø–∏—Å–∞–Ω–∏—è**  
   `desc` ‚Äî –≤–∞—à–∞ –¥–æ–∫—É–º–µ–Ω—Ç–∞—Ü–∏—è:
   ```ruby
   # –ü–ª–æ—Ö–æ:
   task :mystery_task
   
   # –•–æ—Ä–æ—à–æ:
   desc "–ì–µ–Ω–µ—Ä–∏—Ä—É–µ—Ç CSV-–æ—Ç—á—ë—Ç –ø–æ –ø–ª–∞—Ç–µ–∂–∞–º"
   task :generate_payments_report
   ```

---

## üõ† –ò–Ω—Ç–µ–≥—Ä–∞—Ü–∏—è —Å —Å–æ–≤—Ä–µ–º–µ–Ω–Ω—ã–º —Å—Ç–µ–∫–æ–º

### 1. **Docker + Rake**
```dockerfile
COPY lib/tasks /app/lib/tasks
CMD ["rake", "daily_stats"]
```

### 2. **CI/CD (GitLab example)**
```yaml
run_reports:
  script:
    - bundle exec rake generate_reports
  only:
    - schedules
```

### 3. **–ú–æ–Ω–∏—Ç–æ—Ä–∏–Ω–≥ —á–µ—Ä–µ–∑ Healthchecks.io**
```ruby
task :cron_job do
  require 'net/http'
  Net::HTTP.get(URI('https://hc-ping.com/your-uuid'))
  # –û—Å–Ω–æ–≤–Ω–∞—è –ª–æ–≥–∏–∫–∞
  Net::HTTP.get(URI('https://hc-ping.com/your-uuid/ok'))
end
```

---

## üéØ –í—ã–≤–æ–¥

Rake ‚Äî —ç—Ç–æ **–≤–∞—à –ª–∏—á–Ω—ã–π –∞—Å—Å–∏—Å—Ç–µ–Ω—Ç**, –∫–æ—Ç–æ—Ä—ã–π —É–º–µ–µ—Ç:
- –ê–≤—Ç–æ–º–∞—Ç–∏–∑–∏—Ä–æ–≤–∞—Ç—å —Ä—É—Ç–∏–Ω—É ‚úÖ
- –ß–∏–Ω–∏—Ç—å –¥–∞–Ω–Ω—ã–µ –≤ –ø—Ä–æ–¥–µ üîß
- –ì–µ–Ω–µ—Ä–∏—Ä–æ–≤–∞—Ç—å –æ—Ç—á—ë—Ç—ã üìä
- –†–∞–±–æ—Ç–∞—Ç—å –ø–æ —Ä–∞—Å–ø–∏—Å–∞–Ω–∏—é ‚è∞

**–°–æ–≤–µ—Ç:** –ó–∞–≤–µ–¥–∏—Ç–µ `rake -T` –≤ —Å–≤–æ—ë–º –ø—Ä–æ–µ–∫—Ç–µ –ø—Ä—è–º–æ —Å–µ–π—á–∞—Å ‚Äî –≤–æ–∑–º–æ–∂–Ω–æ, –≤—ã –æ–±–Ω–∞—Ä—É–∂–∏—Ç–µ –∑–∞–±—ã—Ç—ã–µ –∑–∞–¥–∞—á–∏, –∫–æ—Ç–æ—Ä—ã–µ —É–∂–µ —Ä–µ—à–∞—é—Ç –≤–∞—à–∏ –ø—Ä–æ–±–ª–µ–º—ã.

> "–•–æ—Ä–æ—à–∏–π —Ä–∞–∑—Ä–∞–±–æ—Ç—á–∏–∫ –ø–∏—à–µ—Ç –∫–æ–¥. –û—Ç–ª–∏—á–Ω—ã–π ‚Äî –∑–∞—Å—Ç–∞–≤–ª—è–µ—Ç –∫–æ–¥ —Ä–∞–±–æ—Ç–∞—Ç—å –∑–∞ —Å–µ–±—è."  
> *‚Äî Rake-–º–∞–Ω–∏—Ñ–µ—Å—Ç*
