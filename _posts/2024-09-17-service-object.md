---
layout: post
subtitle: <div id="terminal"></div>
title:  "Service Object –≤ Ruby: –∫–æ–≥–¥–∞ `.call` —É–∂–µ –Ω–µ —Å–ø—Ä–∞–≤–ª—è–µ—Ç—Å—è"
date:   2024-09-17 12:00:00 +0300
rate: 4
tags: Ruby on Rails,Service Object,–±–∏–∑–Ω–µ—Å-–ª–æ–≥–∏–∫–∞,PostgreSQL,DevOps,–º–∞—Å—à—Ç–∞–±–∏—Ä—É–µ–º–æ—Å—Ç—å
version: A9X
categories:
  - pattern
  - ruby
hero_image: /images/posts/25.jpg
hero_darken: true
toc: true
menubar_toc: true
---
Service Object –≤ Ruby on Rails ‚Äî —ç—Ç–æ –º–æ—â–Ω—ã–π –∏–Ω—Å—Ç—Ä—É–º–µ–Ω—Ç –¥–ª—è –≤—ã–Ω–µ—Å–µ–Ω–∏—è —Å–ª–æ–∂–Ω–æ–π –±–∏–∑–Ω–µ—Å-–ª–æ–≥–∏–∫–∏ –∏–∑ –∫–æ–Ω—Ç—Ä–æ–ª–ª–µ—Ä–æ–≤ –∏ –º–æ–¥–µ–ª–µ–π, –ø–æ–º–æ–≥–∞—é—â–∏–π —Å–æ–±–ª—é–¥–∞—Ç—å –ø—Ä–∏–Ω—Ü–∏–ø –µ–¥–∏–Ω–æ–π –æ—Ç–≤–µ—Ç—Å—Ç–≤–µ–Ω–Ω–æ—Å—Ç–∏. –í —Å—Ç–∞—Ç—å–µ —Ä–∞–∑–±–µ—Ä—ë–º, –∫–∞–∫ –ø—Ä–∞–≤–∏–ª—å–Ω–æ –ø—Ä–æ–µ–∫—Ç–∏—Ä–æ–≤–∞—Ç—å —Å–µ—Ä–≤–∏—Å–Ω—ã–µ –æ–±—ä–µ–∫—Ç—ã, –∏–∑–±–µ–≥–∞—è —Ç–∏–ø–∏—á–Ω—ã—Ö –æ—à–∏–±–æ–∫, –∏ –ø–æ–∫–∞–∂–µ–º –∏—Ö –∏–Ω—Ç–µ–≥—Ä–∞—Ü–∏—é —Å PostgreSQL –∏ DevOps-–ø—Ä–∞–∫—Ç–∏–∫–∞–º–∏ –¥–ª—è –º–∞—Å—à—Ç–∞–±–∏—Ä—É–µ–º—ã—Ö –ø—Ä–∏–ª–æ–∂–µ–Ω–∏–π.

---
–ò—Ç–∞–∫, —É –Ω–∞—Å –µ—Å—Ç—å `CreateUser.call(params)`‚Ä¶  
–ê –ø–æ—Ç–æ–º: `create_wallet`, `send_email`, `notify_crm`, `log_event`, `raise_if_duplicate`.  
–ò –≤—Å—ë —ç—Ç–æ ‚Äî –≤ –æ–¥–Ω–æ–º `Command`. –ß—Ç–æ –∂, –∑–Ω–∞—á–∏—Ç –ø—Ä–∏—à–ª–æ –≤—Ä–µ–º—è –¥–ª—è **Service Object**.

---

## üß† –¢–µ–æ—Ä–∏—è: —á—Ç–æ —Ç–∞–∫–æ–µ Service Object?

Service Object ‚Äî —ç—Ç–æ –æ–±—ä–µ–∫—Ç, –æ—Ç–≤–µ—á–∞—é—â–∏–π –∑–∞ **–±–∏–∑–Ω–µ—Å-–ø—Ä–æ—Ü–µ—Å—Å**.  
–û–±—ã—á–Ω–æ –æ–Ω —Ä–µ–∞–ª–∏–∑—É–µ—Ç –º–µ—Ç–æ–¥ `.call` –∏–ª–∏ `#call`, –∫–æ—Ç–æ—Ä—ã–π –≤—ã–ø–æ–ª–Ω—è–µ—Ç —Å—Ä–∞–∑—É –Ω–µ—Å–∫–æ–ª—å–∫–æ —Å–≤—è–∑–∞–Ω–Ω—ã—Ö –æ–ø–µ—Ä–∞—Ü–∏–π.

–û–Ω **–∫–æ–æ—Ä–¥–∏–Ω–∏—Ä—É–µ—Ç –¥–µ–π—Å—Ç–≤–∏—è**, –º–æ–∂–µ—Ç –≤—ã–∑—ã–≤–∞—Ç—å –∫–æ–º–∞–Ω–¥—ã, —Ä–∞–±–æ—Ç–∞—Ç—å —Å –≤–Ω–µ—à–Ω–∏–º–∏ API, –∏ –ø—Ä–∏ —ç—Ç–æ–º –æ—Å—Ç–∞—ë—Ç—Å—è **—Ç–µ—Å—Ç–∏—Ä—É–µ–º—ã–º –∏ –∏–∑–æ–ª–∏—Ä–æ–≤–∞–Ω–Ω—ã–º**.

---

## üîß –ü—Ä–∏–º–µ—Ä

```ruby
class Users::SignupService
  def initialize(params)
    @params = params
  end

  def call
    user = User.create!(@params)
    Wallet.create!(user: user)
    SendWelcomeEmail.call(user)
    CrmNotifier.new(user).notify_signup
    user
  end
end
````

–í—ã–∑—ã–≤–∞–µ—Ç—Å—è:

```ruby
Users::SignupService.new(params).call
```

---

## üí° –ö–æ–≥–¥–∞ –ø—Ä–∏–º–µ–Ω—è—Ç—å?

Service Object –Ω—É–∂–µ–Ω, –µ—Å–ª–∏:

* –û–ø–µ—Ä–∞—Ü–∏—è **–º–Ω–æ–≥–æ—Å–æ—Å—Ç–∞–≤–Ω–∞—è**: –Ω–µ—Å–∫–æ–ª—å–∫–æ —à–∞–≥–æ–≤, –∑–∞–≤–∏—Å–∏–º–æ—Å—Ç–µ–π, –º–æ–¥–µ–ª–µ–π.
* –ù—É–∂–Ω–∞ **—è–≤–Ω–∞—è –ø–æ—Å–ª–µ–¥–æ–≤–∞—Ç–µ–ª—å–Ω–æ—Å—Ç—å –¥–µ–π—Å—Ç–≤–∏–π** (–∫–∞–∫ –≤ —Å–∫—Ä–∏–ø—Ç–µ).
* –¢—Ä–µ–±—É–µ—Ç—Å—è **—Ä–∞–∑–¥–µ–ª–µ–Ω–∏–µ –æ—Ç–≤–µ—Ç—Å—Ç–≤–µ–Ω–Ω–æ—Å—Ç–∏**: –∫–æ–Ω—Ç—Ä–æ–ª–ª–µ—Ä ‚Üí —Å–µ—Ä–≤–∏—Å ‚Üí –∫–æ–º–∞–Ω–¥—ã/API.

–û–Ω —Ö–æ—Ä–æ—à –≤ –º–µ—Å—Ç–∞—Ö, –≥–¥–µ **"–Ω–µ —Ö–æ—á—É, —á—Ç–æ–±—ã —ç—Ç–æ –±—ã–ª–æ –≤ –∫–æ–Ω—Ç—Ä–æ–ª–ª–µ—Ä–µ, –∏ –Ω–µ –≤ –º–æ–¥–µ–ª–∏ —Ç–æ–∂–µ"**.

---

## üß™ –ü—Ä–∏–º–µ—Ä —Ç–µ—Å—Ç–∞

```ruby
describe Users::SignupService do
  it "—Å–æ–∑–¥–∞—ë—Ç –ø–æ–ª—å–∑–æ–≤–∞—Ç–µ–ª—è –∏ –∫–æ—à–µ–ª—ë–∫" do
    params = attributes_for(:user)
    expect {
      described_class.new(params).call
    }.to change(User, :count).by(1)
      .and change(Wallet, :count).by(1)
  end
end
```

–ú–æ–∂–Ω–æ –∑–∞–º–æ–∫–∞—Ç—å –≤—ã–∑–æ–≤—ã API, –ª–æ–≥–µ—Ä–æ–≤ –∏ e-mail –æ—Ç–ø—Ä–∞–≤—â–∏–∫–æ–≤ ‚Äî –∏ –ø–æ–ª—É—á–∏—Ç—å –ø—Ä–µ–¥—Å–∫–∞–∑—É–µ–º—ã–π unit-—Ç–µ—Å—Ç.

---

## üî• –ö–æ–≥–¥–∞ —ç—Ç–æ –ø—Ä–µ–≤—Ä–∞—â–∞–µ—Ç—Å—è –≤ –∞–Ω—Ç–∏–ø–∞—Ç—Ç–µ—Ä–Ω

| –°–ª—É—á–∞–π                                                         | –ü–æ—á–µ–º—É —ç—Ç–æ –ø–ª–æ—Ö–æ                |
| -------------------------------------------------------------- | ------------------------------- |
| –í —Å–µ—Ä–≤–∏—Å–µ 300 —Å—Ç—Ä–æ–∫, 5 —É—Ä–æ–≤–Ω–µ–π –≤–ª–æ–∂–µ–Ω–Ω–æ—Å—Ç–∏                     | –û–Ω –º—É—Ç–∏—Ä–æ–≤–∞–ª –≤ god-object       |
| –°–µ—Ä–≤–∏—Å —Å–∞–º —Å–æ–∑–¥–∞—ë—Ç –∫–æ–Ω—Ç—Ä–æ–ª–ª–µ—Ä, –º–æ–¥–µ–ª—å, –∫–æ–º–∞–Ω–¥—É                 | –ù–∞—Ä—É—à–µ–Ω–∏–µ –∏–Ω–≤–µ—Ä—Å–∏–∏ –∑–∞–≤–∏—Å–∏–º–æ—Å—Ç–µ–π |
| –í –ø—Ä–æ–µ–∫—Ç–µ 1000 —Å–µ—Ä–≤–∏—Å–æ–≤ —Å –Ω–∞–∑–≤–∞–Ω–∏—è–º–∏ `UserCreateStep42Service` | –ê—Ä—Ö–∏—Ç–µ–∫—Ç—É—Ä–∞ —Ä–∞–¥–∏ –∞—Ä—Ö–∏—Ç–µ–∫—Ç—É—Ä—ã    |

–ï—â—ë –æ–¥–Ω–∞ –±–æ–ª—å: **–Ω–µ–æ–¥–Ω–æ–∑–Ω–∞—á–Ω—ã–µ namespace'—ã**. –ì–¥–µ –∏—Å–∫–∞—Ç—å `BanUserService` ‚Äî –≤ `app/services/ban/`, `users/`, `actions/`?. –ü—Ä–∏–¥—ë—Ç—Å—è –¥–æ–≥–æ–≤–æ—Ä–∏—Ç—å—Å—è.

---

## üé§ –ß—Ç–æ —Å–∫–∞–∑–∞—Ç—å –Ω–∞ —Å–æ–±–µ—Å–µ

> ‚Äî –ü–æ—á–µ–º—É –≤—ã –Ω–µ –ø–∏—à–µ—Ç–µ –≤—Å—é –ª–æ–≥–∏–∫—É –≤ –º–æ–¥–µ–ª—è—Ö?

‚Äî –ú—ã –≤—ã–Ω–æ—Å–∏–º —Å–ª–æ–∂–Ω—ã–µ —Å—Ü–µ–Ω–∞—Ä–∏–∏ –≤ —Å–µ—Ä–≤–∏—Å—ã: —ç—Ç–æ –¥–µ–ª–∞–µ—Ç –∫–æ–¥ –ø—Ä–æ—â–µ, —É–º–µ–Ω—å—à–∞–µ—Ç –æ—Ç–≤–µ—Ç—Å—Ç–≤–µ–Ω–Ω–æ—Å—Ç—å –º–æ–¥–µ–ª–µ–π, –∏ —É–ª—É—á—à–∞–µ—Ç –ø–æ–∫—Ä—ã—Ç–∏–µ —Ç–µ—Å—Ç–∞–º–∏.

---

## üßæ –í—ã–≤–æ–¥

**Service Object ‚Äî –≤–∞—à —Ä–∞–±–æ—á–∏–π –≤–µ—Ä–±–ª—é–¥ –¥–ª—è –±–∏–∑–Ω–µ—Å-–ª–æ–≥–∏–∫–∏.**
–û–Ω –≤—ã—Ç–∞—Å–∫–∏–≤–∞–µ—Ç –∫–æ–Ω—Ç—Ä–æ–ª–ª–µ—Ä—ã –∏–∑ –±–æ–ª–æ—Ç–∞ `begin/rescue`, –º–æ–¥–µ–ª–∏ ‚Äî –∏–∑ –∂–∏—Ä–Ω—ã—Ö –∫–æ–ª–±—ç–∫–æ–≤, –∞ –≤–∞—Å ‚Äî —Å –ø—Ä–æ–¥–∞–∫—à–µ–Ω–∞ 31 –¥–µ–∫–∞–±—Ä—è –≤ 23:50.
