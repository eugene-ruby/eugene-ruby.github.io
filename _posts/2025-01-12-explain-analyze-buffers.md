---
layout: post
title:  "EXPLAIN ANALYZE BUFFERS: —á–∏—Ç–∞–µ–º –ø–ª–∞–Ω—ã PostgreSQL –∫–∞–∫ –ø—Ä–æ—Ñ–∏"
date:   2025-01-12 11:00:00 +0300
categories:
  - postgres
toc: true
menubar_toc: true
hero_image: /images/rails.jpeg
hero_darken: true
---

`EXPLAIN ANALYZE` ‚Äî –º–æ—â–Ω–µ–π—à–∏–π –∏–Ω—Å—Ç—Ä—É–º–µ–Ω—Ç –¥–ª—è –ø–æ–Ω–∏–º–∞–Ω–∏—è, **–ø–æ—á–µ–º—É –≤–∞—à SQL —Ç–æ—Ä–º–æ–∑–∏—Ç**. –ê –µ—Å–ª–∏ –¥–æ–±–∞–≤–∏—Ç—å `BUFFERS` ‚Äî –≤—ã —É–≤–∏–¥–∏—Ç–µ –µ—â—ë –∏ —Ä–µ–∞–ª—å–Ω–æ–µ –ø–æ—Ç—Ä–µ–±–ª–µ–Ω–∏–µ IO.

---

## üöÄ –ü—Ä–∏–º–µ—Ä

```sql
EXPLAIN (ANALYZE, BUFFERS)
SELECT * FROM users WHERE id IN (
  SELECT user_id FROM posts WHERE published = true
);
````

---

## üìä –ß—Ç–æ –ø–æ–∫–∞–∑—ã–≤–∞–µ—Ç –ø–ª–∞–Ω?

```text
Nested Loop  (cost=... rows=... width=...)
  -> Seq Scan on posts ...
  -> Index Scan using users_pkey on users ...
```

* `Nested Loop` ‚Äî –æ–¥–∏–Ω –∏–∑ –≤–∏–¥–æ–≤ join-–ø–ª–∞–Ω–æ–≤
* `Seq Scan` ‚Äî –ø–æ–ª–Ω—ã–π –ø—Ä–æ—Å–º–æ—Ç—Ä —Ç–∞–±–ª–∏—Ü—ã
* `Index Scan` ‚Äî –∏—Å–ø–æ–ª—å–∑–æ–≤–∞–Ω–∏–µ –∏–Ω–¥–µ–∫—Å–∞

---

## üì¶ BUFFERS

–í—ã–≤–æ–¥ –ø–æ–∫–∞–∂–µ—Ç —Ç–∞–∫–∏–µ —Å—Ç—Ä–æ–∫–∏:

```
Buffers: shared hit=124 read=8 dirtied=0 written=0
```

–≠—Ç–æ –∑–Ω–∞—á–∏—Ç:

* **hit=124** ‚Äî –¥–∞–Ω–Ω—ã–µ —É–∂–µ –±—ã–ª–∏ –≤ –ø–∞–º—è—Ç–∏ (shared\_buffers)
* **read=8** ‚Äî –¥–∞–Ω–Ω—ã–µ —Å—á–∏—Ç–∞–Ω—ã —Å –¥–∏—Å–∫–∞
* **dirtied/written** ‚Äî –∫–∞—Å–∞—é—Ç—Å—è –∑–∞–ø–∏—Å–∏

üìå –ß–µ–º –±–æ–ª—å—à–µ `read`, —Ç–µ–º –º–µ–¥–ª–µ–Ω–Ω–µ–µ. –≠—Ç–æ **–¥–∏—Å–∫**.

---

## üí• –ü–æ—á–µ–º—É Nested Loop ‚Äî –Ω–µ –≤—Å–µ–≥–¥–∞ —Ö–æ—Ä–æ—à–æ?

–ï—Å–ª–∏ –≤–Ω–µ—à–Ω–∏–π SELECT –≤–æ–∑–≤—Ä–∞—â–∞–µ—Ç –º–Ω–æ–≥–æ —Å—Ç—Ä–æ–∫, –∞ –≤–Ω—É—Ç—Ä–µ–Ω–Ω–∏–π –∏—Å–ø–æ–ª—å–∑—É–µ—Ç `Index Scan`,
—Ç–æ –¥–ª—è **–∫–∞–∂–¥–æ–π —Å—Ç—Ä–æ–∫–∏** –±—É–¥–µ—Ç –Ω–æ–≤—ã–π –ø–æ–∏—Å–∫ –ø–æ –∏–Ω–¥–µ–∫—Å—É ‚Äî N —Ä–∞–∑.

üìâ –≠—Ç–æ –º–æ–∂–µ—Ç –±—ã—Ç—å –≤ 1000 —Ä–∞–∑ –º–µ–¥–ª–µ–Ω–Ω–µ–µ, —á–µ–º `Hash Join`.

---

## üõ† –ß—Ç–æ –¥–µ–ª–∞—Ç—å?

* –ò—Å–ø–æ–ª—å–∑–æ–≤–∞—Ç—å `JOIN` –≤–º–µ—Å—Ç–æ –ø–æ–¥–∑–∞–ø—Ä–æ—Å–∞
* –ü—Ä–æ–≤–µ—Ä–∏—Ç—å –∏–Ω–¥–µ–∫—Å—ã
* –ò—Å–ø–æ–ª—å–∑–æ–≤–∞—Ç—å `EXPLAIN (ANALYZE, BUFFERS)` –≤—Å–µ–≥–¥–∞, –∫–æ–≥–¥–∞ –≤–∏–¥–∏—à—å —Ç–æ—Ä–º–æ–∑–∞

---

## ü§ì –ü–æ–ª–µ–∑–Ω—ã–µ —Ñ–ª–∞–≥–∏

| –ö–ª—é—á        | –ß—Ç–æ –¥–∞—ë—Ç                                |
| ----------- | --------------------------------------- |
| `ANALYZE`   | –í—ã–ø–æ–ª–Ω—è–µ—Ç –∑–∞–ø—Ä–æ—Å –∏ –ø–æ–∫–∞–∑—ã–≤–∞–µ—Ç **–≤—Ä–µ–º—è** |
| `BUFFERS`   | –ü–æ–∫–∞–∑—ã–≤–∞–µ—Ç, –≥–¥–µ —á–∏—Ç–∞–µ—Ç—Å—è/–ø–∏—à–µ—Ç—Å—è        |
| `VERBOSE`   | –ë–æ–ª—å—à–µ –∏–Ω—Ñ–æ—Ä–º–∞—Ü–∏–∏ (–∫–æ–ª–æ–Ω–∫–∏ –∏ –ø—Ä.)       |
| `COSTS OFF` | –ü—Ä—è—á–µ—Ç cost –∏ rows (—á–∏—Å—Ç–æ –¥–ª—è –≥–ª–∞–∑)     |

---

## üß™ –°–æ–≤–µ—Ç

–í—Å–µ–≥–¥–∞ –Ω–∞—á–∏–Ω–∞–π —Å `EXPLAIN ANALYZE`, –∞ –µ—Å–ª–∏ –Ω—É–∂–Ω–æ –∫–æ–ø–Ω—É—Ç—å –≥–ª—É–±–∂–µ ‚Äî –¥–æ–±–∞–≤—å `BUFFERS`.
