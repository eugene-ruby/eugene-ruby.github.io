---
layout: post
title: "–°–∫–æ–ª—å–∫–æ —Å–æ–µ–¥–∏–Ω–µ–Ω–∏–π –¥–µ—Ä–∂–∞—Ç—å –≤ Puma, Sidekiq –∏ Webhooks?"
date: 2025-02-16 12:00:00 +0300
categories:
  - postgres
  - database
  - rails
toc: true
menubar_toc: true
hero_image: /images/architecture.jpeg
hero_darken: true
---
PostgreSQL ‚Äî –º–æ—â–Ω–∞—è –°–£–ë–î, –Ω–æ –µ—ë —Å–æ–µ–¥–∏–Ω–µ–Ω–∏—è –Ω–µ –±–µ–∑–≥—Ä–∞–Ω–∏—á–Ω—ã, –∏ –ø—Ä–µ–≤—ã—à–µ–Ω–∏–µ –ª–∏–º–∏—Ç–∞ –º–æ–∂–µ—Ç –æ–±—Ä—É—à–∏—Ç—å –ø—Ä–æ–¥–∞–∫—à–µ–Ω. –í —ç—Ç–æ–π —Å—Ç–∞—Ç—å–µ —Ä–∞–∑–±–µ—Ä—ë–º, –∫–∞–∫ –ø—Ä–∞–≤–∏–ª—å–Ω–æ —Ä–∞—Å–ø—Ä–µ–¥–µ–ª—è—Ç—å –ø–æ–¥–∫–ª—é—á–µ–Ω–∏—è –º–µ–∂–¥—É Puma, Sidekiq –∏ –¥—Ä—É–≥–∏–º–∏ –∫–æ–º–ø–æ–Ω–µ–Ω—Ç–∞–º–∏ Ruby on Rails-–ø—Ä–∏–ª–æ–∂–µ–Ω–∏—è, —á—Ç–æ–±—ã –∏–∑–±–µ–∂–∞—Ç—å –ø–µ—Ä–µ–≥—Ä—É–∑–∫–∏ –±–∞–∑—ã. –£–∑–Ω–∞–µ—Ç–µ, –∫–∞–∫ —Å—á–∏—Ç–∞—Ç—å –∞–∫—Ç–∏–≤–Ω—ã–µ —Å–æ–µ–¥–∏–Ω–µ–Ω–∏—è, –Ω–∞—Å—Ç—Ä–∞–∏–≤–∞—Ç—å –ø—É–ª—ã –∏ –∏—Å–ø–æ–ª—å–∑–æ–≤–∞—Ç—å PgBouncer –¥–ª—è —ç—Ñ—Ñ–µ–∫—Ç–∏–≤–Ω–æ–≥–æ —É–ø—Ä–∞–≤–ª–µ–Ω–∏—è —Ä–µ—Å—É—Ä—Å–∞–º–∏ PostgreSQL –≤ DevOps-—Å—Ä–µ–¥–µ.

> –û–¥–Ω–æ –∏–∑ —Å–∞–º—ã—Ö —á–∞—Å—Ç—ã—Ö –ø–∞–¥–µ–Ω–∏–π –ø—Ä–æ–¥–∞–∫—à–Ω–∞: –ø—Ä–µ–≤—ã—à–µ–Ω–∏–µ —á–∏—Å–ª–∞ —Å–æ–µ–¥–∏–Ω–µ–Ω–∏–π –∫ PostgreSQL. –ö—Ç–æ –≤–∏–Ω–æ–≤–∞—Ç? –í—Å–µ.

---

## üé≠ –†–∞—Å–ø—Ä–µ–¥–µ–ª–∏–º —Ä–æ–ª–∏

| –ö–æ–º–ø–æ–Ω–µ–Ω—Ç | –ß—Ç–æ –¥–µ–ª–∞–µ—Ç                        | –ö–∞–∫ —Å—á–∏—Ç–∞–µ—Ç —Å–æ–µ–¥–∏–Ω–µ–Ω–∏—è |
|----------|-----------------------------------|-------------------------|
| Puma     | –æ–±—Ä–∞–±–∞—Ç—ã–≤–∞–µ—Ç HTTP –∑–∞–ø—Ä–æ—Å—ã         | `workers * threads`     |
| Sidekiq  | –≤—ã–ø–æ–ª–Ω—è–µ—Ç —Ñ–æ–Ω–æ–≤—ã–µ –∑–∞–¥–∞—á–∏          | `concurrency`           |
| Cron/Jobs | –æ–¥–Ω–æ–∫—Ä–∞—Ç–Ω—ã–µ –ø—Ä–æ—Ü–µ—Å—Å—ã              | `1 –Ω–∞ –∑–∞–¥–∞—á—É`           |
| Webhooks | —á–∞—Å—Ç–æ –∑–∞–ø—É—Å–∫–∞—é—Ç—Å—è –ø–∞—Ä–∞–ª–ª–µ–ª—å–Ω–æ     | `1 –Ω–∞ –ø—Ä–æ—Ü–µ—Å—Å`          |

---

## üßÆ –ö–∞–∫ –ø–æ—Å—á–∏—Ç–∞—Ç—å –æ–±—â–µ–µ —á–∏—Å–ª–æ —Å–æ–µ–¥–∏–Ω–µ–Ω–∏–π

```text
Puma (3 –≤–æ—Ä–∫–µ—Ä–∞ –ø–æ 5 –ø–æ—Ç–æ–∫–æ–≤)   => 15
Sidekiq (concurrency: 10)       => 10
Cron/Jobs (3 –∞–∫—Ç–∏–≤–Ω—ã—Ö —Å–∫—Ä–∏–ø—Ç–∞) => 3
Webhook (5 –ø—Ä–æ—Ü–µ—Å—Å–æ–≤)           => 5
–ò—Ç–æ–≥–æ                           => 33
````

–ù–æ –±–∞–∑–∞-—Ç–æ –º–æ–∂–µ—Ç —Ç–æ–ª—å–∫–æ 100 —Å–æ–µ–¥–∏–Ω–µ–Ω–∏–π!

–ò –ø—Ä–∏ —ç—Ç–æ–º: –∞–¥–º–∏–Ω–∫–∞, psql, pg\_stat\_statements, PgBouncer, PgHero ‚Äî —Ç–æ–∂–µ –∑–∞–Ω–∏–º–∞—é—Ç —Å–ª–æ—Ç—ã.

---

## üìâ –ß—Ç–æ –¥–µ–ª–∞—Ç—å

### 1. –ò—Å–ø–æ–ª—å–∑—É–π PgBouncer

–†–µ–∂–∏–º `transaction` –ø–æ–∑–≤–æ–ª—è–µ—Ç –ø–µ—Ä–µ—Ä–∞—Å–ø—Ä–µ–¥–µ–ª—è—Ç—å —Å–æ–µ–¥–∏–Ω–µ–Ω–∏—è, —É–º–µ–Ω—å—à–∞—è –æ–±—â–µ–µ —á–∏—Å–ª–æ **–∞–∫—Ç–∏–≤–Ω—ã—Ö** —Å–ª–æ—Ç–æ–≤ –≤ –ë–î.

---

### 2. Puma

```yaml
# config/puma.rb
workers 3
threads 1, 5
```

–ò —Ç–æ–≥–¥–∞ pool –≤ `database.yml` –¥–æ–ª–∂–µ–Ω –±—ã—Ç—å `5`, –∞ –Ω–µ `5 * 3`!

---

### 3. Sidekiq

```yaml
:concurrency: 10
```

–ê `pool` –≤ `database.yml` ‚Äî —Ç–æ–∂–µ 10. –û–¥–∏–Ω –≤–æ—Ä–∫–µ—Ä ‚Äî –æ–¥–Ω–æ —Å–æ–µ–¥–∏–Ω–µ–Ω–∏–µ.

---

### 4. Webhooks –∏ rake

–ù–µ –∑–∞–±—ã–≤–∞–π `ActiveRecord::Base.connection_pool.disconnect!` –ø—Ä–∏ –∑–∞–≤–µ—Ä—à–µ–Ω–∏–∏!

---

## üìå –í—ã–≤–æ–¥

–ë–∞–∑–∞ –Ω–µ —Ä–µ–∑–∏–Ω–æ–≤–∞—è. –ß–∏—Å–ª–æ —Å–æ–µ–¥–∏–Ω–µ–Ω–∏–π –Ω–∞–¥–æ **—Å—á–∏—Ç–∞—Ç—å —Ä—É–∫–∞–º–∏**.
–õ–∏–º–∏—Ç PostgreSQL –ø–æ —É–º–æ–ª—á–∞–Ω–∏—é ‚Äî **100**, –∏ –≤—ã –µ–≥–æ –ø—Ä–µ–≤—ã—Å–∏—Ç–µ **–æ—á–µ–Ω—å –±—ã—Å—Ç—Ä–æ**, –µ—Å–ª–∏ –Ω–µ —Ä–∞–∑–ª–æ–∂–∏—Ç–µ —Å–æ–µ–¥–∏–Ω–µ–Ω–∏—è –ø–æ –ø–æ–ª–æ—á–∫–∞–º.
