---
layout: post
subtitle: <div id="terminal"></div>
title:  "–ö–∞—Ç–∏–º pet –≤ –ø—Ä–æ–¥! ‚Äî GitHub Actions —ç—Ç–æ –ª–µ–≥—á–µ —á–µ–º –∫–∞–∂–µ—Ç—Å—è"
date:   2024-09-23 12:00:00 +0300
rate: 2
tags: GitHub Actions, CI/CD, Docker, SSH, DevOps
version: A9X
categories:
  - pet
  - devops
hero_image: /images/posts/30.jpg
hero_darken: true
toc: true
menubar_toc: true
---
–í—ã —É–∂–µ —Å–¥–µ–ª–∞–ª–∏ Dockerfile, –Ω–∞—Å—Ç—Ä–æ–∏–ª–∏ docker-compose –∏ –¥–∞–∂–µ —Ä–∞–∑–æ–±—Ä–∞–ª–∏—Å—å —Å [DockerHub](/posts/pet-docker-hub.html). –¢–µ–ø–µ—Ä—å –ø—Ä–∏—à–ª–æ –≤—Ä–µ–º—è –∞–≤—Ç–æ–º–∞—Ç–∏–∑–∏—Ä–æ–≤–∞—Ç—å –¥–µ–ø–ª–æ–π ‚Äî –∏ GitHub Actions —Å–¥–µ–ª–∞–µ—Ç —ç—Ç–æ –∑–∞ –≤–∞—Å –±—É–∫–≤–∞–ª—å–Ω–æ –≤ –Ω–µ—Å–∫–æ–ª—å–∫–æ —Å—Ç—Ä–æ–∫ –∫–æ–Ω—Ñ–∏–≥–∞. –í —Å—Ç–∞—Ç—å–µ —Ä–∞–∑–±–µ—Ä—ë–º, –∫–∞–∫ –Ω–∞—Å—Ç—Ä–æ–∏—Ç—å CI/CD —Å SSH-–¥–µ–ø–ª–æ–µ–º —á–µ—Ä–µ–∑ `appleboy/ssh-action`, –∏–∑–±–µ–≥–∞—è —Ç–∏–ø–∏—á–Ω—ã—Ö –æ—à–∏–±–æ–∫ –Ω–æ–≤–∏—á–∫–æ–≤.

---
–í—ã —Å–º–æ—Ç—Ä–∏—Ç–µ –Ω–∞ —Å–≤–æ–π pet-–ø—Ä–æ–µ–∫—Ç –∏ –¥—É–º–∞–µ—Ç–µ:  
¬´–í—Å—ë –≥–æ—Ç–æ–≤–æ, –Ω–æ –∫–∞–∂–¥—ã–π —Ä–∞–∑ –∑–∞–ª–∏–≤–∞—Ç—å –∏–∑–º–µ–Ω–µ–Ω–∏—è —á–µ—Ä–µ–∑ `ssh` ‚Äî —ç—Ç–æ –±–æ–ª—å¬ª.  
–ü–æ—Ä–∞ –Ω–∞—É—á–∏—Ç—å GitHub –¥–µ–ª–∞—Ç—å —ç—Ç–æ –∑–∞ –≤–∞—Å. **–ê–≤—Ç–æ–º–∞—Ç–∏–∑–∏—Ä—É–µ–º!**

---

## üß† –¢–µ–æ—Ä–∏—è: GitHub Actions –∑–∞ 5 –º–∏–Ω—É—Ç

GitHub Actions ‚Äî —ç—Ç–æ –≤—Å—Ç—Ä–æ–µ–Ω–Ω—ã–π –∏–Ω—Å—Ç—Ä—É–º–µ–Ω—Ç –¥–ª—è **–∞–≤—Ç–æ–º–∞—Ç–∏–∑–∞—Ü–∏–∏ workflows** (—Å–±–æ—Ä–∫–∏, —Ç–µ—Å—Ç–æ–≤, –¥–µ–ø–ª–æ—è).  
–†–∞–±–æ—Ç–∞–µ—Ç –Ω–∞ –æ—Å–Ω–æ–≤–µ YAML-—Ñ–∞–π–ª–æ–≤ –≤ –ø–∞–ø–∫–µ `.github/workflows/`.

–û—Å–Ω–æ–≤–Ω—ã–µ –∫–æ–º–ø–æ–Ω–µ–Ω—Ç—ã:
- **Jobs** ‚Äî –∑–∞–¥–∞—á–∏ (–Ω–∞–ø—Ä–∏–º–µ—Ä, ¬´—Å–æ–±—Ä–∞—Ç—å¬ª –∏ ¬´–∑–∞–¥–µ–ø–ª–æ–∏—Ç—å¬ª).
- **Steps** ‚Äî —à–∞–≥–∏ –≤–Ω—É—Ç—Ä–∏ –∑–∞–¥–∞—á–∏ (`checkout`, `run`, `uses`).
- **Actions** ‚Äî –≥–æ—Ç–æ–≤—ã–µ –º–æ–¥—É–ª–∏ (–Ω–∞–ø—Ä–∏–º–µ—Ä, `appleboy/ssh-action` –¥–ª—è –ø–æ–¥–∫–ª—é—á–µ–Ω–∏—è –ø–æ SSH).

---

## üîß –ü—Ä–∏–º–µ—Ä: –¥–µ–ø–ª–æ–π —á–µ—Ä–µ–∑ SSH

–î–æ–ø—É—Å—Ç–∏–º, [—É –≤–∞—Å –µ—Å—Ç—å —Å–µ—Ä–≤–µ—Ä —Å Docker](/posts/ubuntu-vps-docker.html).
–•–æ—Ç–∏—Ç–µ, —á—Ç–æ–±—ã –ø—Ä–∏ –ø—É—à–µ –≤ `main` GitHub:
1. –°–æ–±—Ä–∞–ª –æ–±—Ä–∞–∑.
2. –ó–∞–ª–∏–ª –µ–≥–æ –≤ Docker Hub.
3. –ü–æ–¥–∫–ª—é—á–∏–ª—Å—è –ø–æ SSH –∏ –∑–∞–ø—É—Å—Ç–∏–ª `docker-compose up`.

–í–æ—Ç –∫–∞–∫ —ç—Ç–æ –≤—ã–≥–ª—è–¥–∏—Ç –≤ `.github/workflows/deploy.yml`:

{% raw %}
```yaml
name: Deploy to Production

on:
  push:
    branches: [ "main" ]

jobs:
  deploy:
    runs-on: ubuntu-latest
    steps:
      - name: Checkout code
        uses: actions/checkout@v4

      - name: Login to Docker Hub
        run: echo "${{ secrets.DOCKER_PASSWORD }}" | docker login -u "${{ secrets.DOCKER_USERNAME }}" --password-stdin

      - name: Build and push
        run: |
          docker build -t yourname/yourapp:latest .
          docker push yourname/yourapp:latest

      - name: SSH Deploy
        uses: appleboy/ssh-action@v1.0.0
        with:
          host: ${{ secrets.SSH_HOST }}
          username: ${{ secrets.SSH_USER }}
          key: ${{ secrets.SSH_KEY }}
          script: |
            docker pull yourname/yourapp:latest
            cd /path/to/your/app
            docker-compose up -d
```
{% endraw %}

> üêå –ï—Å–ª–∏ `docker build` –∑–∞–Ω–∏–º–∞–µ—Ç –¥–µ—Å—è—Ç–∫–∏ –º–∏–Ω—É—Ç? ‚åõ [–û–ø—Ç–∏–º–∏–∑–∞—Ü–∏—è Dockerfile](/posts/slow-fat-docker-image.html)

---

## üí° –ö–∞–∫ —ç—Ç–æ —Ä–∞–±–æ—Ç–∞–µ—Ç?

1. **–¢—Ä–∏–≥–≥–µ—Ä**: –ø—Ä–∏ –ø—É—à–µ –≤ `main` –∑–∞–ø—É—Å–∫–∞–µ—Ç—Å—è workflow.
2. **–°–±–æ—Ä–∫–∞**: Docker-–æ–±—Ä–∞–∑ –ø–∞–∫—É–µ—Ç—Å—è –∏ –æ—Ç–ø—Ä–∞–≤–ª—è–µ—Ç—Å—è –≤ Hub.
3. **–î–µ–ø–ª–æ–π**: —á–µ—Ä–µ–∑ `ssh-action` –ø–æ–¥–∫–ª—é—á–∞–µ–º—Å—è –∫ —Å–µ—Ä–≤–µ—Ä—É –∏ –æ–±–Ω–æ–≤–ª—è–µ–º –∫–æ–Ω—Ç–µ–π–Ω–µ—Ä—ã.

**–í–∞–∂–Ω–æ**: –í—Å–µ —á—É–≤—Å—Ç–≤–∏—Ç–µ–ª—å–Ω—ã–µ –¥–∞–Ω–Ω—ã–µ (–ø–∞—Ä–æ–ª–∏, SSH-–∫–ª—é—á–∏) —Ö—Ä–∞–Ω—è—Ç—Å—è –≤ Secrets —Ä–µ–ø–æ–∑–∏—Ç–æ—Ä–∏—è (`Settings ‚Üí Secrets`).

---

## üß™ –¢–µ—Å—Ç–∏—Ä—É–µ–º workflow –ª–æ–∫–∞–ª—å–Ω–æ

–ù–µ —Ö–æ—Ç–∏—Ç–µ –∂–¥–∞—Ç—å –∫–æ–º–º–∏—Ç–æ–≤? –ò—Å–ø–æ–ª—å–∑—É–π—Ç–µ [act](https://github.com/nektos/act):

```bash
act -j deploy
```

–≠—Ç–æ –∑–∞–ø—É—Å—Ç–∏—Ç job `deploy` –ª–æ–∫–∞–ª—å–Ω–æ ‚Äî —É–¥–æ–±–Ω–æ –¥–ª—è –æ—Ç–ª–∞–¥–∫–∏.

---

## ü§ë –ê —Å–∫–æ–ª—å–∫–æ —Å—Ç–æ–∏—Ç?

–ù–∞ 2024 –≥–æ–¥ GitHub –ø—Ä–µ–¥–æ—Å—Ç–∞–≤–ª—è–µ—Ç **2‚ÄØ000 –±–µ—Å–ø–ª–∞—Ç–Ω—ã—Ö –º–∏–Ω—É—Ç GitHub Actions –≤ –º–µ—Å—è—Ü** –¥–ª—è –ø—É–±–ª–∏—á–Ω—ã—Ö –∏ –±–æ–ª—å—à–∏–Ω—Å—Ç–≤–∞ —á–∞—Å—Ç–Ω—ã—Ö —Ä–µ–ø–æ–∑–∏—Ç–æ—Ä–∏–µ–≤, —á—Ç–æ —ç–∫–≤–∏–≤–∞–ª–µ–Ω—Ç–Ω–æ —Å–∫–∏–¥–∫–µ –ø—Ä–∏–º–µ—Ä–Ω–æ **\$16**. 

–≠—Ç–æ –ø–æ–∫—Ä—ã–≤–∞–µ—Ç –±–∞–∑–æ–≤—ã–µ CI/CD-–ø–æ—Ç—Ä–µ–±–Ω–æ—Å—Ç–∏ pet-–ø—Ä–æ–µ–∫—Ç–æ–≤ –∏ –Ω–µ–±–æ–ª—å—à–∏—Ö –∫–æ–º–∞–Ω–¥. –ü—Ä–∏ –ø—Ä–µ–≤—ã—à–µ–Ω–∏–∏ –ª–∏–º–∏—Ç–∞ –Ω–∞—á–∏—Å–ª—è–µ—Ç—Å—è –ø–ª–∞—Ç–∞ ‚Äî **\$0.008 –∑–∞ –º–∏–Ω—É—Ç—É** (–∏–ª–∏ \~\$0.48/—á–∞—Å).

üìä –¢–µ–∫—É—â–∏–π —Ä–∞—Å—Ö–æ–¥ –∏ –æ—Å—Ç–∞—Ç–æ–∫ –º–∏–Ω—É—Ç –º–æ–∂–Ω–æ –ø–æ—Å–º–æ—Ç—Ä–µ—Ç—å –∑–¥–µ—Å—å:
üëâ [github.com/settings/billing](https://github.com/settings/billing) ‚Üí —Ä–∞–∑–¥–µ–ª **Actions usage**

> üí° –ë–æ–Ω—É—Å: –ú–æ–∂–Ω–æ –∏—Å–ø–æ–ª—å–∑–æ–≤–∞—Ç—å **self-hosted runner**, –º–∏–Ω—É—Ç—ã –Ω–µ —Å–ø–∏—Å—ã–≤–∞—é—Ç—Å—è ‚Äî —Ç–æ–ª—å–∫–æ –ø–ª–∞—Ç–∞ –∑–∞ —Å–≤–æ–π —Å–µ—Ä–≤–µ—Ä.

## üßê –ê –º–Ω–µ —Ç–æ—á–Ω–æ —Ö–≤–∞—Ç–∏—Ç Free —Ç–∞—Ä–∏—Ñ–∞?

–ï—Å–ª–∏ –æ–¥–∏–Ω –¥–µ–ø–ª–æ–π –≤ GitHub Actions –∑–∞–Ω–∏–º–∞–µ—Ç –¥–∞–∂–µ 10 –º–∏–Ω—É—Ç, —Ç–æ:

```text
2000 –º–∏–Ω—É—Ç / 10 –º–∏–Ω—É—Ç = 200 –¥–µ–ø–ª–æ–µ–≤ –≤ –º–µ—Å—è—Ü
```
> üí° –ï—Å–ª–∏ –¥–µ–ø–ª–æ–π –∑–∞–Ω–∏–º–∞–µ—Ç –º–µ–Ω—å—à–µ (–Ω–∞–ø—Ä–∏–º–µ—Ä, 5 –º–∏–Ω—É—Ç), –ª–∏–º–∏—Ç —Ö–≤–∞—Ç–∏—Ç —É–∂–µ –Ω–∞ 400 –ø—Ä–æ–≥–æ–Ω–æ–≤.

–ú–æ–∂–Ω–æ push-—à–∏—Ç—å —Å–≤–æ–π pet-–ø—Ä–æ–µ–∫—Ç –¥–µ—Å—è—Ç–∫–∏ —Ä–∞–∑ –≤ –¥–µ–Ω—å üåöüåù

---

## üî• –ê–Ω—Ç–∏–ø–∞—Ç—Ç–µ—Ä–Ω—ã

{% raw %}

| –û—à–∏–±–∫–∞                          | –ö–∞–∫ –∏—Å–ø—Ä–∞–≤–∏—Ç—å                     |
| ------------------------------- | --------------------------------- |
| –ñ—ë—Å—Ç–∫–æ –∑–∞—à–∏—Ç—ã–µ —Å–µ–∫—Ä–µ—Ç—ã –≤ YAML   | –ò—Å–ø–æ–ª—å–∑—É–π—Ç–µ `${{ secrets.NAME }}` |
| –û–¥–∏–Ω –æ–≥—Ä–æ–º–Ω—ã–π step –Ω–∞ 100 —Å—Ç—Ä–æ–∫ | –†–∞–∑–±–∏–≤–∞–π—Ç–µ –Ω–∞ –ª–æ–≥–∏—á–µ—Å–∫–∏–µ –±–ª–æ–∫–∏    |
| –î–µ–ø–ª–æ–π –±–µ–∑ —Ç–µ—Å—Ç–æ–≤               | –î–æ–±–∞–≤—å—Ç–µ stage `test` –ø–µ—Ä–µ–¥ deploy|

{% endraw %}

---

## üé§ –ß—Ç–æ —Å–∫–∞–∑–∞—Ç—å –Ω–∞ —Å–æ–±–µ—Å–µ–¥–æ–≤–∞–Ω–∏–∏

> ‚Äî –ö–∞–∫ –≤—ã –Ω–∞—Å—Ç—Ä–∞–∏–≤–∞–µ—Ç–µ CI/CD –¥–ª—è –ø–µ—Ç-–ø—Ä–æ–µ–∫—Ç–æ–≤?

‚Äî –ò—Å–ø–æ–ª—å–∑—É—é GitHub Actions —Å Docker + SSH-–¥–µ–ø–ª–æ–µ–º. –ù–∞–ø—Ä–∏–º–µ—Ä, —á–µ—Ä–µ–∑ `appleboy/ssh-action` –¥–ª—è –±—ã—Å—Ç—Ä–æ–≥–æ –æ–±–Ω–æ–≤–ª–µ–Ω–∏—è —Å–µ—Ä–≤–µ—Ä–∞. –≠—Ç–æ –¥–µ—à–µ–≤–ª–µ, —á–µ–º –Ω–∞—Å—Ç—Ä–∞–∏–≤–∞—Ç—å –ø–æ–ª–Ω–æ—Ü–µ–Ω–Ω—ã–π Kubernetes –¥–ª—è –º–µ–ª–∫–∏—Ö –∑–∞–¥–∞—á.

---

## üßæ –í—ã–≤–æ–¥

**GitHub Actions ‚Äî —ç—Ç–æ –∫–∞–∫ –∞–≤—Ç–æ–æ—Ç–≤–µ—Ç—á–∏–∫ –¥–ª—è –≤–∞—à–µ–≥–æ –∫–æ–¥–∞.**  
–ù–∞—Å—Ç—Ä–æ–∏–ª–∏ –æ–¥–∏–Ω —Ä–∞–∑ ‚Äî –∏ –∑–∞–±—ã–ª–∏ –ø—Ä–æ —Ä—É—á–Ω–æ–π –¥–µ–ø–ª–æ–π. –¢–µ–ø–µ—Ä—å –≤–∞—à pet-–ø—Ä–æ–µ–∫—Ç –∂–∏–≤—ë—Ç –ø–æ –ø—Ä–∏–Ω—Ü–∏–ø—É ¬´–∑–∞–ø—É—à–∏–ª ‚Üí –ø–æ–ª—É—á–∏–ª –ø—Ä–æ–¥–∞–∫—à–Ω¬ª. –ò –¥–∞, —ç—Ç–æ –∑–∞–Ω—è–ª–æ –≤—Å–µ–≥–æ 20 —Å—Ç—Ä–æ–∫ YAML. üöÄ

ü§ì –ò–Ω—Ç–µ—Ä–µ—Å–Ω–æ –∫–∞–∫ —É–ª—É—á—à–∏—Ç—å ci.yml? –£—Ä–æ–≤–µ–Ω—å —Å–æ –∑–≤–µ–∑–¥–æ—á–∫–æ–π üåü [–í—ã–∫–∞—Ç–∫–∞ —Ä–µ–ª–∏–∑–æ–≤ —á–µ—Ä–µ–∑ git tag](/posts/github-tag-pet-deploy.html)
