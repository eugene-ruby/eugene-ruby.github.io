---
layout: post
subtitle: <div id="terminal"></div>
title:  "Devise –ø—Ä–æ—Ç–∏–≤ Authlogic: —á—Ç–æ –≤—ã–±—Ä–∞—Ç—å –∏ –∫–∞–∫ –Ω–µ –Ω–∞–ª–æ–º–∞—Ç—å"
date:   2024-09-18 10:00:00 +0300
rate: 2
tags: Ruby on Rails,Authentication,Devise,Authlogic,PostgreSQL,–±–µ–∑–æ–ø–∞—Å–Ω–æ—Å—Ç—å
version: A9X
categories:
  - gems
  - rails
hero_image: /images/posts/39.jpg
hero_darken: true
toc: true
menubar_toc: true
---
–í—ã–±–æ—Ä —Å–∏—Å—Ç–µ–º—ã –∞—É—Ç–µ–Ω—Ç–∏—Ñ–∏–∫–∞—Ü–∏–∏ –¥–ª—è Rails-–ø—Ä–∏–ª–æ–∂–µ–Ω–∏—è ‚Äî –∫–∞–∫ –≤—ã–±–æ—Ä –º–µ–∂–¥—É –Ω–æ–∂–æ–º –∏ —Å–∫–∞–ª—å–ø–µ–ª–µ–º: –æ–±–∞ —Ä–µ–∂—É—Ç, –Ω–æ –¥–ª—è —Ä–∞–∑–Ω—ã—Ö –∑–∞–¥–∞—á. Devise –∏ Authlogic ‚Äî –¥–≤–∞ —Å–∞–º—ã—Ö –ø–æ–ø—É–ª—è—Ä–Ω—ã—Ö —Ä–µ—à–µ–Ω–∏—è, –Ω–æ –∏—Ö —Ñ–∏–ª–æ—Å–æ—Ñ–∏—è –∏ –ø–æ–¥—Ö–æ–¥ –∫ –±–µ–∑–æ–ø–∞—Å–Ω–æ—Å—Ç–∏ –∫–∞—Ä–¥–∏–Ω–∞–ª—å–Ω–æ –æ—Ç–ª–∏—á–∞—é—Ç—Å—è. –†–∞–∑–±–µ—Ä—ë–º—Å—è, –∫–æ–≥–¥–∞ –∫–∞–∫–æ–π –∏–Ω—Å—Ç—Ä—É–º–µ–Ω—Ç –∏—Å–ø–æ–ª—å–∑–æ–≤–∞—Ç—å, –∫–∞–∫ –∏–∑–±–µ–∂–∞—Ç—å —Ç–∏–ø–∏—á–Ω—ã—Ö –æ—à–∏–±–æ–∫ –∏ –Ω–µ –ø—Ä–µ–≤—Ä–∞—Ç–∏—Ç—å –∞–≤—Ç–æ—Ä–∏–∑–∞—Ü–∏—é –≤ –≥–æ–ª–æ–≤–Ω—É—é –±–æ–ª—å.

---

## üß† –¢–µ–æ—Ä–∏—è: –¥–≤–∞ –ø—É—Ç–∏ –∞—É—Ç–µ–Ω—Ç–∏—Ñ–∏–∫–∞—Ü–∏–∏

### Devise: "–í—Å—ë –≤–∫–ª—é—á–µ–Ω–æ"
**–ü–ª—é—Å—ã:**
- –ì–æ—Ç–æ–≤—ã–µ –∫–æ–Ω—Ç—Ä–æ–ª–ª–µ—Ä—ã, —Ä–æ—É—Ç—ã, —Ñ–æ—Ä–º—ã
- –ü–æ–¥–¥–µ—Ä–∂–∫–∞ OAuth, –ø–æ–¥—Ç–≤–µ—Ä–∂–¥–µ–Ω–∏–µ email, —Å–±—Ä–æ—Å –ø–∞—Ä–æ–ª—è
- –ê–∫—Ç–∏–≤–Ω–æ–µ —Å–æ–æ–±—â–µ—Å—Ç–≤–æ –∏ —á–∞—Å—Ç—ã–µ –æ–±–Ω–æ–≤–ª–µ–Ω–∏—è

**–ú–∏–Ω—É—Å—ã:**
- –ú–æ–Ω–æ–ª–∏—Ç–Ω–∞—è –∞—Ä—Ö–∏—Ç–µ–∫—Ç—É—Ä–∞ (—Ç—è–∂–µ–ª–æ –∫–∞—Å—Ç–æ–º–∏–∑–∏—Ä–æ–≤–∞—Ç—å)
- –ú–∞–≥–∏—è –ø–æ–¥ –∫–∞–ø–æ—Ç–æ–º (–Ω–∞–ø—Ä–∏–º–µ—Ä, `warden`)
- –ò–∑–±—ã—Ç–æ—á–Ω–æ—Å—Ç—å –¥–ª—è –ø—Ä–æ—Å—Ç—ã—Ö –ø—Ä–æ–µ–∫—Ç–æ–≤

### Authlogic: "–õ–µ–≥–æ –¥–ª—è –≤–∑—Ä–æ—Å–ª—ã—Ö"
**–ü–ª—é—Å—ã:**
- –ú–∏–Ω–∏–º–∞–ª–∏–∑–º (—Ç–æ–ª—å–∫–æ –±–∞–∑–æ–≤—ã–µ –∞–±—Å—Ç—Ä–∞–∫—Ü–∏–∏)
- –ü–æ–ª–Ω—ã–π –∫–æ–Ω—Ç—Ä–æ–ª—å –Ω–∞–¥ –ª–æ–≥–∏–∫–æ–π
- –ü—Ä–æ—Å—Ç–æ—Ç–∞ –∏–Ω—Ç–µ–≥—Ä–∞—Ü–∏–∏ —Å –∫–∞—Å—Ç–æ–º–Ω—ã–º–∏ –º–æ–¥–µ–ª—è–º–∏

**–ú–∏–Ω—É—Å—ã:**
- –ù—É–∂–Ω–æ –ø–∏—Å–∞—Ç—å –±–æ–ª—å—à–µ –∫–æ–¥–∞ –≤—Ä—É—á–Ω—É—é
- –ú–µ–Ω—å—à–µ –≤—Å—Ç—Ä–æ–µ–Ω–Ω—ã—Ö —Ñ–∏—á
- –¢—Ä–µ–±—É–µ—Ç –ø–æ–Ω–∏–º–∞–Ω–∏—è –∫—Ä–∏–ø—Ç–æ–≥—Ä–∞—Ñ–∏–∏

---

## üîß –ü—Ä–∞–∫—Ç–∏–∫–∞: —É—Å—Ç–∞–Ω–æ–≤–∫–∞ –∏ –Ω–∞—Å—Ç—Ä–æ–π–∫–∞

### Devise (5 –º–∏–Ω—É—Ç –¥–æ –ø–µ—Ä–≤–æ–≥–æ –≤—Ö–æ–¥–∞)
```ruby
# Gemfile
gem 'devise'

# –ö–æ–Ω—Å–æ–ª—å
rails generate devise:install
rails generate devise User
rails db:migrate

# –î–æ–±–∞–≤–ª—è–µ–º –≤ —Ä–æ—É—Ç—ã
devise_for :users
```

–ì–æ—Ç–æ–≤–æ! –ü–æ—è–≤–∏–ª–∏—Å—å:
- `/users/sign_in`
- `/users/sign_up`
- Password recovery

### Authlogic (15 –º–∏–Ω—É—Ç + –∫–æ—Ñ–µ)
```ruby
# Gemfile
gem 'authlogic'

# –ú–æ–¥–µ–ª—å User
class User < ApplicationRecord
  acts_as_authentic do |c|
    c.crypto_provider = Authlogic::CryptoProviders::SCrypt
  end
end

# –°–µ—Å—Å–∏—è
class UserSession < Authlogic::Session::Base
end

# –ö–æ–Ω—Ç—Ä–æ–ª–ª–µ—Ä
def create
  @user_session = UserSession.new(params[:user_session])
  if @user_session.save
    redirect_to root_url
  else
    render :new
  end
end
```

---

## üõ° –ë–µ–∑–æ–ø–∞—Å–Ω–æ—Å—Ç—å: –≥–¥–µ –ø–æ–¥–≤–æ–¥–Ω—ã–µ –∫–∞–º–Ω–∏?

### Devise: "–ß—ë—Ä–Ω—ã–π —è—â–∏–∫"
- **–ü—Ä–æ–±–ª–µ–º–∞:** —Å–ª–æ–∂–Ω–æ –º–æ–¥–∏—Ñ–∏—Ü–∏—Ä–æ–≤–∞—Ç—å –∞–ª–≥–æ—Ä–∏—Ç–º—ã —Ö–µ—à–∏—Ä–æ–≤–∞–Ω–∏—è
- **–ü—Ä–∏–º–µ—Ä:** –ø–µ—Ä–µ—Ö–æ–¥ —Å bcrypt –Ω–∞ Argon2 —Ç—Ä–µ–±—É–µ—Ç –ø–∞—Ç—á–µ–π
- **–§–∏–∫—Å:** –∏—Å–ø–æ–ª—å–∑–æ–≤–∞—Ç—å `devise-security` –¥–ª—è —É–ª—É—á—à–µ–Ω–Ω—ã—Ö –ø—Ä–∞–≤–∏–ª –ø–∞—Ä–æ–ª–µ–π

### Authlogic: "–°–∞–º —Å–µ–±–µ –∫—Ä–∏–ø—Ç–æ–≥—Ä–∞—Ñ"
- **–ü—Ä–æ–±–ª–µ–º–∞:** –º–æ–∂–Ω–æ —Å–ª—É—á–∞–π–Ω–æ –æ—Ç–∫–ª—é—á–∏—Ç—å –∑–∞—â–∏—Ç—É
- **–ü—Ä–∏–º–µ—Ä:** 
  ```ruby
  acts_as_authentic do |c|
    c.validate_password_field = false # –û–π!
  end
  ```
- **–§–∏–∫—Å:** –≤—Å–µ–≥–¥–∞ –≤–∫–ª—é—á–∞—Ç—å –±–∞–∑–æ–≤—ã–µ –≤–∞–ª–∏–¥–∞—Ü–∏–∏:
  ```ruby
  c.validate_login_field = true
  c.validate_password_field = true
  ```

---

## üìà –ü—Ä–æ–∏–∑–≤–æ–¥–∏—Ç–µ–ª—å–Ω–æ—Å—Ç—å: PostgreSQL-—Å–ø–µ—Ü–∏—Ñ–∏–∫–∞

### Devise
- –ì–µ–Ω–µ—Ä–∏—Ä—É–µ—Ç —Ç—è–∂–µ–ª—ã–µ SQL-–∑–∞–ø—Ä–æ—Å—ã –¥–ª—è `trackable` (–ø–æ—Å–ª–µ–¥–Ω–∏–π –≤—Ö–æ–¥, IP)
- –†–µ—à–µ–Ω–∏–µ: –æ–≥—Ä–∞–Ω–∏—á–∏—Ç—å —Å–±–æ—Ä –º–µ—Ç—Ä–∏–∫:
  ```ruby
  devise :database_authenticatable, 
         :registerable,
         :trackable # —Ç–æ–ª—å–∫–æ –µ—Å–ª–∏ –Ω—É–∂–Ω–æ!
  ```

### Authlogic
- –õ–µ–≥–∫–æ–≤–µ—Å–Ω—ã–µ –∑–∞–ø—Ä–æ—Å—ã, –Ω–æ –Ω–µ—Ç –∫–µ—à–∏—Ä–æ–≤–∞–Ω–∏—è —Å–µ—Å—Å–∏–π
- –†–µ—à–µ–Ω–∏–µ: –¥–æ–±–∞–≤–∏—Ç—å `session_store :cache_store` –≤ `config/application.rb`

---

## üíÄ –ê–Ω—Ç–∏–ø–∞—Ç—Ç–µ—Ä–Ω—ã

### –î–ª—è Devise
1. **–ü–µ—Ä–µ–æ–ø—Ä–µ–¥–µ–ª–µ–Ω–∏–µ –∫–æ–Ω—Ç—Ä–æ–ª–ª–µ—Ä–æ–≤**  
   –í–º–µ—Å—Ç–æ:
   ```ruby
   class RegistrationsController < Devise::RegistrationsController
     def create
       # 100 —Å—Ç—Ä–æ–∫ –∫–∞—Å—Ç–æ–º–Ω–æ–π –ª–æ–≥–∏–∫–∏
     end
   end
   ```
   –õ—É—á—à–µ: –∏—Å–ø–æ–ª—å–∑–æ–≤–∞—Ç—å Service Objects.

2. **–ò–≥–Ω–æ—Ä–∏—Ä–æ–≤–∞–Ω–∏–µ `lockable`**  
   –ù–µ –≤–∫–ª—é—á–∞—Ç—å –∑–∞—â–∏—Ç—É –æ—Ç –±—Ä—É—Ç—Ñ–æ—Ä—Å–∞ ‚Äî –ø—Ä–µ—Å—Ç—É–ø–ª–µ–Ω–∏–µ.

### –î–ª—è Authlogic
1. **–°–∞–º–æ–ø–∏—Å–Ω—ã–µ —Ö–µ—à–∏**  
   ```ruby
   c.crypto_provider = MyHomebrewCrypto.new # NEVER DO THIS
   ```
2. **–•—Ä–∞–Ω–µ–Ω–∏–µ —Å–µ—Å—Å–∏–π –≤ –º–æ–¥–µ–ª–∏**  
   ```ruby
   user.user_session = UserSession.create # –ê–Ω—Ç–∏–ø–∞—Ç—Ç–µ—Ä–Ω!
   ```

---

## üéØ –ö–æ–≥–¥–∞ —á—Ç–æ –≤—ã–±–∏—Ä–∞—Ç—å?

| –ö—Ä–∏—Ç–µ—Ä–∏–π               | Devise | Authlogic |
|------------------------|--------|-----------|
| MVP –∑–∞ 1 –¥–µ–Ω—å          | ‚úÖ      | ‚ùå         |
| –ú–∏–∫—Ä–æ—Å–µ—Ä–≤–∏—Å–Ω–∞—è –∞—Ä—Ö–∏—Ç–µ–∫—Ç—É—Ä–∞ | ‚ùå      | ‚úÖ         |
| –ö–∞—Å—Ç–æ–º–Ω—ã–µ –ø–æ–ª—è –∞—É—Ç–µ–Ω—Ç–∏—Ñ–∏–∫–∞—Ü–∏–∏ | ‚ùå      | ‚úÖ         |
| –ü–æ–¥–¥–µ—Ä–∂–∫–∞ OmniAuth     | ‚úÖ      | ‚ùå         |
| –ü–æ–ª–Ω—ã–π –∫–æ–Ω—Ç—Ä–æ–ª—å –Ω–∞–¥ security | ‚ùå      | ‚úÖ         |

**–í—ã–≤–æ–¥:**  
- –î–ª—è —Å—Ç–∞—Ä—Ç–∞–ø–æ–≤ –∏ SaaS ‚Äî **Devise**  
- –î–ª—è –≤—ã—Å–æ–∫–æ–Ω–∞–≥—Ä—É–∂–µ–Ω–Ω—ã—Ö/–∫–∞—Å—Ç–æ–º–Ω—ã—Ö —Å–∏—Å—Ç–µ–º ‚Äî **Authlogic**  

---

## üîÆ –ë—É–¥—É—â–µ–µ: –º–æ–∂–µ—Ç, –ø—Ä–æ—Å—Ç–æ Sorcery?

–ï—Å–ª–∏ –æ–±–∞ –≤–∞—Ä–∏–∞–Ω—Ç–∞ –∫–∞–∂—É—Ç—Å—è –∫—Ä–∞–π–Ω–æ—Å—Ç—è–º–∏, –ø—Ä–∏—Å–º–æ—Ç—Ä–∏—Ç–µ—Å—å –∫ [Sorcery](https://github.com/Sorcery/sorcery) ‚Äî —ç—Ç–æ –∑–æ–ª–æ—Ç–∞—è —Å–µ—Ä–µ–¥–∏–Ω–∞ —Å –º–æ–¥—É–ª—å–Ω–æ–π –∞—Ä—Ö–∏—Ç–µ–∫—Ç—É—Ä–æ–π. –ù–æ —ç—Ç–æ —É–∂–µ —Ç–µ–º–∞ –¥–ª—è –æ—Ç–¥–µ–ª—å–Ω–æ–π —Å—Ç–∞—Ç—å–∏.

```ruby
# Gemfile
gem 'sorcery'
```

---

## üßæ –ò—Ç–æ–≥

1. **–ù–µ —É—Å–ª–æ–∂–Ω—è–π—Ç–µ** ‚Äî –µ—Å–ª–∏ —Ö–≤–∞—Ç–∞–µ—Ç Devise, –Ω–µ –∏–∑–æ–±—Ä–µ—Ç–∞–π—Ç–µ –≤–µ–ª–æ—Å–∏–ø–µ–¥.  
2. **–¢–µ—Å—Ç–∏—Ä—É–π—Ç–µ –±–µ–∑–æ–ø–∞—Å–Ω–æ—Å—Ç—å** ‚Äî –æ–±–∞ —Ä–µ—à–µ–Ω–∏—è —Ç—Ä–µ–±—É—é—Ç –ø—Ä–æ–≤–µ—Ä–∫–∏ –Ω–∞ —É—è–∑–≤–∏–º–æ—Å—Ç–∏.  
3. **–î–æ–∫—É–º–µ–Ω—Ç–∏—Ä—É–π—Ç–µ** ‚Äî –æ—Å–æ–±–µ–Ω–Ω–æ –∫–∞—Å—Ç–æ–º–Ω—ã–µ –∏–∑–º–µ–Ω–µ–Ω–∏—è –≤ Authlogic.  

> "–õ—É—á—à–∞—è —Å–∏—Å—Ç–µ–º–∞ –∞—É—Ç–µ–Ω—Ç–∏—Ñ–∏–∫–∞—Ü–∏–∏ ‚Äî —Ç–∞, –∫–æ—Ç–æ—Ä—É—é –≤—ã –ø–æ–ª–Ω–æ—Å—Ç—å—é –ø–æ–Ω–∏–º–∞–µ—Ç–µ –∏ –º–æ–∂–µ—Ç–µ –æ–±—ä—è—Å–Ω–∏—Ç—å –∫–æ–ª–ª–µ–≥–µ –≤ 3 —á–∞—Å–∞ –Ω–æ—á–∏".
