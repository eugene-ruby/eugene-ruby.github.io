---
layout: post
title:  "Ruby: private_class_method, public_send, freeze –∏ –ø—Ä–æ—á–∏–µ –º–µ—Ä—ã –ø—Ä–µ–¥–æ—Å—Ç–æ—Ä–æ–∂–Ω–æ—Å—Ç–∏"
date:   2022-09-21 17:00:00 +0300
rate: 3
tags: Ruby,–±–µ–∑–æ–ø–∞—Å–Ω–æ—Å—Ç—å,–ø—Ä–∏–≤–∞—Ç–Ω—ã–µ –º–µ—Ç–æ–¥—ã,–∑–∞—â–∏—Ç–∞ –¥–∞–Ω–Ω—ã—Ö,–º–µ—Ç–æ–¥—ã –æ–±—ä–µ–∫—Ç–æ–≤,–ø—Ä–æ–¥–∞–∫—à–µ–Ω
version: A49X3
categories:
  - ruby
toc: true
menubar_toc: true
hero_image: /images/ruby.jpg
hero_darken: true
---

Ruby ‚Äî —ç—Ç–æ –º–æ—â–Ω—ã–π –∏ –≤—ã—Ä–∞–∑–∏—Ç–µ–ª—å–Ω—ã–π —è–∑—ã–∫ –ø—Ä–æ–≥—Ä–∞–º–º–∏—Ä–æ–≤–∞–Ω–∏—è, –Ω–æ –±–µ–∑ –¥–æ–ª–∂–Ω–æ–≥–æ –≤–Ω–∏–º–∞–Ω–∏—è –∫ –±–µ–∑–æ–ø–∞—Å–Ω–æ—Å—Ç–∏ –∫–æ–¥–∞ –¥–∞–∂–µ –æ–ø—ã—Ç–Ω—ã–µ —Ä–∞–∑—Ä–∞–±–æ—Ç—á–∏–∫–∏ –º–æ–≥—É—Ç —Å—Ç–æ–ª–∫–Ω—É—Ç—å—Å—è —Å —É—è–∑–≤–∏–º–æ—Å—Ç—è–º–∏ –∏ –Ω–µ–æ–∂–∏–¥–∞–Ω–Ω—ã–º–∏ –æ—à–∏–±–∫–∞–º–∏. –í —ç—Ç–æ–π —Å—Ç–∞—Ç—å–µ –º—ã –ø–æ–¥—Ä–æ–±–Ω–æ —Ä–∞–∑–±–µ—Ä—ë–º –∫–ª—é—á–µ–≤—ã–µ –º–µ—Ö–∞–Ω–∏–∑–º—ã –∑–∞—â–∏—Ç—ã –¥–∞–Ω–Ω—ã—Ö –∏ –º–µ—Ç–æ–¥–æ–≤ –≤ Ruby: –æ—Ç –ø—Ä–∏–≤–∞—Ç–Ω—ã—Ö –º–µ—Ç–æ–¥–æ–≤ –∏ –∑–∞–º–æ—Ä–æ–∂–µ–Ω–Ω—ã—Ö –æ–±—ä–µ–∫—Ç–æ–≤ –¥–æ —Ç–æ–Ω–∫–æ—Å—Ç–µ–π —Ä–∞–±–æ—Ç—ã —Å `send`, `freeze` –∏ –¥—Ä—É–≥–∏–º–∏ –≤—Å—Ç—Ä–æ–µ–Ω–Ω—ã–º–∏ –∏–Ω—Å—Ç—Ä—É–º–µ–Ω—Ç–∞–º–∏ –±–µ–∑–æ–ø–∞—Å–Ω–æ—Å—Ç–∏. –í—ã —É–∑–Ω–∞–µ—Ç–µ, –∫–∞–∫ –∏–∑–±–µ–∂–∞—Ç—å —Ä–∞—Å–ø—Ä–æ—Å—Ç—Ä–∞–Ω—ë–Ω–Ω—ã—Ö –æ—à–∏–±–æ–∫, –ø–æ–≤—ã—Å–∏—Ç—å –Ω–∞–¥—ë–∂–Ω–æ—Å—Ç—å –∫–æ–¥–∞ –≤ –ø—Ä–æ–¥–∞–∫—à–µ–Ω–µ –∏ –ø–æ–¥–≥–æ—Ç–æ–≤–∏—Ç—å—Å—è –∫ —Å–ª–æ–∂–Ω—ã–º –≤–æ–ø—Ä–æ—Å–∞–º –Ω–∞ —Å–æ–±–µ—Å–µ–¥–æ–≤–∞–Ω–∏–∏. Ruby –¥–∞—ë—Ç —Å–≤–æ–±–æ–¥—É, –Ω–æ —Å –±–æ–ª—å—à–æ–π —Å–≤–æ–±–æ–¥–æ–π –ø—Ä–∏—Ö–æ–¥–∏—Ç –∏ –±–æ–ª—å—à–∞—è –æ—Ç–≤–µ—Ç—Å—Ç–≤–µ–Ω–Ω–æ—Å—Ç—å ‚Äî —Ä–∞–∑–±–µ—Ä—ë–º—Å—è, –∫–∞–∫ –ø—Ä–∞–≤–∏–ª—å–Ω–æ –∑–∞—â–∏—Ç–∏—Ç—å –º–µ—Ç–æ–¥—ã, –æ–±—ä–µ–∫—Ç—ã –∏ –¥–∞–Ω–Ω—ã–µ –≤ –≤–∞—à–∏—Ö –ø—Ä–æ–µ–∫—Ç–∞—Ö.

---

## üö™ `private_class_method`

```ruby
class Service
  def self.new
    puts "–ö–æ–Ω—Å—Ç—Ä—É–∫—Ç–æ—Ä –≤—ã–∑–≤–∞–Ω"
    super
  end

  private_class_method :new
end

Service.new  # üí• NoMethodError: private method `new`
````

–°–∫—Ä—ã–≤–∞–µ—Ç `new`, –∑–∞—Å—Ç–∞–≤–ª—è—è –∏—Å–ø–æ–ª—å–∑–æ–≤–∞—Ç—å `.build`, `.create`, `.call` –∏ —Ç.–ø.

---

## üîë `send` vs `public_send`

```ruby
class Secret
  def initialize; end

  private

  def password
    "123456"
  end
end

s = Secret.new
puts s.send(:password)       # => 123456
puts s.public_send(:password) # üí• NoMethodError
```

* `send` –æ–±—Ö–æ–¥–∏—Ç –ø—Ä–∏–≤–∞—Ç–Ω–æ—Å—Ç—å
* `public_send` ‚Äî –±–µ–∑–æ–ø–∞—Å–Ω—ã–π, –Ω–µ –≤—ã–∑–æ–≤–µ—Ç –ø—Ä–∏–≤–∞—Ç–Ω—ã–π –º–µ—Ç–æ–¥

–ù–∞ —Å–æ–±–µ—Å–µ–¥–æ–≤–∞–Ω–∏–∏ —á–∞—Å—Ç–æ —Å–ø—Ä–∞—à–∏–≤–∞—é—Ç: "–ö–æ–≥–¥–∞ –∏—Å–ø–æ–ª—å–∑–æ–≤–∞—Ç—å `public_send`?"

---

## üßä `freeze` ‚Äî –∑–∞—â–∏—Ç–∞ –æ—Ç –º—É—Ç–∞—Ü–∏–∏

```ruby
str = "hello"
str.freeze

str << " world" # üí• RuntimeError: can't modify frozen String
```

–õ—é–±–æ–π –≤—ã–∑–æ–≤, –∫–æ—Ç–æ—Ä—ã–π –º—É—Ç–∏—Ä—É–µ—Ç –æ–±—ä–µ–∫—Ç, –≤—ã–∑–æ–≤–µ—Ç –∏—Å–∫–ª—é—á–µ–Ω–∏–µ.

---

## üß™ –†–∞–∑–Ω–∏—Ü–∞ –º–µ–∂–¥—É `dup` –∏ `clone`

```ruby
obj = "hi".freeze

dup   = obj.dup
clone = obj.clone

puts dup.frozen?   # => false
puts clone.frozen? # => true
```

* `dup` –¥–µ–ª–∞–µ—Ç –Ω–µ–≥–ª—É–±–æ–∫—É—é –∫–æ–ø–∏—é –±–µ–∑ —Ñ–ª–∞–≥–æ–≤
* `clone` –∫–æ–ø–∏—Ä—É–µ—Ç –æ–±—ä–µ–∫—Ç **–≤–∫–ª—é—á–∞—è —Ñ–ª–∞–≥–∏** (`freeze`, singleton methods)

---

## üßØ `frozen_string_literal: true`

–í–∫–ª—é—á–∏ —ç—Ç–æ –≤ –Ω–∞—á–∞–ª–æ —Ñ–∞–π–ª–∞, –∏ –≤—Å–µ —Å—Ç—Ä–æ–∫–∏ –≤ –Ω—ë–º —Å—Ç–∞–Ω—É—Ç `frozen` –ø–æ —É–º–æ–ª—á–∞–Ω–∏—é:

```ruby
# frozen_string_literal: true

greeting = "hello"
greeting << " world"  # üí• RuntimeError
```

–ü–æ–ª–µ–∑–Ω–æ –¥–ª—è:

* –ø—Ä–æ–∏–∑–≤–æ–¥–∏—Ç–µ–ª—å–Ω–æ—Å—Ç–∏,
* –ø—Ä–µ–¥–æ—Ç–≤—Ä–∞—â–µ–Ω–∏—è —Å–ª—É—á–∞–π–Ω–æ–π –º—É—Ç–∞—Ü–∏–∏.

---

## üßô‚Äç‚ôÇÔ∏è –ü—Ä–∏–º–µ—Ä –ø–∞—Ç—Ç–µ—Ä–Ω–∞ `.call` –≤–º–µ—Å—Ç–æ `.new`

```ruby
class Report
  def self.call(...)
    new(...).call
  end

  private_class_method :new

  def call
    "–ì–µ–Ω–µ—Ä–∏—Ä—É—é –æ—Ç—á—ë—Ç..."
  end
end

puts Report.call # => –ì–µ–Ω–µ—Ä–∏—Ä—É—é –æ—Ç—á—ë—Ç...
```

---

## üß® –í–æ–ø—Ä–æ—Å —Å –ø–æ–¥–≤–æ—Ö–æ–º

```ruby
class A
  def self.init
    new
  end

  private

  def initialize
    puts "–ü—Ä–∏–≤–∞—Ç–Ω—ã–π –∏–Ω–∏—Ç"
  end
end

A.init  # ?
```

**–û—Ç–≤–µ—Ç:**
‚úÖ –†–∞–±–æ—Ç–∞–µ—Ç!
**–ü–æ—á–µ–º—É?**
`new` –ø—Ä–∏–≤–∞—Ç–Ω—ã–π **–≤–Ω—É—Ç—Ä–∏ –∫–ª–∞—Å—Å–∞** ‚Äî –Ω–æ `self.init` –≤—ã–∑—ã–≤–∞–µ—Ç—Å—è **–∏–∑–Ω—É—Ç—Ä–∏ –∫–ª–∞—Å—Å–∞**, –ø–æ—ç—Ç–æ–º—É Ruby —Ä–∞–∑—Ä–µ—à–∞–µ—Ç –¥–æ—Å—Ç—É–ø.

---

üîö **–í—ã–≤–æ–¥:**
–ò–Ω–æ–≥–¥–∞ Ruby –Ω–∞–ø–æ–º–∏–Ω–∞–µ—Ç –π–æ–≥—É: –º—è–≥–∫–∏–π, –≥–∏–±–∫–∏–π, –Ω–æ –ø—Ä–∏ —ç—Ç–æ–º –º–æ–∂–Ω–æ –≤—ã–≤–µ—Ä–Ω—É—Ç—å—Å—è –≤ —É–∑–µ–ª. –£–º–µ–Ω–∏–µ –∫–æ–Ω—Ç—Ä–æ–ª–∏—Ä–æ–≤–∞—Ç—å –¥–æ—Å—Ç—É–ø –∏ –º—É—Ç–∞—Ü–∏–∏ –æ–±—ä–µ–∫—Ç–æ–≤ ‚Äî —ç—Ç–æ –∑—Ä–µ–ª–æ—Å—Ç—å. –ò —ç—Ç–æ –ø—Ä–æ–≤–µ—Ä—è—é—Ç.
