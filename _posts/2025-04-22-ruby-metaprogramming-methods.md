---
layout: post
subtitle: <div id="terminal"></div>
title:  "üõ† –ú–µ—Ç–æ–¥—ã –¥–ª—è —Ä–∞–±–æ—Ç—ã —Å –º–µ—Ç–æ–¥–∞–º–∏ –≤ Ruby: define_method, remove_method, undef_method, alias_method"
date:   2025-04-22 12:00:00 +0300
rate: 4
tags: Ruby,–º–µ—Ç–∞–ø—Ä–æ–≥—Ä–∞–º–º–∏—Ä–æ–≤–∞–Ω–∏–µ,—Ä–µ—Ñ–ª–µ–∫—Å–∏—è,–º–µ—Ç–æ–¥—ã
version: 3.2.2
categories:
  - ruby
hero_image: /images/posts/35.jpg
hero_darken: true
toc: true
menubar_toc: true
---

–í Ruby –º–µ—Ç–æ–¥—ã ‚Äî —ç—Ç–æ –Ω–µ –ø—Ä–æ—Å—Ç–æ –∫—É—Å–∫–∏ –∫–æ–¥–∞, –∞ –ø–æ–ª–Ω–æ—Ü–µ–Ω–Ω—ã–µ –æ–±—ä–µ–∫—Ç—ã, –∫–æ—Ç–æ—Ä—ã–º–∏ –º–æ–∂–Ω–æ —É–ø—Ä–∞–≤–ª—è—Ç—å –¥–∏–Ω–∞–º–∏—á–µ—Å–∫–∏. –í —Å—Ç–∞—Ç—å–µ —Ä–∞–∑–±–µ—Ä—ë–º —á–µ—Ç—ã—Ä–µ –º–æ—â–Ω—ã—Ö –∏–Ω—Å—Ç—Ä—É–º–µ–Ω—Ç–∞ –¥–ª—è —Ä–∞–±–æ—Ç—ã —Å –º–µ—Ç–æ–¥–∞–º–∏: –æ—Ç —Å–æ–∑–¥–∞–Ω–∏—è –Ω–∞ –ª–µ—Ç—É –¥–æ —Ö–∏—Ä—É—Ä–≥–∏—á–µ—Å–∫–æ–≥–æ —É–¥–∞–ª–µ–Ω–∏—è. –ü–æ–∫–∞–∂–µ–º, –≥–¥–µ —ç—Ç–æ –ø–æ–ª–µ–∑–Ω–æ –∏ –∫–∞–∫ –Ω–µ –ø—Ä–æ—Å—Ç—Ä–µ–ª–∏—Ç—å —Å–µ–±–µ –Ω–æ–≥—É –º–µ—Ç–∞–ø—Ä–æ–≥—Ä–∞–º–º–∏—Ä–æ–≤–∞–Ω–∏–µ–º.

---

## üß† –¢–µ–æ—Ä–∏—è: –∑–∞—á–µ–º —ç—Ç–æ –Ω—É–∂–Ω–æ?

Ruby –ø–æ–∑–≤–æ–ª—è–µ—Ç **–∏–∑–º–µ–Ω—è—Ç—å –∫–ª–∞—Å—Å—ã –∏ –æ–±—ä–µ–∫—Ç—ã –≤–æ –≤—Ä–µ–º—è –≤—ã–ø–æ–ª–Ω–µ–Ω–∏—è –ø—Ä–æ–≥—Ä–∞–º–º—ã**. –≠—Ç–æ –æ—Ç–∫—Ä—ã–≤–∞–µ—Ç –¥–≤–µ—Ä–∏ –¥–ª—è:
- –ì–µ–Ω–µ—Ä–∞—Ü–∏–∏ –º–µ—Ç–æ–¥–æ–≤ –ø–æ —à–∞–±–ª–æ–Ω—É (DRY)
- –£–ø—Ä–∞–≤–ª–µ–Ω–∏—è –≤–∏–¥–∏–º–æ—Å—Ç—å—é –º–µ—Ç–æ–¥–æ–≤ (–Ω–∞–ø—Ä–∏–º–µ—Ä, –¥–ª—è DSL)
- –°–æ–∑–¥–∞–Ω–∏—è –ø—Å–µ–≤–¥–æ–Ω–∏–º–æ–≤ –¥–ª—è –æ–±—Ä–∞—Ç–Ω–æ–π —Å–æ–≤–º–µ—Å—Ç–∏–º–æ—Å—Ç–∏
- –û—á–∏—Å—Ç–∫–∏ –∫–æ–¥–∞ –æ—Ç —É—Å—Ç–∞—Ä–µ–≤—à–∏—Ö –º–µ—Ç–æ–¥–æ–≤

–ù–æ —Å –±–æ–ª—å—à–æ–π —Å–∏–ª–æ–π –ø—Ä–∏—Ö–æ–¥–∏—Ç –∏ –±–æ–ª—å—à–∞—è –æ—Ç–≤–µ—Ç—Å—Ç–≤–µ–Ω–Ω–æ—Å—Ç—å ‚Äî –æ—à–∏–±–∫–∏ –≤ –º–µ—Ç–∞–ø—Ä–æ–≥—Ä–∞–º–º–∏—Ä–æ–≤–∞–Ω–∏–∏ —á–∞—Å—Ç–æ –ø—Ä–æ—è–≤–ª—è—é—Ç—Å—è —Ç–æ–ª—å–∫–æ –≤ runtime.

---

## 1Ô∏è‚É£ `define_method` ‚Äî —Ñ–∞–±—Ä–∏–∫–∞ –º–µ—Ç–æ–¥–æ–≤

**–ß—Ç–æ –¥–µ–ª–∞–µ—Ç:** —Å–æ–∑–¥–∞—ë—Ç –º–µ—Ç–æ–¥ –≤ runtime.

```ruby
class User
  [:admin, :moderator, :guest].each do |role|
    define_method("#{role}?") do
      self.role == role.to_s
    end
  end
end

user = User.new(role: 'admin')
user.admin? # => true
```

**–ñ–∏–∑–Ω–µ–Ω–Ω—ã–π –ø—Ä–∏–º–µ—Ä:**
- –ì–µ–Ω–µ—Ä–∞—Ü–∏—è –º–µ—Ç–æ–¥–æ–≤ –ø—Ä–æ–≤–µ—Ä–∫–∏ —Ä–æ–ª–µ–π (–∫–∞–∫ –≤—ã—à–µ)
- –°–æ–∑–¥–∞–Ω–∏–µ –≥–µ—Ç—Ç–µ—Ä–æ–≤/—Å–µ—Ç—Ç–µ—Ä–æ–≤ –¥–ª—è –¥–∏–Ω–∞–º–∏—á–µ—Å–∫–∏—Ö –∞—Ç—Ä–∏–±—É—Ç–æ–≤
- –†–µ–∞–ª–∏–∑–∞—Ü–∏—è —à–∞–±–ª–æ–Ω–Ω—ã—Ö –º–µ—Ç–æ–¥–æ–≤ (–Ω–∞–ø—Ä–∏–º–µ—Ä, find_by_*)

**–ê–Ω—Ç–∏–ø–∞—Ç—Ç–µ—Ä–Ω:**
```ruby
# –ü–ª–æ—Ö–æ: –º–µ—Ç–æ–¥ —Å–æ–∑–¥–∞—ë—Ç—Å—è, –Ω–æ –Ω–∏–∫–æ–≥–¥–∞ –Ω–µ –∏—Å–ø–æ–ª—å–∑—É–µ—Ç—Å—è
define_method("unused_#{rand(100)}") { ... }
```

---

## 2Ô∏è‚É£ `remove_method` ‚Äî —Ö–∏—Ä—É—Ä–≥–∏—á–µ—Å–∫–æ–µ —É–¥–∞–ª–µ–Ω–∏–µ

**–ß—Ç–æ –¥–µ–ª–∞–µ—Ç:** —É–¥–∞–ª—è–µ—Ç –º–µ—Ç–æ–¥ –∏–∑ —Ç–µ–∫—É—â–µ–≥–æ –∫–ª–∞—Å—Å–∞ (–Ω–æ –æ—Å—Ç–∞–≤–ª—è–µ—Ç –≤ —Ä–æ–¥–∏—Ç–µ–ª—å—Å–∫–∏—Ö).

```ruby
class Parent
  def deprecated_method
    "–ù–µ –∏—Å–ø–æ–ª—å–∑—É–π—Ç–µ –º–µ–Ω—è!"
  end
end

class Child < Parent
  remove_method :deprecated_method
end

Child.new.deprecated_method # => NoMethodError
```

**–ñ–∏–∑–Ω–µ–Ω–Ω—ã–π –ø—Ä–∏–º–µ—Ä:**
- –û—Ç–∫–ª—é—á–µ–Ω–∏–µ —É—Å—Ç–∞—Ä–µ–≤—à–∏—Ö –º–µ—Ç–æ–¥–æ–≤ –≤ –ø–æ–¥–∫–ª–∞—Å—Å–∞—Ö
- –£–¥–∞–ª–µ–Ω–∏–µ –º–µ—Ç–æ–¥–æ–≤, –¥–æ–±–∞–≤–ª–µ–Ω–Ω—ã—Ö –¥—Ä—É–≥–∏–º–∏ –≥–µ–º–∞–º–∏
- –û—á–∏—Å—Ç–∫–∞ namespace –≤ DSL

**–û–ø–∞—Å–Ω–æ—Å—Ç—å:**
```ruby
class String
  remove_method :upcase
end
# –í—Å–µ —Å—Ç—Ä–æ–∫–∏ —Ç–µ—Ä—è—é—Ç upcase ‚Äî —Å–∏—Å—Ç–µ–º–∞ –ø–∞–¥–∞–µ—Ç –≤ —Å–ª—É—á–∞–π–Ω—ã—Ö –º–µ—Å—Ç–∞—Ö
```

---

## 3Ô∏è‚É£ `undef_method` ‚Äî —è–¥–µ—Ä–Ω—ã–π –≤–∞—Ä–∏–∞–Ω—Ç

**–ß—Ç–æ –¥–µ–ª–∞–µ—Ç:** –ø–æ–ª–Ω–æ—Å—Ç—å—é –∑–∞–ø—Ä–µ—â–∞–µ—Ç –≤—ã–∑–æ–≤ –º–µ—Ç–æ–¥–∞ (–¥–∞–∂–µ –∏–∑ —Ä–æ–¥–∏—Ç–µ–ª—å—Å–∫–∏—Ö –∫–ª–∞—Å—Å–æ–≤).

```ruby
class Security
  undef_method :instance_eval # –ó–∞–ø—Ä–µ—â–∞–µ–º –æ–ø–∞—Å–Ω—ã–π –º–µ—Ç–æ–¥
end

Security.new.instance_eval {} # => NoMethodError
```

**–ñ–∏–∑–Ω–µ–Ω–Ω—ã–π –ø—Ä–∏–º–µ—Ä:**
- –ó–∞–ø—Ä–µ—Ç –æ–ø–∞—Å–Ω—ã—Ö –º–µ—Ç–æ–¥–æ–≤ (eval, send) –≤ sandbox
- –°–æ–∫—Ä—ã—Ç–∏–µ –≤–Ω—É—Ç—Ä–µ–Ω–Ω–∏—Ö –º–µ—Ç–æ–¥–æ–≤ API
- –ó–∞—â–∏—Ç–∞ –æ—Ç monkey-patching

**–†–∞–∑–Ω–∏—Ü–∞ —Å remove_method:**
```ruby
class A; def m; end; end
class B < A; remove_method :m; end
B.new.m # => –≤—ã–∑–æ–≤–µ—Ç—Å—è A#m

class C < A; undef_method :m; end
C.new.m # => NoMethodError
```

---

## 4Ô∏è‚É£ `alias_method` ‚Äî –∫–ª–æ–Ω–∏—Ä–æ–≤–∞–Ω–∏–µ –º–µ—Ç–æ–¥–æ–≤

**–ß—Ç–æ –¥–µ–ª–∞–µ—Ç:** —Å–æ–∑–¥–∞—ë—Ç –ø—Å–µ–≤–¥–æ–Ω–∏–º –¥–ª—è —Å—É—â–µ—Å—Ç–≤—É—é—â–µ–≥–æ –º–µ—Ç–æ–¥–∞.

```ruby
class User
  def save
    validate!
    super
  end
  
  alias_method :save!, :save
end

# –¢–µ–ø–µ—Ä—å save! ‚Äî —ç—Ç–æ —Ç–æ—Ç –∂–µ save
```

**–ñ–∏–∑–Ω–µ–Ω–Ω—ã–π –ø—Ä–∏–º–µ—Ä:**
- –ü–æ–¥–¥–µ—Ä–∂–∫–∞ —Å—Ç–∞—Ä–æ–≥–æ API (—Å—Ç–∞—Ä—ã–π_method ‚Üí –Ω–æ–≤—ã–π_method)
- –î–æ–±–∞–≤–ª–µ–Ω–∏–µ "–æ–ø–∞—Å–Ω–æ–π" –≤–µ—Ä—Å–∏–∏ –º–µ—Ç–æ–¥–∞ (save ‚Üí save!)
- –û–±—ë—Ä—Ç–∫–∞ –º–µ—Ç–æ–¥–æ–≤ —Å —Å–æ—Ö—Ä–∞–Ω–µ–Ω–∏–µ–º –æ—Ä–∏–≥–∏–Ω–∞–ª–∞ (–¥–ª—è –ª–æ–≥–∏—Ä–æ–≤–∞–Ω–∏—è)

**–õ–æ–≤—É—à–∫–∞:**
```ruby
alias_method :new_name, :old_name
def old_name
  "–ù–æ–≤–∞—è —Ä–µ–∞–ª–∏–∑–∞—Ü–∏—è"
end
# new_name –ø—Ä–æ–¥–æ–ª–∂–∞–µ—Ç –∏—Å–ø–æ–ª—å–∑–æ–≤–∞—Ç—å —Å—Ç–∞—Ä—É—é —Ä–µ–∞–ª–∏–∑–∞—Ü–∏—é!
```

---

## üî• –†–µ–∞–ª—å–Ω—ã–π –∫–µ–π—Å: –¥–∏–Ω–∞–º–∏—á–µ—Å–∫–∏–π API –∫–ª–∏–µ–Ω—Ç

```ruby
class ApiClient
  HTTP_METHODS = [:get, :post, :put, :delete]

  HTTP_METHODS.each do |method|
    define_method(method) do |path, **params|
      send_request(method.upcase, path, params)
    end
    
    alias_method "#{method}_request", method
  end

  private

  def send_request(verb, path, params)
    # –†–µ–∞–ª—å–Ω–∞—è —Ä–µ–∞–ª–∏–∑–∞—Ü–∏—è
  end
end

client = ApiClient.new
client.get("/users") # => GET /users
client.post_request("/login", email: "test@test.com") # => POST /login
```

---

## üß™ –¢–µ—Å—Ç–∏—Ä–æ–≤–∞–Ω–∏–µ –¥–∏–Ω–∞–º–∏—á–µ—Å–∫–∏—Ö –º–µ—Ç–æ–¥–æ–≤

```ruby
RSpec.describe ApiClient do
  described_class::HTTP_METHODS.each do |method|
    it "responds to #{method}" do
      expect(subject).to respond_to(method)
    end
    
    it "aliases #{method} as #{method}_request" do
      expect(subject.method(method)).to eq(subject.method("#{method}_request"))
    end
  end
end
```

---

## üíÄ –û–ø–∞—Å–Ω—ã–µ –ø—Ä–∞–∫—Ç–∏–∫–∏

1. **–ú–µ—Ç–æ–¥–æ–≤–∞—è –±–æ–º–±–∞** ‚Äî —Å–æ–∑–¥–∞–Ω–∏–µ —Å–æ—Ç–µ–Ω –º–µ—Ç–æ–¥–æ–≤ –≤ runtime:
   ```ruby
   DATA.each { |name| define_method(name) { ... } } # –ú–æ–∂–µ—Ç –ø–µ—Ä–µ–≥—Ä—É–∑–∏—Ç—å –ø–∞–º—è—Ç—å
   ```

2. **–ù–µ–æ—á–µ–≤–∏–¥–Ω–æ–µ —É–¥–∞–ª–µ–Ω–∏–µ** –º–µ—Ç–æ–¥–æ–≤:
   ```ruby
   class Product
     remove_method :name # –ê name –±—ã–ª –æ–ø—Ä–µ–¥–µ–ª—ë–Ω –≤ —Ä–æ–¥–∏—Ç–µ–ª—å—Å–∫–æ–º Item!
   end
   ```

3. **–ê–ª–∏–∞—Å—ã-–∑–æ–º–±–∏** ‚Äî –∫–æ–≥–¥–∞ –æ—Ä–∏–≥–∏–Ω–∞–ª—å–Ω—ã–π –º–µ—Ç–æ–¥ –ø–µ—Ä–µ–æ–ø—Ä–µ–¥–µ–ª—ë–Ω, –Ω–æ –∞–ª–∏–∞—Å –∂–∏–≤—ë—Ç —Å–≤–æ–µ–π –∂–∏–∑–Ω—å—é.

---

## üéØ –ö–æ–≥–¥–∞ —ç—Ç–æ –¥–µ–π—Å—Ç–≤–∏—Ç–µ–ª—å–Ω–æ –Ω—É–∂–Ω–æ

| –ú–µ—Ç–æ–¥             | –õ—É—á—à–∏–µ —Å–ª—É—á–∞–∏ –ø—Ä–∏–º–µ–Ω–µ–Ω–∏—è                  |
|-------------------|------------------------------------------|
| `define_method`   | –ì–µ–Ω–µ—Ä–∞—Ü–∏—è –º–µ—Ç–æ–¥–æ–≤ –ø–æ —à–∞–±–ª–æ–Ω—É, DRY        |
| `remove_method`   | –ö–∞—Å—Ç–æ–º–∏–∑–∞—Ü–∏—è –ø–æ–≤–µ–¥–µ–Ω–∏—è –≤ –ø–æ–¥–∫–ª–∞—Å—Å–∞—Ö      |
| `undef_method`    | –ó–∞—â–∏—Ç–∞ –æ—Ç –Ω–µ–∂–µ–ª–∞—Ç–µ–ª—å–Ω–æ–≥–æ –ø–æ–≤–µ–¥–µ–Ω–∏—è       |
| `alias_method`    | –ü–æ–¥–¥–µ—Ä–∂–∫–∞ –æ–±—Ä–∞—Ç–Ω–æ–π —Å–æ–≤–º–µ—Å—Ç–∏–º–æ—Å—Ç–∏, DSL    |

---

## üßæ –í—ã–≤–æ–¥

1. **`define_method`** ‚Äî –≤–∞—à –∏–Ω—Å—Ç—Ä—É–º–µ–Ω—Ç –¥–ª—è –∏–∑–±–µ–∂–∞–Ω–∏—è –∫–æ–ø–∏–ø–∞—Å—Ç—ã –ø—Ä–∏ —Å–æ–∑–¥–∞–Ω–∏–∏ –º–µ—Ç–æ–¥–æ–≤.
2. **`remove_method`/`undef_method`** ‚Äî —Å–∫–∞–ª—å–ø–µ–ª—å –¥–ª—è —Ç–æ–Ω–∫–æ–π –Ω–∞—Å—Ç—Ä–æ–π–∫–∏ –∏–µ—Ä–∞—Ä—Ö–∏–π –∫–ª–∞—Å—Å–æ–≤.
3. **`alias_method`** ‚Äî –º–æ—Å—Ç –º–µ–∂–¥—É —Å—Ç–∞—Ä—ã–º –∏ –Ω–æ–≤—ã–º API.

–ò—Å–ø–æ–ª—å–∑—É–π—Ç–µ –∏—Ö –æ—Å–æ–∑–Ω–∞–Ω–Ω–æ: –¥–∏–Ω–∞–º–∏—á–µ—Å–∫–æ–µ –∏–∑–º–µ–Ω–µ–Ω–∏–µ –º–µ—Ç–æ–¥–æ–≤ ‚Äî —ç—Ç–æ –∫–∞–∫ –æ–ø–µ—Ä–∞—Ü–∏—è –Ω–∞ –æ—Ç–∫—Ä—ã—Ç–æ–º —Å–µ—Ä–¥—Ü–µ. –û–¥–Ω–æ –Ω–µ–≤–µ—Ä–Ω–æ–µ –¥–≤–∏–∂–µ–Ω–∏–µ ‚Äî –∏ –ø—Ä–æ–≥—Ä–∞–º–º–∞ –ø–∞–¥–∞–µ—Ç –≤ runtime —Å –∑–∞–≥–∞–¥–æ—á–Ω–æ–π –æ—à–∏–±–∫–æ–π.

**–ó–æ–ª–æ—Ç–æ–µ –ø—Ä–∞–≤–∏–ª–æ:** –µ—Å–ª–∏ –º–æ–∂–Ω–æ –æ–±–æ–π—Ç–∏—Å—å –æ–±—ã—á–Ω—ã–º–∏ –º–µ—Ç–æ–¥–∞–º–∏ ‚Äî —Ç–∞–∫ –∏ –¥–µ–ª–∞–π—Ç–µ. –ú–µ—Ç–∞–ø—Ä–æ–≥—Ä–∞–º–º–∏—Ä–æ–≤–∞–Ω–∏–µ –æ–ø—Ä–∞–≤–¥–∞–Ω–æ —Ç–æ–ª—å–∫–æ –∫–æ–≥–¥–∞ –æ–Ω–æ —Ä–µ–∞–ª—å–Ω–æ —É–ø—Ä–æ—â–∞–µ—Ç –∫–æ–¥.
