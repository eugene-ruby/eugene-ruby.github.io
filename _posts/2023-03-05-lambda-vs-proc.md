---
layout: post
subtitle: <div id="terminal"></div>
title:  "Ruby: lambda, proc –∏ yield ‚Äî —Ç—Ä–∏ –≥—Ä–∞–Ω–∏ –æ–¥–Ω–æ–≥–æ —É–∂–∞—Å–∞"
date:   2023-03-05 14:00:00 +0300
rate: 3  
tags: lambda,proc,yield,Ruby,–±–ª–æ–∫–∏ –∫–æ–¥–∞,—Ä–∞–∑–Ω–∏—Ü–∞
version: A9X
categories:
  - ruby
toc: true
menubar_toc: true
hero_image: /images/ruby.jpg
hero_darken: true
---

–í Ruby —Ä–∞–±–æ—Ç–∞ —Å –±–ª–æ–∫–∞–º–∏ –∫–æ–¥–∞ ‚Äî —Ñ—É–Ω–¥–∞–º–µ–Ω—Ç–∞–ª—å–Ω—ã–π –Ω–∞–≤—ã–∫ –¥–ª—è –ª—é–±–æ–≥–æ —Ä–∞–∑—Ä–∞–±–æ—Ç—á–∏–∫–∞. –ü–æ–Ω–∏–º–∞–Ω–∏–µ —Ä–∞–∑–Ω–∏—Ü—ã –º–µ–∂–¥—É `lambda`, `proc` –∏ `yield` –∫—Ä–∏—Ç–∏—á–µ—Å–∫–∏ –≤–∞–∂–Ω–æ –¥–ª—è –Ω–∞–ø–∏—Å–∞–Ω–∏—è —á–∏—Å—Ç–æ–≥–æ, —ç—Ñ—Ñ–µ–∫—Ç–∏–≤–Ω–æ–≥–æ –∏ –ø–æ–¥–¥–µ—Ä–∂–∏–≤–∞–µ–º–æ–≥–æ –∫–æ–¥–∞. –í —ç—Ç–æ–π —Å—Ç–∞—Ç—å–µ –º—ã –¥–µ—Ç–∞–ª—å–Ω–æ —Ä–∞–∑–±–µ—Ä—ë–º –∫–ª—é—á–µ–≤—ã–µ –æ—Ç–ª–∏—á–∏—è, –æ—Å–æ–±–µ–Ω–Ω–æ—Å—Ç–∏ –ø–æ–≤–µ–¥–µ–Ω–∏—è –∏ –ø—Ä–∞–∫—Ç–∏—á–µ—Å–∫–∏–µ —Å—Ü–µ–Ω–∞—Ä–∏–∏ –ø—Ä–∏–º–µ–Ω–µ–Ω–∏—è –∫–∞–∂–¥–æ–≥–æ –ø–æ–¥—Ö–æ–¥–∞.

---

## üß† –¢—Ä–∏ —Å–ø–æ—Å–æ–±–∞ –≤—ã–∑–≤–∞—Ç—å –±–ª–æ–∫ –∫–æ–¥–∞

```ruby
def with_yield
  yield
end

def with_proc(p)
  p.call
end

with_yield { puts "—á–µ—Ä–µ–∑ yield" }         # => —á–µ—Ä–µ–∑ yield
with_proc(Proc.new { puts "—á–µ—Ä–µ–∑ proc" }) # => —á–µ—Ä–µ–∑ proc
````

---

## ü§π‚Äç‚ôÇÔ∏è –†–∞–∑–ª–∏—á–∏—è –º–µ–∂–¥—É lambda –∏ Proc.new

### 1. –ü–æ–≤–µ–¥–µ–Ω–∏–µ `return`

```ruby
def l
  f = lambda { return "lambda" }
  f.call
  "–ø–æ—Å–ª–µ lambda"
end

def p
  f = Proc.new { return "proc" }
  f.call
  "–ø–æ—Å–ª–µ proc"
end

puts l # => "–ø–æ—Å–ª–µ lambda"
puts p # => LocalJumpError (–∏–ª–∏ nil, –µ—Å–ª–∏ rescue)
```

**lambda:** `return` –≤—ã—Ö–æ–¥–∏—Ç –∏–∑ lambda
**proc:** `return` –≤—ã—Ö–æ–¥–∏—Ç –∏–∑ –æ–∫—Ä—É–∂–∞—é—â–µ–≥–æ –º–µ—Ç–æ–¥–∞!

---

### 2. –ü—Ä–æ–≤–µ—Ä–∫–∞ –∞—Ä–≥—É–º–µ–Ω—Ç–æ–≤

```ruby
l = ->(x, y) { "#{x}, #{y}" }
p = Proc.new { |x, y| "#{x}, #{y}" }

puts l.call(1)         # ArgumentError!
puts p.call(1)         # => "1, "
```

**lambda** ‚Äî —Å—Ç—Ä–æ–≥–∞—è: –ø—Ä–æ–≤–µ—Ä—è–µ—Ç –∫–æ–ª-–≤–æ –∞—Ä–≥—É–º–µ–Ω—Ç–æ–≤.
**proc** ‚Äî —Å–Ω–∏—Å—Ö–æ–¥–∏—Ç–µ–ª—å–Ω–∞—è: –Ω–µ–¥–æ—Å—Ç–∞—é—â–∏–µ –∞—Ä–≥—É–º–µ–Ω—Ç—ã = `nil`.

---

## üöÄ –°–∏–Ω—Ç–∞–∫—Å–∏—Å

```ruby
lambda { }             # –æ–±—ã—á–Ω–∞—è —Ñ–æ—Ä–º–∞
->(x, y) { x + y }      # —Å–æ–∫—Ä–∞—â—ë–Ω–Ω–∞—è
Proc.new { }           # —Å—Ç–∞—Ä—ã–π —Å—Ç–∏–ª—å
proc { }               # alias
```

–°–æ–≤—Ä–µ–º–µ–Ω–Ω—ã–µ –ø—Ä–æ–µ–∫—Ç—ã –ø—Ä–µ–¥–ø–æ—á–∏—Ç–∞—é—Ç `->`.

---

## üß∑ –ê `yield`?

* –í—ã–∑—ã–≤–∞–µ—Ç –ø–µ—Ä–µ–¥–∞–Ω–Ω—ã–π –±–ª–æ–∫, –±–µ–∑ —è–≤–Ω–æ–≥–æ –ø–∞—Ä–∞–º–µ—Ç—Ä–∞.
* –†–∞–±–æ—Ç–∞–µ—Ç **—Ç–æ–ª—å–∫–æ** –µ—Å–ª–∏ –±—ã–ª –ø–µ—Ä–µ–¥–∞–Ω –±–ª–æ–∫.

```ruby
def do_something
  yield if block_given?
end

do_something { puts "–û–∫–µ–π!" }
```

> üí• –ü–æ–ø—Ä–æ–±—É–π –≤—ã–∑–≤–∞—Ç—å `yield`, –µ—Å–ª–∏ –±–ª–æ–∫–∞ –Ω–µ—Ç ‚Äî –±—É–¥–µ—Ç `LocalJumpError`.

---

## üìå –ü—Ä–∞–∫—Ç–∏–∫–∞ VS —Å–æ–±–µ—Å–µ–¥–æ–≤–∞–Ω–∏–µ

| –•–∞—Ä–∞–∫—Ç–µ—Ä–∏—Å—Ç–∏–∫–∞              | lambda             | Proc.new          | yield                |
| --------------------------- | ------------------ | ----------------- | -------------------- |
| `return` –≤–Ω—É—Ç—Ä–∏             | –Ω–µ –≤–ª–∏—è–µ—Ç –Ω–∞ –º–µ—Ç–æ–¥ | –≤—ã—Ö–æ–¥–∏—Ç –∏–∑ –º–µ—Ç–æ–¥–∞ | –≤—ã—Ö–æ–¥–∏—Ç –∏–∑ –º–µ—Ç–æ–¥–∞    |
| –ê—Ä–≥—É–º–µ–Ω—Ç—ã                   | —Å—Ç—Ä–æ–≥–æ             | –º—è–≥–∫–æ             | –∑–∞–≤–∏—Å–∏—Ç –æ—Ç —Å–∏–≥–Ω–∞—Ç—É—Ä—ã |
| –î–æ—Å—Ç—É–ø–µ–Ω –∫–∞–∫ –æ–±—ä–µ–∫—Ç?                 | –¥–∞                 | –¥–∞                | –Ω–µ—Ç                  |
| –ú–æ–∂–Ω–æ –ø–µ—Ä–µ–¥–∞—Ç—å –≤ –ø–µ—Ä–µ–º–µ–Ω–Ω—É—é | –¥–∞                 | –¥–∞                | –Ω–µ—Ç                  |

---

## üí° –°–æ–≤–µ—Ç: –≤—Å–µ–≥–¥–∞ –Ω–∞–∑—ã–≤–∞–π –±–ª–æ–∫–∏, –∫–æ–≥–¥–∞ –Ω—É–∂–µ–Ω –∫–æ–Ω—Ç—Ä–æ–ª—å

```ruby
def wrap(&block)
  block.call if block
end
```

## –î–æ—Å—Ç—É–ø–µ–Ω –∫–∞–∫ –æ–±—ä–µ–∫—Ç?

### üîπ `lambda` –∏ `Proc.new`:

–û–Ω–∏ **—Å–æ–∑–¥–∞—é—Ç –æ–±—ä–µ–∫—Ç—ã**, –∫–æ—Ç–æ—Ä—ã–µ –º–æ–∂–Ω–æ –ø—Ä–∏—Å–≤–æ–∏—Ç—å –≤ –ø–µ—Ä–µ–º–µ–Ω–Ω—É—é:

```ruby
f = lambda { puts "Hi" }
f.call
```

```ruby
p = Proc.new { puts "Hello" }
p.call
```

‚Üí –≠—Ç–æ **–∏–º–µ–Ω–æ–≤–∞–Ω–Ω—ã–µ –æ–±—ä–µ–∫—Ç—ã** (`f`, `p`) ‚Äî –ø–µ—Ä–µ–º–µ–Ω–Ω—ã–µ, –∫–æ—Ç–æ—Ä—ã–µ —Ö—Ä–∞–Ω—è—Ç –±–ª–æ–∫ –∏ –¥–∞—é—Ç –∫ –Ω–µ–º—É –¥–æ—Å—Ç—É–ø.

---

### üî∏ `yield`:

`yield` ‚Äî —ç—Ç–æ **–±–µ–∑—ã–º—è–Ω–Ω—ã–π –≤—ã–∑–æ–≤** –±–ª–æ–∫–∞, –ø–µ—Ä–µ–¥–∞–Ω–Ω–æ–≥–æ –≤ –º–µ—Ç–æ–¥. –ë–ª–æ–∫ –Ω–µ –ø–æ–ª—É—á–∞–µ—Ç –∏–º–µ–Ω–∏ –ø–æ —É–º–æ–ª—á–∞–Ω–∏—é:

```ruby
def greet
  yield if block_given?
end

greet { puts "Yo" }
```

‚Üí –£ –Ω–∞—Å **–Ω–µ—Ç –ø–µ—Ä–µ–º–µ–Ω–Ω–æ–π**, —Å—Å—ã–ª–∞—é—â–µ–π—Å—è –Ω–∞ —ç—Ç–æ—Ç –±–ª–æ–∫.
–ï—Å–ª–∏ —Ö–æ—á–µ—à—å **–¥–∞—Ç—å –∏–º—è** ‚Äî –Ω–∞–¥–æ —è–≤–Ω–æ –∏—Å–ø–æ–ª—å–∑–æ–≤–∞—Ç—å `&block`:

```ruby
def greet(&block)
  block.call
end
```

---

### üí° –†–µ–∑—é–º–µ:

* **lambda** –∏ **proc**: –æ–±—ä–µ–∫—Ç—ã, –∫–æ—Ç–æ—Ä—ã–µ —Ç—ã –º–æ–∂–µ—à—å **–Ω–∞–∑–≤–∞—Ç—å –∏ –ø–µ—Ä–µ–¥–∞–≤–∞—Ç—å**
* **yield**: "–≤—Å—Ç—Ä–æ–µ–Ω–Ω—ã–π" –≤—ã–∑–æ–≤ –∞–Ω–æ–Ω–∏–º–Ω–æ–≥–æ –±–ª–æ–∫–∞, –±–µ–∑ –¥–æ—Å—Ç—É–ø–∞ –∫ –æ–±—ä–µ–∫—Ç—É —ç—Ç–æ–≥–æ –±–ª–æ–∫–∞

---

üîö –í—ã–≤–æ–¥:
`lambda` –∏ `proc` ‚Äî –±—Ä–∞—Ç—å—è —Å —Ä–∞–∑–Ω—ã–º –≤–æ—Å–ø–∏—Ç–∞–Ω–∏–µ–º. –ê `yield` ‚Äî —ç—Ç–æ –ø—Ä–æ—Å—Ç–æ –±–µ–∑—ã–º—è–Ω–Ω—ã–π –≥–æ—Å—Ç—å. –†–∞–∑–Ω–∏—Ü–∞ –∫–∞–∂–µ—Ç—Å—è –º–µ–ª–∫–æ–π, –ø–æ–∫–∞ `return` –Ω–µ —É—Å—Ç—Ä–æ–∏—Ç —Å–∞–±–æ—Ç–∞–∂ —Ç–≤–æ–µ–º—É –º–µ—Ç–æ–¥—É.
