---
layout: post
subtitle: <div id="terminal"></div>
title:  "–°–ø–µ—Ü–∏–∞–ª—å–Ω—ã–µ –º–µ—Ç–æ–¥—ã –≤ Ruby: –∫–∞–∫ –ø–æ–¥—Å–ª—É—à–∞—Ç—å —Å–≤–æ–∏ –∫–ª–∞—Å—Å—ã"
date:   2025-04-27 10:00:00 +0300
rate: 4
tags: Ruby,–º–µ—Ç–∞–ø—Ä–æ–≥—Ä–∞–º–º–∏—Ä–æ–≤–∞–Ω–∏–µ,—Ä–µ—Ñ–ª–µ–∫—Å–∏—è,–º–µ—Ç–æ–¥—ã
version: 3.2.2
categories:
  - ruby
hero_image: /images/posts/21.jpg
hero_darken: true
toc: true
menubar_toc: true
---
Ruby ‚Äî —è–∑—ã–∫ —Å –æ—Ç–∫—Ä—ã—Ç—ã–º–∏ –Ω–∞—Å—Ç—Ä–æ–π–∫–∞–º–∏. –•–æ—Ç–∏—Ç–µ –∑–Ω–∞—Ç—å, –∫–æ–≥–¥–∞ –≤ –∫–ª–∞—Å—Å–µ –ø–æ—è–≤–ª—è–µ—Ç—Å—è –Ω–æ–≤—ã–π –º–µ—Ç–æ–¥? –ò–ª–∏ –æ—Ç—Å–ª–µ–¥–∏—Ç—å —É–¥–∞–ª–µ–Ω–∏–µ —Å–∏–Ω–≥–ª—Ç–æ–Ω-–º–µ—Ç–æ–¥–∞? –°–ø–µ—Ü–∏–∞–ª—å–Ω—ã–µ –º–µ—Ç–æ–¥—ã-—Ö—É–∫–∏ –¥–∞—é—Ç –≤–∞–º —Ç–∞–∫—É—é –≤–æ–∑–º–æ–∂–Ω–æ—Å—Ç—å. –†–∞–∑–±–µ—Ä—ë–º—Å—è, –∫–∞–∫ –∏–º–∏ –ø–æ–ª—å–∑–æ–≤–∞—Ç—å—Å—è –±–µ–∑ –≤—Ä–µ–¥–∞ –¥–ª—è –∫–æ–¥–æ–≤–æ–π –±–∞–∑—ã.

---
–í—ã —Ç–æ–ª—å–∫–æ —á—Ç–æ –¥–æ–±–∞–≤–∏–ª–∏ `def calculate_tax` –≤ –∫–ª–∞—Å—Å `Invoice`‚Ä¶  
–ê —Å–∏—Å—Ç–µ–º–∞ –∞–Ω–∞–ª–∏—Ç–∏–∫–∏ —É–∂–µ –æ–± —ç—Ç–æ–º –∑–Ω–∞–µ—Ç. –ú–∞–≥–∏—è? –ù–µ—Ç, –ø—Ä–æ—Å—Ç–æ `method_added`.

---

## üß† –¢–µ–æ—Ä–∏—è: —á—Ç–æ –∑–∞ —Å–ø–µ—Ü–∏–∞–ª—å–Ω—ã–µ –º–µ—Ç–æ–¥—ã?

–≠—Ç–æ **—Ö—É–∫–∏**, –∫–æ—Ç–æ—Ä—ã–µ Ruby –≤—ã–∑—ã–≤–∞–µ—Ç –∞–≤—Ç–æ–º–∞—Ç–∏—á–µ—Å–∫–∏ –ø—Ä–∏ –∏–∑–º–µ–Ω–µ–Ω–∏—è—Ö –≤ –∫–ª–∞—Å—Å–µ –∏–ª–∏ –æ–±—ä–µ–∫—Ç–µ. –û–Ω–∏ –ø–æ–∑–≤–æ–ª—è—é—Ç:

* –õ–æ–≥–∏—Ä–æ–≤–∞—Ç—å –∏–∑–º–µ–Ω–µ–Ω–∏—è –º–µ—Ç–æ–¥–æ–≤
* –í–∞–ª–∏–¥–∏—Ä–æ–≤–∞—Ç—å –Ω–æ–≤—ã–µ –º–µ—Ç–æ–¥—ã
* –ê–≤—Ç–æ–º–∞—Ç–∏—á–µ—Å–∫–∏ –æ–±–Ω–æ–≤–ª—è—Ç—å –∫–µ—à–∏
* –†–µ–∞–≥–∏—Ä–æ–≤–∞—Ç—å –Ω–∞ —É–¥–∞–ª–µ–Ω–∏–µ —Ñ—É–Ω–∫—Ü–∏–æ–Ω–∞–ª—å–Ω–æ—Å—Ç–∏

–†–∞–±–æ—Ç–∞—é—Ç –∫–∞–∫ **—Å–∏–≥–Ω–∞–ª—ã —Å–≤–µ—Ç–æ—Ñ–æ—Ä–∞** –≤ –º–µ—Ç–∞–ø—Ä–æ–≥—Ä–∞–º–º–∏—Ä–æ–≤–∞–Ω–∏–∏ ‚Äî –ø—Ä–µ–¥—É–ø—Ä–µ–∂–¥–∞—é—Ç –æ —Å–æ–±—ã—Ç–∏—è—Ö.

---

## üîç –†–∞–∑–±–∏—Ä–∞–µ–º –º–µ—Ç–æ–¥—ã

### 1. `method_added(name)`
–°—Ä–∞–±–∞—Ç—ã–≤–∞–µ—Ç –ø—Ä–∏ –¥–æ–±–∞–≤–ª–µ–Ω–∏–∏ **–æ–±—ã—á–Ω–æ–≥–æ –º–µ—Ç–æ–¥–∞** –≤ –∫–ª–∞—Å—Å.

```ruby
class Logger
  def self.method_added(method_name)
    puts "–î–æ–±–∞–≤–ª–µ–Ω –º–µ—Ç–æ–¥: #{method_name}"
    super
  end

  def log(message) = puts(message)
end
# => "–î–æ–±–∞–≤–ª–µ–Ω –º–µ—Ç–æ–¥: log"
```

**–ì–¥–µ –∏—Å–ø–æ–ª—å–∑–æ–≤–∞—Ç—å:**  
- –ê–≤—Ç–æ–º–∞—Ç–∏—á–µ—Å–∫–∞—è –¥–æ–∫—É–º–µ–Ω—Ç–∞—Ü–∏—è  
- –í–∞–ª–∏–¥–∞—Ü–∏—è –∏–º–µ–Ω –º–µ—Ç–æ–¥–æ–≤ (–Ω–∞–ø—Ä–∏–º–µ—Ä, –∑–∞–ø—Ä–µ—Ç `snake_case`)

---

### 2. `singleton_method_added(name)`
–û—Ç—Å–ª–µ–∂–∏–≤–∞–µ—Ç –¥–æ–±–∞–≤–ª–µ–Ω–∏–µ **–º–µ—Ç–æ–¥–∞ –∫ –∫–æ–Ω–∫—Ä–µ—Ç–Ω–æ–º—É –æ–±—ä–µ–∫—Ç—É**.

```ruby
obj = Object.new

def obj.singleton_method_added(name)
  puts "–°–∏–Ω–≥–ª—Ç–æ–Ω-–º–µ—Ç–æ–¥ #{name} –¥–æ–±–∞–≤–ª–µ–Ω!"
end

def obj.hello = "world"
# => "–°–∏–Ω–≥–ª—Ç–æ–Ω-–º–µ—Ç–æ–¥ hello –¥–æ–±–∞–≤–ª–µ–Ω!"
```

**–ì–¥–µ –∏—Å–ø–æ–ª—å–∑–æ–≤–∞—Ç—å:**  
- –û—Ç–ª–∞–¥–∫–∞ –¥–∏–Ω–∞–º–∏—á–µ—Å–∫–∏—Ö –º–µ—Ç–æ–¥–æ–≤ –≤ REPL  
- –ü–ª–∞–≥–∏–Ω—ã –¥–ª—è –æ–±—ä–µ–∫—Ç–æ–≤ (–Ω–∞–ø—Ä–∏–º–µ—Ä, `user.extend(Admin)`)

---

### 3. `method_removed(name)` –∏ `method_undefined(name)`
–†–∞–∑–Ω–∏—Ü–∞ —Ç–æ–Ω–∫–∞—è, –Ω–æ –≤–∞–∂–Ω–∞—è:

| –ú–µ—Ç–æ–¥                | –ö–æ–≥–¥–∞ —Å—Ä–∞–±–∞—Ç—ã–≤–∞–µ—Ç               |
|----------------------|---------------------------------|
| `method_removed`     | –ü—Ä–∏ `remove_method`             |
| `method_undefined`   | –ü—Ä–∏ `undef_method`              |

```ruby
class CleanupWatcher
  def self.method_undefined(name)
    puts "–ú–µ—Ç–æ–¥ #{name} —Å—Ç–∞–ª undefined ‚Äî —ç—Ç–æ –Ω–∞–≤—Å–µ–≥–¥–∞!"
  end
end
```

**–ì–¥–µ –∏—Å–ø–æ–ª—å–∑–æ–≤–∞—Ç—å:**  
- –ë–µ–∑–æ–ø–∞—Å–Ω–æ–µ —É–¥–∞–ª–µ–Ω–∏–µ –º–µ—Ç–æ–¥–æ–≤ –≤ –ø–ª–∞–≥–∏–Ω–∞—Ö  
- –ó–∞–ø—Ä–µ—Ç –Ω–∞ —É–¥–∞–ª–µ–Ω–∏–µ –∫—Ä–∏—Ç–∏—á–Ω—ã—Ö –º–µ—Ç–æ–¥–æ–≤

---

### 4. `singleton_method_removed` –∏ `singleton_method_undefined`
–ê–Ω–∞–ª–æ–≥–∏—á–Ω–æ, –Ω–æ –¥–ª—è —Å–∏–Ω–≥–ª—Ç–æ–Ω-–º–µ—Ç–æ–¥–æ–≤:

```ruby
admin = User.find(1)

def admin.singleton_method_removed(name)
  raise "–ù–µ–ª—å–∑—è —É–¥–∞–ª—è—Ç—å –º–µ—Ç–æ–¥—ã –∞–¥–º–∏–Ω–∞!" if name == :grant_access
end
```

---

## üß™ –ü—Ä–∞–∫—Ç–∏–∫–∞: –∫–µ–π—Å—ã –∏–∑ –∂–∏–∑–Ω–∏

### –ö–µ–π—Å 1: –í–∞–ª–∏–¥–∞—Ü–∏—è API-–º–µ—Ç–æ–¥–æ–≤

```ruby
class ApiEndpoint
  def self.method_added(name)
    raise "–ò—Å–ø–æ–ª—å–∑—É–π snake_case!" unless name.match?(/^[a-z_]+$/)
    super
  end

  def get_users = # ...
end
# => –û—à–∏–±–∫–∞: –ò—Å–ø–æ–ª—å–∑—É–π snake_case!
```

### –ö–µ–π—Å 2: –ê–≤—Ç–æ–º–∞—Ç–∏—á–µ—Å–∫–∏–π –∫–µ—à

```ruby
class Product
  @cache = {}

  def self.method_added(name)
    @cache.clear if name.match?(/^calculate_/)
    super
  end
end
```

---

## üí£ –ê–Ω—Ç–∏–ø–∞—Ç—Ç–µ—Ä–Ω—ã

1. **–†–µ–∫—É—Ä—Å–∏—è**: –≤—ã–∑–æ–≤ `define_method` –≤–Ω—É—Ç—Ä–∏ `method_added`  
   ‚Üí –ë–µ—Å–∫–æ–Ω–µ—á–Ω—ã–π —Ü–∏–∫–ª.

2. **–¢—è–∂—ë–ª–∞—è –ª–æ–≥–∏–∫–∞**:  
   ```ruby
   def self.method_added(name)
     SaveMethodToDatabase.call(name) # 200ms –∑–∞ –∫–∞–∂–¥—ã–π –º–µ—Ç–æ–¥!
   end
   ```

3. **–ò–≥–Ω–æ—Ä–∏—Ä–æ–≤–∞–Ω–∏–µ `super`**:  
   ```ruby
   def singleton_method_added(name)
     # –ó–∞–±—ã–ª–∏ super ‚Üí –ª–æ–º–∞–µ–º —Ü–µ–ø–æ—á–∫—É –≤—ã–∑–æ–≤–æ–≤
   end
   ```

---

## üé§ –ß—Ç–æ —Å–∫–∞–∑–∞—Ç—å –Ω–∞ —Å–æ–±–µ—Å–µ–¥–æ–≤–∞–Ω–∏–∏

> ‚Äî –ö–∞–∫ –º–æ–∂–Ω–æ –æ—Ç—Å–ª–µ–¥–∏—Ç—å –¥–æ–±–∞–≤–ª–µ–Ω–∏–µ –º–µ—Ç–æ–¥–∞ –≤ —Ä–∞–Ω—Ç–∞–π–º–µ?

‚Äî –í Ruby –¥–ª—è —ç—Ç–æ–≥–æ –µ—Å—Ç—å —Å–ø–µ—Ü–∏–∞–ª—å–Ω—ã–µ —Ö—É–∫–∏ –≤—Ä–æ–¥–µ `method_added`. –û–Ω–∏ –ø–æ–∑–≤–æ–ª—è—é—Ç –ø–µ—Ä–µ—Ö–≤–∞—Ç—ã–≤–∞—Ç—å –∏–∑–º–µ–Ω–µ–Ω–∏—è –∫–ª–∞—Å—Å–∞, –Ω–æ —Ç—Ä–µ–±—É—é—Ç –∞–∫–∫—É—Ä–∞—Ç–Ω–æ–≥–æ –∏—Å–ø–æ–ª—å–∑–æ–≤–∞–Ω–∏—è, —á—Ç–æ–±—ã –Ω–µ –Ω–∞—Ä—É—à–∏—Ç—å —Ä–∞–±–æ—Ç—É —Ü–µ–ø–æ—á–∫–∏ –Ω–∞—Å–ª–µ–¥–æ–≤–∞–Ω–∏—è.

---

## üßæ –í—ã–≤–æ–¥

–°–ø–µ—Ü–∏–∞–ª—å–Ω—ã–µ –º–µ—Ç–æ–¥—ã ‚Äî —ç—Ç–æ **—Å—Ç–µ—Ç–æ—Å–∫–æ–ø –¥–ª—è –≤–∞—à–∏—Ö –∫–ª–∞—Å—Å–æ–≤**.  
–ò—Å–ø–æ–ª—å–∑—É–π—Ç–µ –∏—Ö –¥–ª—è:

‚úÖ –û—Ç–ª–∞–¥–∫–∏ –º–µ—Ç–∞–ø—Ä–æ–≥—Ä–∞–º–º–∏—Ä–æ–≤–∞–Ω–∏—è  
‚úÖ –ê–≤—Ç–æ–º–∞—Ç–∏–∑–∞—Ü–∏–∏ –¥–æ–∫—É–º–µ–Ω—Ç–∏—Ä–æ–≤–∞–Ω–∏—è  
‚úÖ –ó–∞—â–∏—Ç—ã –∫—Ä–∏—Ç–∏—á–Ω—ã—Ö –º–µ—Ç–æ–¥–æ–≤  

–ù–æ –ø–æ–º–Ω–∏—Ç–µ: –∫–∞–∫ –∏ —Å –ª—é–±—ã–º–∏ —Ö—É–∫–∞–º–∏, **—á–µ–º —Ç–∏—à–µ ‚Äî —Ç–µ–º –ª—É—á—à–µ**. –ù–µ –ø—Ä–µ–≤—Ä–∞—â–∞–π—Ç–µ –∏—Ö –≤ —Å–≤–∞–ª–∫—É –±–∏–∑–Ω–µ—Å-–ª–æ–≥–∏–∫–∏.
