---
layout: post
subtitle: <div id="terminal"></div>
title:  "pluck, calculations –∏ –∫–∞—Å—Ç–æ–º–Ω—ã–π select ‚Äî –±—ã—Å—Ç—Ä–æ, –Ω–æ –∞–∫–∫—É—Ä–∞—Ç–Ω–æ"
date:   2024-12-01 11:15:00 +0300
rate: 3
tags: Ruby,Rails,PostgreSQL,pluck,count,select
version: A9X
categories:
  - orm
  - rails
toc: true
menubar_toc: true
hero_image: /images/rails.jpg
hero_darken: true
---
Ruby –ø—Ä–µ–¥–ª–∞–≥–∞–µ—Ç –º–æ—â–Ω—ã–µ –∏–Ω—Å—Ç—Ä—É–º–µ–Ω—Ç—ã –¥–ª—è —Ä–∞–±–æ—Ç—ã —Å –±–∞–∑–æ–π –¥–∞–Ω–Ω—ã—Ö, —Ç–∞–∫–∏–µ –∫–∞–∫ `pluck`, `count` –∏ `select`, –∫–æ—Ç–æ—Ä—ã–µ –ø–æ–∑–≤–æ–ª—è—é—Ç –æ–ø—Ç–∏–º–∏–∑–∏—Ä–æ–≤–∞—Ç—å –∑–∞–ø—Ä–æ—Å—ã –∏ —Å–Ω–∏–∑–∏—Ç—å –Ω–∞–≥—Ä—É–∑–∫—É –Ω–∞ –ø—Ä–∏–ª–æ–∂–µ–Ω–∏–µ. –û–¥–Ω–∞–∫–æ –≤–∞–∂–Ω–æ –ø–æ–Ω–∏–º–∞—Ç—å –∏—Ö –æ—Å–æ–±–µ–Ω–Ω–æ—Å—Ç–∏, —á—Ç–æ–±—ã –∏–∑–±–µ–∂–∞—Ç—å –Ω–µ–æ–∂–∏–¥–∞–Ω–Ω–æ–≥–æ –ø–æ–≤–µ–¥–µ–Ω–∏—è –∏ —É—Ç–µ—á–µ–∫ –ø–∞–º—è—Ç–∏. –í —ç—Ç–æ–π —Å—Ç–∞—Ç—å–µ —Ä–∞–∑–±–µ—Ä—ë–º—Å—è, –∫–æ–≥–¥–∞ –∏ –∫–∞–∫ –ø—Ä–∞–≤–∏–ª—å–Ω–æ –∏—Å–ø–æ–ª—å–∑–æ–≤–∞—Ç—å —ç—Ç–∏ –º–µ—Ç–æ–¥—ã –≤ Rails-–ø—Ä–∏–ª–æ–∂–µ–Ω–∏—è—Ö —Å PostgreSQL.

---
–ö–æ–≥–¥–∞ —Ç–µ–±–µ –Ω–µ –Ω—É–∂–Ω—ã –º–æ–¥–µ–ª–∏ ‚Äî `pluck`, `count`, `sum`, `select(...)` —Å –∞–ª–∏–∞—Å–∞–º–∏ –º–æ–≥—É—Ç —Å—ç–∫–æ–Ω–æ–º–∏—Ç—å —Ä–µ—Å—É—Ä—Å—ã. –ù–æ —Å –Ω–∏–º–∏ —Ç–æ–∂–µ –µ—Å—Ç—å –ø–æ–¥–≤–æ–¥–Ω—ã–µ –∫–∞–º–Ω–∏.

## üçá pluck

```ruby
User.where(active: true).pluck(:email)
# => ["user1@example.com", "user2@example.com", ...]
````

–í–æ–∑–≤—Ä–∞—â–∞–µ—Ç **–º–∞—Å—Å–∏–≤ –∑–Ω–∞—á–µ–Ω–∏–π**, –±–µ–∑ –º–æ–¥–µ–ª–µ–π. –ë—ã—Å—Ç—Ä–æ, –ø–æ—Ç–æ–º—É —á—Ç–æ Rails –Ω–µ –∏–Ω–∏—Ü–∏–∞–ª–∏–∑–∏—Ä—É–µ—Ç –æ–±—ä–µ–∫—Ç—ã.

‚ö†Ô∏è –ù–µ –∏—Å–ø–æ–ª—å–∑—É–π `.pluck(:id)` –≤ `where(... IN (...))` ‚Äî —ç—Ç–æ –ø—Ä–∏–≤–µ–¥—ë—Ç –∫ –∑–∞–≥—Ä—É–∑–∫–µ –≤—Å–µ—Ö ID –≤ –ø–∞–º—è—Ç—å.

---

## üßÆ calculations

```ruby
User.count
User.sum(:age)
User.average(:salary)
```

–í—ã–ø–æ–ª–Ω—è—é—Ç—Å—è **–Ω–∞ SQL —É—Ä–æ–≤–Ω–µ**. –û—Ç–ª–∏—á–Ω–æ –º–∞—Å—à—Ç–∞–±–∏—Ä—É—é—Ç—Å—è.

> `average` –≤–æ–∑–≤—Ä–∞—â–∞–µ—Ç `BigDecimal`, –Ω–µ `Float`.

---

## üß† select —Å –∞–ª–∏–∞—Å–∞–º–∏

```ruby
User.select("users.id, COUNT(posts.id) AS posts_count")
    .joins(:posts)
    .group("users.id")
```

–ú–æ–∂–Ω–æ –∏—Å–ø–æ–ª—å–∑–æ–≤–∞—Ç—å `user.posts_count`, –Ω–æ:

* –¢–æ–ª—å–∫–æ –µ—Å–ª–∏ —Ç—ã —è–≤–Ω–æ –≤—ã–±—Ä–∞–ª —ç—Ç–æ—Ç –∞–ª–∏–∞—Å
* –≠—Ç–æ **–Ω–µ –±—É–¥–µ—Ç –¥–æ—Å—Ç—É–ø–Ω–æ**, –µ—Å–ª–∏ —Ç—ã –ø–æ—Ç–æ–º –ø–µ—Ä–µ—Å–æ–∑–¥–∞—à—å –æ–±—ä–µ–∫—Ç

---

## üòµ select –ª–æ–º–∞–µ—Ç ActiveRecord

```ruby
User.select("id, COUNT(*) as total").first.name
# => nil ‚Äî –ø–æ—Ç–æ–º—É —á—Ç–æ `name` –Ω–µ –∑–∞–≥—Ä—É–∂–µ–Ω
```

–†–µ—à–µ–Ω–∏–µ: –ª–∏–±–æ –≤—ã–±–∏—Ä–∞—Ç—å –≤—Å–µ –Ω—É–∂–Ω—ã–µ –ø–æ–ª—è, –ª–∏–±–æ –∏—Å–ø–æ–ª—å–∑–æ–≤–∞—Ç—å `pluck`.

---

## üìå –°—Ä–∞–≤–Ω–µ–Ω–∏–µ

| –ú–µ—Ç–æ–¥                            | –í–æ–∑–≤—Ä–∞—â–∞–µ—Ç            | –ö–æ–≥–¥–∞ –∏—Å–ø–æ–ª—å–∑–æ–≤–∞—Ç—å               |
| -------------------------------- | --------------------- | -------------------------------- |
| `pluck(:email)`                  | –º–∞—Å—Å–∏–≤ –∑–Ω–∞—á–µ–Ω–∏–π       | –î–ª—è –ø—Ä–æ—Å—Ç—ã—Ö —Å–ø–∏—Å–∫–æ–≤              |
| `count`, `sum`                   | —á–∏—Å–ª–æ                 | –î–ª—è –æ—Ç—á—ë—Ç–æ–≤ –∏ —Å—Ç–∞—Ç–∏—Å—Ç–∏–∫–∏         |
| `select(...)`                    | –æ–±—ä–µ–∫—Ç—ã —Å –ø–æ–ª—è–º–∏      | –î–ª—è —Å–ª–æ–∂–Ω—ã—Ö SQL –∏ –∞–ª–∏–∞—Å–æ–≤        |
| `select("...")` –±–µ–∑ –Ω—É–∂–Ω—ã—Ö –ø–æ–ª–µ–π | –æ–±—ä–µ–∫—Ç —Å `nil` –ø–æ–ª—è–º–∏ | –ù–µ–ª—å–∑—è –∑–∞–±—ã–≤–∞—Ç—å, —á—Ç–æ –Ω–µ –≤–µ—Ä–Ω—ë—Ç—Å—è |
