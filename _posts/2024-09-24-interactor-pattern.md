---
layout: post
subtitle: <div id="terminal"></div>
title:  "Interactor –≤ Ruby: `.call!`, –∫–æ–Ω—Ç–µ–∫—Å—Ç –∏ –≥—Ä—è–∑–Ω—ã–µ —Ä—É–∫–∏"
date:   2024-09-24 12:00:00 +0300
rate: 3
tags: Interactor,Ruby,Rails,–±–∏–∑–Ω–µ—Å-–ª–æ–≥–∏–∫–∞,Service-–æ–±—ä–µ–∫—Ç—ã,–æ—à–∏–±–∫–∏
version: 3.2.2
categories:
  - pattern
  - ruby
hero_image: /images/posts/32.jpg
hero_darken: true
toc: true
menubar_toc: true
---
Interactor ‚Äî —ç—Ç–æ –º–æ—â–Ω—ã–π –∏–Ω—Å—Ç—Ä—É–º–µ–Ω—Ç –¥–ª—è –æ—Ä–≥–∞–Ω–∏–∑–∞—Ü–∏–∏ –±–∏–∑–Ω–µ—Å-–ª–æ–≥–∏–∫–∏ –≤ Rails-–ø—Ä–∏–ª–æ–∂–µ–Ω–∏—è—Ö, –∫–æ—Ç–æ—Ä—ã–π –ø–æ–º–æ–≥–∞–µ—Ç —Å—Ç—Ä—É–∫—Ç—É—Ä–∏—Ä–æ–≤–∞—Ç—å —Å–ª–æ–∂–Ω—ã–µ –æ–ø–µ—Ä–∞—Ü–∏–∏ –≤ —Ü–µ–ø–æ—á–∫–∏ —à–∞–≥–æ–≤ —Å –ø–æ–¥–¥–µ—Ä–∂–∫–æ–π –æ—Ç–∫–∞—Ç–∞ –∏ –≤–∞–ª–∏–¥–∞—Ü–∏–∏. –û–Ω –æ—Å–æ–±–µ–Ω–Ω–æ –ø–æ–ª–µ–∑–µ–Ω, –∫–æ–≥–¥–∞ —Å—Ç–∞–Ω–¥–∞—Ä—Ç–Ω—ã–µ Service-–æ–±—ä–µ–∫—Ç—ã —É–∂–µ –Ω–µ —Å–ø—Ä–∞–≤–ª—è—é—Ç—Å—è —Å —É–ø—Ä–∞–≤–ª–µ–Ω–∏–µ–º –ø–æ—Ç–æ–∫–æ–º –≤—ã–ø–æ–ª–Ω–µ–Ω–∏—è –∏ –æ–±—Ä–∞–±–æ—Ç–∫–æ–π –æ—à–∏–±–æ–∫. –í —ç—Ç–æ–π —Å—Ç–∞—Ç—å–µ —Ä–∞–∑–±–µ—Ä—ë–º, –∫–∞–∫ —ç—Ñ—Ñ–µ–∫—Ç–∏–≤–Ω–æ –∏—Å–ø–æ–ª—å–∑–æ–≤–∞—Ç—å Interactor –¥–ª—è —á–∏—Å—Ç–æ–≥–æ –∏ –ø—Ä–µ–¥—Å–∫–∞–∑—É–µ–º–æ–≥–æ –∫–æ–¥–∞.

----
–í—ã —É–∂–µ –∏—Å–ø–æ–ª—å–∑—É–µ—Ç–µ `.call`, –∏ —É –≤–∞—Å –¥–µ—Å—è—Ç–æ–∫ `Service`.  
–ù–æ –≤ –æ–¥–Ω–æ–º ‚Äî –æ—à–∏–±–∫–∞ –Ω–∞ —à–∞–≥–µ 3, –≤ –¥—Ä—É–≥–æ–º —Ö–æ—á–µ—Ç—Å—è –æ—Ç–º–µ–Ω–∏—Ç—å —à–∞–≥ 2, –∞ —Ç—Ä–µ—Ç–∏–π ‚Äî –≤–æ–∑–≤—Ä–∞—â–∞–µ—Ç `nil`, –Ω–æ –Ω–∏–∫—Ç–æ –Ω–µ –ø–æ–Ω–∏–º–∞–µ—Ç, –ø–æ—á–µ–º—É.

–ü–æ—Ä–∞ –∑–Ω–∞–∫–æ–º–∏—Ç—å—Å—è —Å **Interactor**.

---

## üß† –¢–µ–æ—Ä–∏—è

**Interactor** ‚Äî —ç—Ç–æ –ø–∞—Ç—Ç–µ—Ä–Ω (–∏ gem), –∫–æ—Ç–æ—Ä—ã–π –æ–±–æ—Ä–∞—á–∏–≤–∞–µ—Ç –≤—ã–ø–æ–ª–Ω–µ–Ω–∏–µ –±–∏–∑–Ω–µ—Å-–æ–ø–µ—Ä–∞—Ü–∏–∏ –≤ **–∫–æ–Ω—Ç–µ–∫—Å—Ç**, –ø–æ–¥–¥–µ—Ä–∂–∏–≤–∞–µ—Ç **—Ü–µ–ø–æ—á–∫–∏**, **rollback**, –∏ **–≤–∞–ª–∏–¥–∏—Ä—É–µ—Ç** –≤—Ö–æ–¥–Ω—ã–µ –¥–∞–Ω–Ω—ã–µ.

–ü—Ä–∏–¥—É–º–∞–ª –µ–≥–æ –∫–æ–ª–ª–µ–∫—Ç–∏–≤–æ–º `collectiveidea`, –∏ –æ–Ω –ø—Ä–µ–∫—Ä–∞—Å–Ω–æ –ø—Ä–∏–∂–∏–ª—Å—è –≤ Rails-–ø—Ä–æ–µ–∫—Ç–∞—Ö, –≥–¥–µ –Ω—É–∂–Ω–æ —á—É—Ç—å –±–æ–ª—å—à–µ, —á–µ–º –ø—Ä–æ—Å—Ç–æ `.call`.

---

## ‚öôÔ∏è –ü—Ä–∏–º–µ—Ä

```ruby
class CreateUser
  include Interactor

  def call
    context.user = User.create!(context.params)
    SendWelcomeEmail.call(context.user)
  rescue => e
    context.fail!(error: e.message)
  end
end
````

–í—ã–∑–æ–≤:

```ruby
result = CreateUser.call(params: {email: "user@example.com"})

if result.success?
  puts "Created: #{result.user.id}"
else
  puts "–û—à–∏–±–∫–∞: #{result.error}"
end
```

---

## üîÅ –° —Ü–µ–ø–æ—á–∫–∞–º–∏

```ruby
class SignupFlow
  include Interactor::Organizer

  organize CreateUser, CreateWallet, NotifyCrm
end
```

–ü–æ—è–≤–ª—è–µ—Ç—Å—è —É–ø—Ä–∞–≤–ª–µ–Ω–∏–µ: –µ—Å–ª–∏ –æ–¥–∏–Ω interactor –≤—ã–∑–≤–∞–ª `fail!`, –≤—Å–µ –ø–æ—Å–ª–µ–¥—É—é—â–∏–µ —à–∞–≥–∏ –æ—Ç–º–µ–Ω—è—é—Ç—Å—è.

---

## ‚õë –ö–æ–≥–¥–∞ –∏—Å–ø–æ–ª—å–∑–æ–≤–∞—Ç—å?

* –ù—É–∂–Ω–æ **—Å–æ–±—Ä–∞—Ç—å –ø–æ—Å–ª–µ–¥–æ–≤–∞—Ç–µ–ª—å–Ω–æ—Å—Ç—å –¥–µ–π—Å—Ç–≤–∏–π** –∏ –∫–æ–Ω—Ç—Ä–æ–ª–∏—Ä–æ–≤–∞—Ç—å –ø–æ—Ç–æ–∫
* –í—ã —Ö–æ—Ç–∏—Ç–µ **rollback –ø–æ —Ö–æ–¥—É –≤—ã–ø–æ–ª–Ω–µ–Ω–∏—è**
* –í–∞–∂–Ω–æ –≤–æ–∑–≤—Ä–∞—â–∞—Ç—å **–∫–æ–Ω—Ç–µ–∫—Å—Ç** —Å —Ä–µ–∑—É–ª—å—Ç–∞—Ç–æ–º –∏ –æ—à–∏–±–∫–∞–º–∏
* –ö–æ–º–∞–Ω–¥—ã —Å—Ç–∞–ª–∏ **—Å–ª–∏—à–∫–æ–º —Ö—Ä—É–ø–∫–∏–º–∏** (–æ—à–∏–±–∫–∞ –≤ –æ–¥–Ω–æ–º ‚Äî —Ä—É—à–∏—Ç –≤—Å—ë –±–µ–∑ –ª–æ–≥–æ–≤)

---

## üß± –ü—Ä–∏–º–µ—Ä —Å rollback

```ruby
class ChargeCard
  include Interactor

  def call
    Payment.charge!(context.user, context.amount)
  end

  def rollback
    Payment.refund(context.user, context.amount)
  end
end
```

–ï—Å–ª–∏ —à–∞–≥ –ø–æ—Å–ª–µ —ç—Ç–æ–≥–æ –∑–∞–≤–µ—Ä—à–∏—Ç—Å—è —á–µ—Ä–µ–∑ `fail!`, –ø—Ä–æ–∏–∑–æ–π–¥—ë—Ç –æ—Ç–∫–∞—Ç.

---

## ü§Ø –ö–æ–≥–¥–∞ interactor ‚Äî –∑–ª–æ

| –°–ª—É—á–∞–π                                               | –ü–æ—á–µ–º—É –ø–ª–æ—Ö–æ                                              |
| ---------------------------------------------------- | --------------------------------------------------------- |
| –£ –∫–∞–∂–¥–æ–≥–æ interactor ‚Äî –ø–æ 1 —Å—Ç—Ä–æ–∫–µ                   | –ü–µ—Ä–µ—É—Å–ª–æ–∂–Ω–µ–Ω–∏–µ. –ú–æ–∂–Ω–æ –±—ã–ª–æ –æ–±–æ–π—Ç–∏—Å—å `Command`.            |
| –í—Å—è –ª–æ–≥–∏–∫–∞ –≤ rollback                                | –ü—Ä–∏–∑–Ω–∞–∫ —Ö—Ä—É–ø–∫–æ—Å—Ç–∏. –£–ø—Ä–æ—â–∞–π—Ç–µ —à–∞–≥–∏, –∞ –Ω–µ –∫–æ–º–ø–µ–Ω—Å–∏—Ä—É–π—Ç–µ –∏—Ö. |
| –ò—Å–ø–æ–ª—å–∑—É–µ—Ç–µ `Interactor::Organizer` –¥–ª—è –≤—Å–µ–≥–æ –ø–æ–¥—Ä—è–¥ | –ó–∞–≤–∏—Å–∏–º–æ—Å—Ç—å –æ—Ç —Ñ—Ä–µ–π–º–≤–æ—Ä–∫–∞, –Ω–µ–ø—Ä–µ–¥—Å–∫–∞–∑—É–µ–º—ã–π —Å—Ç–µ–∫ –≤—ã–∑–æ–≤–æ–≤   |

---

## üìé –°–æ–≤–µ—Ç—ã –∏–∑ –ø—Ä–∞–∫—Ç–∏–∫–∏

* –ö–æ–Ω—Ç–µ–∫—Å—Ç –ª—É—á—à–µ –¥–µ–ª–∞—Ç—å **—è–≤–Ω—ã–º**: `context.user`, `context.params[:x]`, `context.error`
* **–ù–µ –¥–µ–ª–∞–π—Ç–µ interactor —É–Ω–∏–≤–µ—Ä—Å–∞–ª—å–Ω—ã–º** ‚Äî –µ—Å–ª–∏ –æ–Ω `DoEverything`, —É –≤–∞—Å –Ω–µ interactor, –∞ intergalactic controller
* –ü–∏—à–∏—Ç–µ unit-—Ç–µ—Å—Ç—ã –Ω–∞ –∫–∞–∂–¥—ã–π `.call`, –∞ –∏–Ω—Ç–µ–≥—Ä–∞—Ü–∏–æ–Ω–Ω—ã–µ ‚Äî –Ω–∞ `Organizer`

---

## üé§ –ß—Ç–æ —Å–∫–∞–∑–∞—Ç—å –Ω–∞ —Å–æ–±–µ—Å–µ

> ‚Äî –ß–µ–º Interactor –æ—Ç–ª–∏—á–∞–µ—Ç—Å—è –æ—Ç Service?

‚Äî Interactor –¥–∞—ë—Ç —Å—Ç–∞–Ω–¥–∞—Ä—Ç –Ω–∞ —Å—Ç—Ä—É–∫—Ç—É—Ä—É, —è–≤–Ω—ã–π `context`, –ø–æ–¥–¥–µ—Ä–∂–∏–≤–∞–µ—Ç rollback –∏ —Ü–µ–ø–æ—á–∫–∏. –•–æ—Ä–æ—à –¥–ª—è —Å—Ü–µ–Ω–∞—Ä–∏–µ–≤ —Å –ø–æ–±–æ—á–∫–∞–º–∏ –∏ –ø—Ä–æ–º–µ–∂—É—Ç–æ—á–Ω—ã–º–∏ —Ä–µ–∑—É–ª—å—Ç–∞—Ç–∞–º–∏.

---

## üßæ –í—ã–≤–æ–¥

**Interactor = Command + —Å—Ç—Ä—É–∫—Ç—É—Ä–∞ + –∫–æ–Ω—Ç—Ä–æ–ª—å + rollback**
–ï—Å–ª–∏ `.call` –≤–∞—Å —É–∂–µ –Ω–µ —Å–ø–∞—Å–∞–µ—Ç ‚Äî interactor –º–æ–∂–µ—Ç –ø–æ–º–æ—á—å, –æ—Å–æ–±–µ–Ω–Ω–æ –µ—Å–ª–∏ –≤—ã —Ö–æ—Ç–∏—Ç–µ –æ–±–µ—Ä–Ω—É—Ç—å –±–∏–∑–Ω–µ—Å-–ª–æ–≥–∏–∫—É –≤ —Ü–µ–ø–æ—á–∫—É —à–∞–≥–æ–≤, —Å –æ—Ç–∫–∞—Ç–æ–º –∏ –ª–æ–≥–∞–º–∏.
