---
layout: post
subtitle: <div id="terminal"></div>
title:  "Enum –≤ ActiveRecord: –∫–∞–∫ —Å–¥–µ–ª–∞—Ç—å –∫—Ä–∞—Å–∏–≤–æ, –∞ –Ω–µ —á–µ—Ä–µ–∑ –±–æ–ª—å"
date:   2024-09-18 12:00:00 +0300
rate: 3
tags: Ruby,Rails,Enum,PostgreSQL,ActiveRecord,–ë–∏–∑–Ω–µ—Å-–ª–æ–≥–∏–∫–∞
version: A49X3
categories:
  - pattern
  - rails
hero_image: /images/ruby.jpg
hero_darken: true
toc: true
menubar_toc: true
---
Enum –≤ Rails ‚Äî —ç—Ç–æ –∫–∞–∫ —à–≤–µ–π—Ü–∞—Ä—Å–∫–∏–π –Ω–æ–∂: –∫–∞–∂–µ—Ç—Å—è –ø—Ä–æ—Å—Ç—ã–º, –ø–æ–∫–∞ –Ω–µ –ø–æ–ø—Ä–æ–±—É–µ—à—å –æ—Ç–∫—Ä—ã—Ç—å –∏–º –∫–æ–Ω—Å–µ—Ä–≤–Ω—É—é –±–∞–Ω–∫—É. –í —Å—Ç–∞—Ç—å–µ —Ä–∞–∑–±–µ—Ä—ë–º, –∫–∞–∫ –∏–∑–±–µ–∂–∞—Ç—å —Ç–∏–ø–∏—á–Ω—ã—Ö –æ—à–∏–±–æ–∫ —Å enum, —Å–¥–µ–ª–∞—Ç—å –∫–æ–¥ —á–∏—Ç–∞–µ–º—ã–º –∏ –ø–æ–¥–¥–µ—Ä–∂–∏–≤–∞–µ–º—ã–º, –∞ –∑–∞–æ–¥–Ω–æ –Ω–∞—É—á–∏–º—Å—è –¥—Ä—É–∂–∏—Ç—å –∏—Ö —Å PostgreSQL –∏ –±–∏–∑–Ω–µ—Å-–ª–æ–≥–∏–∫–æ–π.

---

–ö–æ–≥–¥–∞-—Ç–æ —è –¥—É–º–∞–ª, —á—Ç–æ `enum status: %i[draft published archived]` ‚Äî —ç—Ç–æ –≤–µ—Ä—à–∏–Ω–∞ —ç–ª–µ–≥–∞–Ω—Ç–Ω–æ—Å—Ç–∏.  
–ü–æ–∫–∞ –Ω–µ –æ–±–Ω–∞—Ä—É–∂–∏–ª –≤ –∫–æ–¥–µ `user.update(status: :published)` –≤ 15 —Ä–∞–∑–Ω—ã—Ö –º–µ—Å—Ç–∞—Ö, `scope :visible, -> { where(status: [:published, :archived]) }` –∏ `if user.draft? && project.published?`.

–ü—Ä–∏—à–ª–æ –≤—Ä–µ–º—è —Ä–∞–∑–æ–±—Ä–∞—Ç—å—Å—è, **–∫–∞–∫ –¥–µ–ª–∞—Ç—å enum –ø—Ä–∞–≤–∏–ª—å–Ω–æ**.

## üß† –¢–µ–æ—Ä–∏—è: –∑–∞—á–µ–º –Ω—É–∂–Ω—ã enum?

**Enum (–ø–µ—Ä–µ—á–∏—Å–ª–µ–Ω–∏–µ)** ‚Äî —ç—Ç–æ:
- –°–ø–æ—Å–æ–± —Ö—Ä–∞–Ω–∏—Ç—å —Å—Ç–∞—Ç—É—Å—ã/—Ç–∏–ø—ã –≤ –ë–î –∫–∞–∫ **—á–∏—Å–ª–∞** (–º–µ–Ω—å—à–µ –º–µ—Å—Ç–∞, –±—ã—Å—Ç—Ä–µ–µ –ø–æ–∏—Å–∫)
- **–ú–µ—Ç–æ–¥—ã-–ø—Ä–µ–¥–∏–∫–∞—Ç—ã** (`user.published?`)
- **–ê–≤—Ç–æ–º–∞—Ç–∏—á–µ—Å–∫–∏–µ —Å–∫–æ—É–ø—ã** (`User.published`)
- –ó–∞—â–∏—Ç–∞ –æ—Ç **–Ω–µ–≤–∞–ª–∏–¥–Ω—ã—Ö –∑–Ω–∞—á–µ–Ω–∏–π**

–ù–æ –ø–æ–¥ –∫–∞–ø–æ—Ç–æ–º ‚Äî –≥—Ä–∞–±–ª–∏, –Ω–∞ –∫–æ—Ç–æ—Ä—ã–µ –Ω–∞—Å—Ç—É–ø–∞–µ—Ç –∫–∞–∂–¥—ã–π –≤—Ç–æ—Ä–æ–π Rails-—Ä–∞–∑—Ä–∞–±–æ—Ç—á–∏–∫.

---

## üîß –ë–∞–∑–æ–≤—ã–π –ø—Ä–∏–º–µ—Ä (–∏ –≥–¥–µ –ø–æ–¥–≤–æ—Ö)

```ruby
class Article < ApplicationRecord
  enum status: {
    draft: 0,
    published: 1,
    archived: 2
  }
end
```

**–ß—Ç–æ –ø–æ–ª—É—á–∞–µ–º "–∏–∑ –∫–æ—Ä–æ–±–∫–∏":**
```ruby
article.published!   # –û–±–Ω–æ–≤–ª–µ–Ω–∏–µ + —Å–æ—Ö—Ä–∞–Ω–µ–Ω–∏–µ
article.published?   # –ü—Ä–µ–¥–∏–∫–∞—Ç
Article.published    # –°–∫–æ—É–ø
article.status       # => "published" (–Ω–æ –≤ –ë–î ‚Äî 1)
```

---

## üí° –õ—É—á—à–∏–µ –ø—Ä–∞–∫—Ç–∏–∫–∏

### 1. –Ø–≤–Ω–æ —É–∫–∞–∑—ã–≤–∞–π—Ç–µ –∑–Ω–∞—á–µ–Ω–∏—è

```ruby
enum status: {
  draft: "draft",
  published: "published",
  archived: "archived"
}, _prefix: true
```

**–ü–ª—é—Å—ã:**
- –ù–µ –ª–æ–º–∞–µ—Ç—Å—è –ø—Ä–∏ –¥–æ–±–∞–≤–ª–µ–Ω–∏–∏ –Ω–æ–≤—ã—Ö —Å—Ç–∞—Ç—É—Å–æ–≤
- –ß–∏—Ç–∞–µ–º—ã–µ –∑–Ω–∞—á–µ–Ω–∏—è –≤ –ë–î (—É–¥–æ–±–Ω–æ –¥–ª—è –∞–Ω–∞–ª–∏—Ç–∏–∫–∏)
- `_prefix: true` –∏–∑–±–µ–≥–∞–µ—Ç –∫–æ–Ω—Ñ–ª–∏–∫—Ç–æ–≤ –º–µ—Ç–æ–¥–æ–≤ (—Ç–µ–ø–µ—Ä—å –º–µ—Ç–æ–¥—ã –±—É–¥—É—Ç `article.status_published?`)

### 2. –ò—Å–ø–æ–ª—å–∑—É–π—Ç–µ pg-enum –¥–ª—è PostgreSQL

```ruby
# –ú–∏–≥—Ä–∞—Ü–∏—è:
def up
  execute <<-SQL
    CREATE TYPE article_status AS ENUM ('draft', 'published', 'archived');
    ALTER TABLE articles ADD COLUMN status article_status;
  SQL
end

# –ú–æ–¥–µ–ª—å:
enum status: {
  draft: "draft",
  published: "published",
  archived: "archived"
}, _prefix: true
```

**–ü–ª—é—Å—ã:**
- –¢–∏–ø–∏–∑–∞—Ü–∏—è –Ω–∞ —É—Ä–æ–≤–Ω–µ –ë–î
- –ù–µ–≤–æ–∑–º–æ–∂–Ω–æ –∑–∞–ø–∏—Å–∞—Ç—å –Ω–µ—Å—É—â–µ—Å—Ç–≤—É—é—â–µ–µ –∑–Ω–∞—á–µ–Ω–∏–µ
- –≠–∫–æ–Ω–æ–º–∏—è –º–µ—Å—Ç–∞ (—Ö—Ä–∞–Ω–∏—Ç—Å—è –∫–∞–∫ int, –Ω–æ –æ—Ç–æ–±—Ä–∞–∂–∞–µ—Ç—Å—è –∫–∞–∫ —Ç–µ–∫—Å—Ç)

---

## üß™ –¢–µ—Å—Ç–∏—Ä–æ–≤–∞–Ω–∏–µ enum

**–ü–ª–æ—Ö–æ:**
```ruby
it "has statuses" do
  expect(Article.statuses).to eq({ "draft" => 0, ... })
end
```

**–•–æ—Ä–æ—à–æ:**
```ruby
describe "status" do
  it "defines correct values" do
    expect(described_class.statuses.keys).to match_array(%w[draft published archived])
  end

  context "when draft" do
    let(:article) { build(:article, status: :draft) }

    it { expect(article).to be_status_draft }
    it { expect(article).not_to be_status_published }
  end
end
```

---

## üî• –ê–Ω—Ç–∏–ø–∞—Ç—Ç–µ—Ä–Ω—ã

### 1. Enum –∫–∞–∫ –∑–∞–º–µ–Ω–∞ State Machine
```ruby
enum status: {
  created: 0,
  approved: 1,
  rejected: 2,
  paid: 3,
  refunded: 4
}

# –ü–æ—Ç–æ–º –≤ –∫–æ–¥–µ:
if user.created? && can_approve?(user)
  user.approved!
  send_notification
elsif user.approved? && can_pay?(user)
  user.paid!
  # ...
end
```

**–ü—Ä–æ–±–ª–µ–º–∞**: –±–∏–∑–Ω–µ—Å-–ª–æ–≥–∏–∫–∞ –ø–µ—Ä–µ—Ö–æ–¥–æ–≤ —Ä–∞–∑–º–∞–∑–∞–Ω–∞ –ø–æ –∫–æ–¥—É.  
**–†–µ—à–µ–Ω–∏–µ**: –∏—Å–ø–æ–ª—å–∑–æ–≤–∞—Ç—å —Å–ø–µ—Ü–∏–∞–ª–∏–∑–∏—Ä–æ–≤–∞–Ω–Ω—ã–µ –≥–µ–º—ã (AASM, Statesman).

### 2. –ú–∞–≥–∏—á–µ—Å–∫–∏–µ —á–∏—Å–ª–∞ –≤ –∫–æ–¥–µ
```ruby
scope :visible, -> { where(status: [1, 2]) } # 1 –∏ 2 ‚Äî —ç—Ç–æ published –∏ archived?
```

**–ò—Å–ø—Ä–∞–≤–ª—è–µ–º:**
```ruby
scope :visible, -> { where(status: [:published, :archived]) }
```

### 3. –°–ª–∏—à–∫–æ–º –º–Ω–æ–≥–æ –∑–Ω–∞—á–µ–Ω–∏–π
```ruby
enum priority: {
  lowest: 0, low: 1, medium: 2, high: 3, 
  urgent: 4, critical: 5, asap: 6, now: 7
}
```

**–ü—Ä–æ–±–ª–µ–º–∞**: —Å–ª–æ–∂–Ω–æ –ø–æ–¥–¥–µ—Ä–∂–∏–≤–∞—Ç—å, –ª–µ–≥–∫–æ –æ—à–∏–±–∏—Ç—å—Å—è.  
**–†–µ—à–µ–Ω–∏–µ**: —Å–æ–∫—Ä–∞—Ç–∏—Ç—å –¥–æ 3-5 –∫–ª—é—á–µ–≤—ã—Ö –≤–∞—Ä–∏–∞–Ω—Ç–æ–≤.

---

## üé§ –ß—Ç–æ —Å–∫–∞–∑–∞—Ç—å –Ω–∞ —Å–æ–±–µ—Å–µ–¥–æ–≤–∞–Ω–∏–∏

> ‚Äî –ö–∞–∫ –≤—ã —Ä–∞–±–æ—Ç–∞–µ—Ç–µ —Å enum –≤ Rails?

‚Äî –ò—Å–ø–æ–ª—å–∑—É–µ–º —è–≤–Ω–æ–µ —É–∫–∞–∑–∞–Ω–∏–µ –∑–Ω–∞—á–µ–Ω–∏–π, pg-enum –¥–ª—è PostgreSQL, –∏–∑–±–µ–≥–∞–µ–º –±–∏–∑–Ω–µ—Å-–ª–æ–≥–∏–∫–∏ –≤ enum. –î–ª—è —Å–ª–æ–∂–Ω—ã—Ö workflow ‚Äî State Machine.

---

## üßæ –í—ã–≤–æ–¥

**Enum ‚Äî —ç—Ç–æ –Ω–µ –ø—Ä–æ—Å—Ç–æ —Å–∏–Ω—Ç–∞–∫—Å–∏—á–µ—Å–∫–∏–π —Å–∞—Ö–∞—Ä, –∞ –∏–Ω—Å—Ç—Ä—É–º–µ–Ω—Ç –ø—Ä–æ–µ–∫—Ç–∏—Ä–æ–≤–∞–Ω–∏—è.**  
–ü—Ä–∞–≤–∏–ª—å–Ω–æ –ø—Ä–∏–º–µ–Ω—ë–Ω–Ω—ã–π, –æ–Ω:
- –î–µ–ª–∞–µ—Ç –∫–æ–¥ **—á–∏—Ç–∞–µ–º—ã–º** (`article.published?` –≤–º–µ—Å—Ç–æ `article.status == 1`)
- –ó–∞—â–∏—â–∞–µ—Ç –æ—Ç **–Ω–µ–≤–∞–ª–∏–¥–Ω—ã—Ö –¥–∞–Ω–Ω—ã—Ö**
- –ü–æ–∑–≤–æ–ª—è–µ—Ç **—ç—Ñ—Ñ–µ–∫—Ç–∏–≤–Ω–æ —Ö—Ä–∞–Ω–∏—Ç—å** —Å–æ—Å—Ç–æ—è–Ω–∏—è

–ù–æ –µ—Å–ª–∏ enum –æ–±—Ä–∞—Å—Ç–∞–µ—Ç –ª–æ–≥–∏–∫–æ–π –ø–µ—Ä–µ—Ö–æ–¥–æ–≤ ‚Äî —ç—Ç–æ –ø–æ–≤–æ–¥ –∑–∞–¥—É–º–∞—Ç—å—Å—è –æ State Machine.  

–ü—Ä–∞–≤–∏–ª–æ: *"Enum ‚Äî —ç—Ç–æ –ø—Ä–æ '—á—Ç–æ', State Machine ‚Äî –ø—Ä–æ '–∫–∞–∫'"*. –ò —Å —ç—Ç–∏–º –Ω–µ –ø–æ—Å–ø–æ—Ä–∏—à—å.
